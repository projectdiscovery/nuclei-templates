id: CVE-2018-14324

info:
  name: Eclipse GlassFish - CVE-2018-14324
  author: matejsmycka
  severity: critical
  description: |
      Eclipse GlassFish has hardcoded credentials on port 7676. An unauthenticated attacker can exploit this vulnerability to gain RCE.
      This template detects GlassFish instance and then gets JMX port from the Java Message Broker and finally sends JMRI liveness probe.
      Shell access can be obtained via prefferred JMX exploitation tool (e.g beanshooter).
  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2018-14324
    - https://github.com/matejsmycka/CVE-2018-14324-Exploit
    - https://www.synack.com/exploits-explained/exploits-explained-java-jmxs-exploitation-problems-and-resolutions/
    - https://github.com/eclipse-ee4j/glassfish/issues/22500
  metadata:
    shodan-query: port:7676 product:"Java Message Service"
  tags: cve,cve2018,glassfish,java,vuln

flow: http() && tcp(1) && tcp(2)

http:
  - method: GET
    path:
      - "{{BaseURL}}"
    matchers:
      - type: regex
        part: header
        regex:
          - "Server:.*GlassFish[a-zA-Z ]*5\\.\\d*"
        internal: true

tcp:
  - inputs:
      - data: ""
    host:
      - "{{Host}}:7676"

    matchers:
      - type: word
        condition: and
        words:
          - "101 imqbroker"
          - "portmapper"
          - "jmx"

    extractors:
      - type: regex
        group: 1
        name: portmapped-jmx-port
        internal: true
        regex:
          - ":(\\d{1,5})/"

  - inputs:
      - data: "JRMI\x00\x02K"
    host:
      - "{{Host}}:{{portmapped-jmx-port}}"

    matchers:
      - type: binary
        binary:
          - "4e00"
