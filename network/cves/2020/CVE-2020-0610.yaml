id: CVE-2020-0610

info:
  name: Microsoft Windows RD Gateway - Remote Code Execution
  author: a-b-r-o-w-n,ad-995,geeknik
  severity: critical
  description: |
    Microsoft Windows Remote Desktop Gateway (RD Gateway) contains a remote code execution vulnerability caused by specially crafted requests from unauthenticated attackers via RDP. This allows remote attackers to execute arbitrary code.
  impact: |
    Successful exploitation of this vulnerability could allow an attacker to execute arbitrary code on the target system, leading to a full compromise.
  remediation: |
    Apply the appropriate security update from Microsoft.
  reference:
    - https://vulncheck.com/xdb/3a3f10478ff3
    - https://gitlab.com/ind3p3nd3nt/BlueGate.git
    - https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2020-0610
    - https://nvd.nist.gov/vuln/detail/CVE-2020-0610
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2020-0610
    cwe-id: CWE-122
    epss-score: 0.97236
    epss-percentile: 0.99991
    cpe: cpe:2.3:o:microsoft:windows_server_2012:-:*:*:*:*:*:*:*
  metadata:
    max-request: 1
    vendor: microsoft
    product: windows_server_2012
    shodan-query: cpe:"cpe:2.3:o:microsoft:windows_server_2012"
  tags: cve,cve2020,rdp,rce,unauth,kev,microsoft

network:
  - inputs:
      - data: "05000c000000410001000000"
        type: hex

    host: "{{Hostname}}"
    port: 3391
    transport: udp

    # The vulnerability check is based on the server's response to a crafted packet.
    # A vulnerable server will either not respond at all (timeout) or respond with a packet
    # that does not end with the specific 4-byte sequence 'ff ff 00 80'.
    #
    # The 'read-size' is set to a value larger than the expected response to ensure
    # we capture the full response if one is sent.
    #
    # The 'read-timeout' is set to a value that allows for network latency but is
    # short enough to quickly identify non-responsive (and thus vulnerable) servers.

    read-size: 1024
    read-timeout: 5s

    matchers-condition: or
    matchers:
      # Matcher 1: The server is vulnerable if it doesn't respond at all.
      - type: word
        words:
          - ""
        part: data

      # Matcher 2: The server is vulnerable if it responds, but the response
      # does not end with 'ff ff 00 80'.
      - type: regex
        regex:
          - ".*[^fF][^fF]0080$"
        part: data
        negative: true
