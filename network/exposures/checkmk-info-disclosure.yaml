id: checkmk-info-disclosure

info:
  name: Checkmk Agent Info Disclosure
  author: ivaldivieso
  severity: medium
  description: |
    The Checkmk agent had exposed sensitive system information on TCP port 6556 without requiring authentication.
  reference:
    - https://medium.com/@Th3hound/the-hidden-danger-of-the-exposed-checkmk-agent-mapping-your-infrastructure-for-attackers-151cc2180e73
  metadata:
    verified: true
    shodan-query: product:"check_mk"
  tags: tcp,network,checkmk,unauth

tcp:
  - inputs:
      - data: "\n"

    host:
      - "{{Hostname}}"
    port: 6556
    read-size: 1024

    matchers-condition: and
    matchers:
      - type: word
        words:
          - "<<<check_mk>>>"
          - "AgentOS:"
          - "Version:"
        condition: or

      - type: word
        words:
          - "HTTP/1.1"
        negative: true
# digest: 4a0a00473045022060de592d0d29b352e846b14d396db9bd558ee8aa619f929eba29c9010d4b7b3a022100a8d24d9663bef61c5e1dbb6ba0bcf5a6f76dcff7700d23ddd7f198e097824649:922c64590222798bb761d5b6d8e72950