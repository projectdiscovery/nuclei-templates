id: checkmk-info-disclosure

info:
  name: Checkmk Agent Info Disclosure
  author: ivaldivieso
  severity: medium
  description: |
    The Checkmk agent had exposed sensitive system information on TCP port 6556 without requiring authentication.
  reference:
    - https://medium.com/@Th3hound/the-hidden-danger-of-the-exposed-checkmk-agent-mapping-your-infrastructure-for-attackers-151cc2180e73
  metadata:
    verified: true
    shodan-query: product:"check_mk"
  tags: tcp,network,checkmk,unauth

tcp:
  - inputs:
      - data: "\n"

    host:
      - "{{Hostname}}"
    port: 6556
    read-size: 1024

    matchers-condition: and
    matchers:
      - type: word
        words:
          - "<<<check_mk>>>"
          - "AgentOS:"
          - "Version:"
        condition: or

      - type: word
        words:
          - "HTTP/1.1"
        negative: true
