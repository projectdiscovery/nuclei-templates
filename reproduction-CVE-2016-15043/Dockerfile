FROM wordpress:4.9-php5.6-apache

# Install unzip
RUN apt-get update && apt-get install -y unzip && rm -rf /var/lib/apt/lists/*

# Copy the vulnerable plugin
# We assume the user has the zip or we can download it during build.
# Downloading it is safer for reproducibility.
RUN curl -o /tmp/wp-mobile-detector.3.5.zip https://downloads.wordpress.org/plugin/wp-mobile-detector.3.5.zip &&     unzip /tmp/wp-mobile-detector.3.5.zip -d /usr/src/wordpress/wp-content/plugins/ &&     rm /tmp/wp-mobile-detector.3.5.zip

# Ensure permissions
RUN chown -R www-data:www-data /usr/src/wordpress/wp-content/plugins/wp-mobile-detector

# Enable apache mod_rewrite (standard for WP)
RUN a2enmod rewrite
