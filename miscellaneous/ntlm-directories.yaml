id: ntlm-directories

info:
  name: Discovering directories w/ NTLM
  author: puzzlepeaches,incogbyte
  severity: info
  tags: misc,fuzz,windows
  reference: https://medium.com/swlh/internal-information-disclosure-using-hidden-ntlm-authentication-18de17675666

requests:
  - payloads:
      path:
         - /
         - /_windows/default.aspx?returnurl=/
         - /abs/
         - /adfs/
         - /adfs/services/trust/2005/windowstransport
         - /adfs/services/trust/13/usernamemixed
         - /adfs/ls/wia
         - /aspnet_client/
         - /autodiscover/
         - /autodiscover/autodiscover.xml
         - /autodiscover/autodiscoverservice.svc/root
         - /autoupdate/
         - /certenroll/
         - /certprov/
         - /certsrv/
         - /conf/
         - /debug/
         - /deviceupdatefiles_ext/
         - /deviceupdatefiles_int/
         - /dialin/
         - /ecp/
         - /etc/
         - /ews/
         - /exchange/
         - /exchweb/
         - /groupexpansion/
         - /hybridconfig/
         - /iwa/authenticated.aspx
         - /iwa/iwa_test.aspx
         - /mcx/
         - /mcx/mcxservice.svc
         - /meet
         - /meet/
         - /meeting/
         - /microsoft-server-activesync/
         - /oab/
         - /ocsp/
         - /owa/
         - /persistentchat/
         - /phoneconferencing/
         - /powershell/
         - /public/
         - /reach/sip.svc
         - /requesthandler/
         - /requesthandlerext
         - /requesthandlerext/
         - /rgs/
         - /rgsclients/
         - /rpc/
         - /rpcwithcert/
         - /scheduler/
         - /ucwa/
         - /unifiedmessaging/
         - /webticket/
         - /webticket/webticketservice.svc
         - /webticket/webticketservice.svcabs/
    attack: sniper
    threads: 50

    raw:
      - |
        GET {{path}} HTTP/1.1
        Host: {{Hostname}}
        Authorization: NTLM TlRMTVNTUAABAAAAB4IIAAAAAAAAAAAAAAAAAAAAAAA=

    matchers-condition: and
    matchers:
      - type: dsl
        dsl:
          - "contains(tolower(all_headers), 'www-authenticate: ntlm')"

      - type: status
        status:
          - 401

    extractors:
      - type: kval
        kval:
          - 'www_authenticate'
