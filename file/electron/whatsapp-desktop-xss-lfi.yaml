id: whatsapp-desktop-xss-lfi

info:
  name: WhatsApp Desktop < 0.3.9309 - XSS to Local File Read
  author: KrE80r
  severity: high
  description: |
    WhatsApp Desktop before version 0.3.9309, when paired with WhatsApp for iPhone before 2.20.10,
    contains a reflected cross-site scripting and local file reading vulnerability. The vulnerability
    chain exploits message metadata tampering, open redirect via rich preview, persistent XSS bypassing
    CSP (missing object-src directive), and local file system access through the Electron environment
    running outdated Chromium 69. Successful exploitation requires user interaction (clicking a
    malicious link preview in a crafted message).
  impact: |
    An attacker can execute arbitrary JavaScript in the context of WhatsApp Desktop and read local
    files from the victim's system using the Fetch API with file:// protocol.
  remediation: |
    Update WhatsApp Desktop to version 0.3.9309 or later, and WhatsApp for iPhone to version 2.20.10
    or later.
  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2019-18426
    - http://weizmangal.com/2020/02/14/whatsapp-vuln/
    - https://www.exploit-db.com/exploits/48295
    - https://www.facebook.com/security/advisories/cve-2019-18426
    - http://packetstormsecurity.com/files/157097/WhatsApp-Desktop-0.3.9308-Cross-Site-Scripting.html
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:H/I:L/A:N
    cvss-score: 8.2
    cve-id: CVE-2019-18426
    cwe-id: CWE-79
  metadata:
    verified: true
    max-request: 0
    vendor: meta
    product: whatsapp_desktop
    shodan-query: ""
  tags: cve,cve2019,electron,whatsapp,xss,lfi,file,kev

file:
  # Detection via Squirrel RELEASES file
  # This is the only reliable method for detecting installed WhatsApp Desktop
  # The RELEASES file is located at: %LOCALAPPDATA%\WhatsApp\packages\RELEASES
  - extensions:
      - all

    matchers-condition: and
    matchers:
      - type: regex
        part: body
        regex:
          - 'WhatsApp-0\.3\.(0|[0-8][0-9]{0,2}|9[0-2][0-9]{0,2}|930[0-8])-(full|delta)\.nupkg'
          - 'WhatsApp-0\.[0-2]\.[0-9]+-(full|delta)\.nupkg'
        condition: or

    extractors:
      - type: regex
        name: version
        part: body
        group: 1
        regex:
          - 'WhatsApp-([0-9.]+)-(full|delta)\.nupkg'
