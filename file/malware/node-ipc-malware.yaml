id: cve-2022-23812

info:
  name: CVE-2022-23812 - node-ipc - Data Tampering
  author: 0xanis
  severity: critical
  description: |
    node-ipc versions 10.1.1-<10.1.3 contain malicious "protestware" code (in dao/ssl-geospec.js)
    that geolocates the host (using ipgeolocation API) and, if the IP is in Russia or Belarus,
    recursively overwrites files with a heart emoji.In version 11.0.0 and above, node-ipc imports `peacenotwar`, which may include undesired behavior. 
  reference:
    - https://snyk.io/blog/peacenotwar-malicious-npm-node-ipc-package-vulnerability/
    - https://github.com/scriptzteam/node-ipc-malware-protestware-CVE-2022-23812/
    - https://nvd.nist.gov/vuln/detail/CVE-2022-23812  
    - https://orca.security/resources/blog/cve-2022-23812-protestware-malicious-code-node-ipc-npm-package/  
    - https://advisories.gitlab.com/pkg/npm/node-ipc/CVE-2022-23812/   
  classification:
    cve-id: CVE-2022-23812
    cwe-id: CWE-94
    cvss-score: 9.8
  metadata:
    verified: true
    max-request: 0
  tags: cve,cve-2022-23812,node-ipc,protestware,rce,malware,code-injection,kev

file:
  - extensions:
      - js
      - json

    matchers-condition: and
    matchers:
      - type: regex
        regex:
          - "aHR0cHM6Ly9hcGkuaXBnZW9sb2NhdGlvbi5pby9pcGdlbz9hcGlLZXk9[0-9A-Za-z+/=]+"
      - type: regex
        regex:
          - "Y291bnRyeV9uYW1l|Y291bnRyeQ=="
      - type: regex
        regex:
          - "cnVzc2lh|YmVsYXJ1cw=="
      - type: regex
        regex:
          - "d3JpdGVGaWxl|4p2k"

    extractors:
      - type: regex
        name: extracted_base64_api_url
        regex:
          - "aHR0cHM6Ly9hcGkuaXBnZW9sb2NhdGlvbi5pby9pcGdlbz9hcGlLZXk9[0-9A-Za-z+/=]+"
      - type: regex
        name: country_checks
        regex:
          - "Y291bnRyeV9uYW1l"
          - "cnVzc2lh"
          - "YmVsYXJ1cw=="
      - type: regex
        name: file_operations
        regex:
          - "d3JpdGVGaWxl"
          - "4p2k"

