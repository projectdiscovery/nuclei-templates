id: CVE-2022-23812-node-ipc-protestware

info:
  name: node-ipc Protestware Malicious Geo-Targeted Code (CVE-2022-23812)
  author: saiteja
  severity: critical
  description: |
    Detects embedded malicious protestware added to node-ipc (CVE-2022-23812)
    where the ssl-geospec.js file fetches geo-IP information and overwrites
    files with a heart emoji if the system is located in Russia or Belarus.
  reference:
    - https://security.snyk.io/vuln/SNYK-JS-NODEIPC-2426370
    - https://github.com/advisories/GHSA-9gr3-789j-4j3q
  classification:
    cve-id: CVE-2022-23812
    cwe-id: CWE-506
  tags: cve, cve2022, node, npm, node-ipc, protestware, malware, supply-chain

file:
  - extensions:
      - js
    max-size: 6000000
    matchers-condition: and
    matchers:
      - type: word
        part: body
        words:
          - "ipapi.co/json"

      - type: word
        part: body
        words:
          - "country === \"RU\""
          - "country === \"BY\""
        condition: and

      - type: word
        part: body
        words:
          - "fs.writeFileSync"
          - "❤️"
        condition: and
