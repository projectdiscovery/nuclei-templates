id: spf-limit-lookup

info:
  name: SPF record DNS lookup limit
  author: theamanrawat
  severity: info
  description: |
    SPF (Sender Policy Framework) records that exceed the 10 DNS lookup limit was detected. SPF records with more than 10 DNS-based mechanisms may cause SPF authentication failures, leading to potential email delivery issues and spoofing risks.
  referance:
    - https://dmarcly.com/blog/spf-permerror-too-many-dns-lookups-when-spf-record-exceeds-10-dns-lookup-limit
  tags: dns,spf,discovery

dns:
  - name: "{{FQDN}}"
    type: TXT

    extractors:
      - type: regex
        name: spf_record
        regex:
          - 'v=spf1[^\"]*'
        internal: true

      - type: regex
        name: spf_record_limit
        part: spf_record
        regex:
          - '(?i)(include|all):?[^ ]*?'
        internal: true

    matchers:
      - type: dsl
        dsl:
          - len(spf_record_limit)>10
# digest: 4a0a0047304502203079819041b7312ed0d5b4473d23316e146a94ca65a41d87c9337a1a1dc26b98022100d71dd110e6d4908635e1fb2fe7f090f03892f24115bcebafc4e1b36b04ee0b19:922c64590222798bb761d5b6d8e72950