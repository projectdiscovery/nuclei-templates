id: expect-ct-misconfigured

info:
  name: Expect-CT Header - Misconfigured
  author: theamanrawat
  severity: info
  description: |
    Detects misconfigured Expect-CT headers: max-age is 0 (ineffective) and enforce directive is missing
  reference:
    - https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Expect-CT
    - https://scotthelme.co.uk/a-new-security-header-expect-ct/
  tags: headers,expect-ct,misconfiguration

http:
  - method: GET
    path:
      - "{{BaseURL}}"

    matchers-condition: and
    matchers:
      - type: word
        part: header
        words:
          - "Expect-CT"
        case-insensitive: true

      - type: dsl
        dsl:
          - 'contains(tolower(header), "max-age=0") || !contains(tolower(header), "enforce")'

    extractors:
      - type: kval
        part: header
        kval:
          - expect_ct
