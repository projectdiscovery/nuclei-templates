id: sap-message-server-detect

info:
  name: SAP Message Server HTTP Detection
  author: LRVT, l4rm4nd
  severity: info
  description: |
    Detects SAP Message Server by sending an HTTP request to the root path
    and checking for a 3xx redirect together with an SAP Message Server
    server header.

    Typical responses look like:
      - HTTP/1.1 307 TEMPORARY REDIRECT
      - Server: SAP Message Server, release <kernel> (<SID>)
      - Location header pointing to a Web Dispatcher or ICM HTTP port

    This identifies an exposed SAP Message Server HTTP listener, which often
    reveals internal hostnames in the Location header and can be useful for
    SAP landscape reconnaissance.
  tags: sap,message-server,http,discovery,recon

http:
  - method: GET
    path:
      - "{{RootURL}}/"

    headers:
      User-Agent: Mozilla/5.0

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 301
          - 302
          - 303
          - 307
          - 308

      - type: word
        part: header
        words:
          - "SAP Message Server"

      - type: regex
        part: header
        regex:
          - "(?i)location:\\s*https?://"

    extractors:
      # Grab the full Server header line including release / SID
      - type: regex
        part: header
        name: version
        group: 1
        regex:
          - "(?i)server:\\s*(SAP Message Server[^\\r\\n]*)"