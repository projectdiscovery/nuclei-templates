id: next-js-detect

info:
  name: Next.js - Detect
  author: matejsmycka
  severity: info
  description: |
    Next.js is a javascript framework built on top of Node.js enabling server-side rendering and generating static websites.
  reference:
    - https://nextjs.org/
  metadata:
    vendor: vercel
    product: next.js
    framework: node.js
    shodan-query:
      - http.html:"/_next/static"
      - cpe:"cpe:2.3:a:zeit:next.js"
    fofa-query: body="/_next/static"
    zoomeye-query: app="Next.js"
  tags: http,nextjs,javascript,detect,discovery



http:
  - method: GET
    path:
      - "{{BaseURL}}"
    redirects: true

    stop-at-first-match: true
    matchers-condition: or
    matchers:
      - type: word
        part: header
        condition: or
        words:
          - 'x-powered-by: Next.js'
        case-insensitive: true

      - type: word
        part: body
        condition: or
        words:
          - '_next/static/'
          - 'id="__NEXT_DATA__"'

    extractors:
          - type: regex
            part: body
            regex:
              - '"hostname":"([^"]+)"'
          - type: regex
            part: body
            regex:
              - '"pathname":"([^"]+)"'

          - type: regex
            name: render_mode
            part: body
            group: 1
            # Detects if the page is using Server-Side Rendering (SSR) or Static Site Generation (SSG)
            regex:
              - '(__N_SSP":true|__N_SSG":true)'