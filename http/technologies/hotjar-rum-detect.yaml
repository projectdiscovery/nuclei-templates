id: hotjar-rum-detect

info:
  name: Hotjar RUM - Detect
  author: Shivam Kamboj
  severity: info
  description: |
    Detects Hotjar Web Analytics & Session Recording artifacts.
  reference:
    - https://www.hotjar.com/
  metadata:
    max-request: 1
    verified: true
    shodan-query: http.html:"static.hotjar.com"
    fofa-query: body="hotjar" || header="hotjar"
  tags: tech,discovery,rum,hotjar

http:
  - method: GET
    path:
      - "{{BaseURL}}"

    redirects: true
    max-redirects: 3

    matchers-condition: and
    matchers:
      - type: dsl
        dsl:
          - "status_code == 200 || status_code == 400"
        condition: and

      - type: regex
        part: body
        regex:
          - "h\\._hjSettings\\s*=\\s*\\{\\s*hjid\\s*:"
          - "_hjSettings\\s*=\\s*\\{"
          - "hjid\\s*:\\s*[0-9]+"
          - "hjsv\\s*:\\s*[0-9]+"
          - "static\\.hotjar\\.com"
          - "script\\.hotjar\\.com"
          - "window\\.hj\\s*=\\s*window\\.hj"
          - "hj\\s*\\(\\s*['\"]identify['\"]"
          - "hj\\s*\\(\\s*['\"]tagRecording['\"]"
          - "hj\\s*\\(\\s*['\"]stateChange['\"]"
          - "connect-src[^;]*hotjar\\.com"
          - "script-src[^;]*hotjar\\.com"
        condition: or
# digest: 4a0a00473045022100dd0fbc932fbfbc0d5fa6d35d9411e1bc5e7f839565473d9891a3fa894c9d76af0220790d4cb5a12604f714a86cd3d8c9d36d6adbc6bbc2eb22b90160023097cc5b0e:922c64590222798bb761d5b6d8e72950