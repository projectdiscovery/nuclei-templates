id: hotjar-rum-detect

info:
  name: Hotjar RUM - Tech Detect
  author: Shivam Kamboj
  severity: info
  description: |
    Detects Hotjar Web Analytics & Session Recording artifacts.
  reference:
    - https://www.hotjar.com/
  metadata:
    max-request: 1
    verified: true
    shodan-query: http.html:"static.hotjar.com"
    fofa-query: body="hotjar" || header="hotjar"
  tags: tech,discovery,rum,hotjar,analytics

http:
  - method: GET
    path:
      - "{{BaseURL}}/"
    redirects: true
    max-redirects: 3

    matchers-condition: and
    matchers:
      - type: dsl
        dsl:
          - "status_code >= 200 && status_code < 400"

      - type: dsl
        dsl:
          - "contains(tolower(all_headers), 'text/html') || contains(tolower(body), '<html')"

      - type: regex
        part: body
        regex:
          - "h\\._hjSettings\\s*=\\s*\\{\\s*hjid\\s*:"
          - "_hjSettings\\s*=\\s*\\{"
          - "hjid\\s*:\\s*[0-9]+"
          - "hjsv\\s*:\\s*[0-9]+"
          - "static\\.hotjar\\.com"
          - "script\\.hotjar\\.com"
          - "window\\.hj\\s*=\\s*window\\.hj"
          - "hj\\s*\\(\\s*['\"]identify['\"]"
          - "hj\\s*\\(\\s*['\"]tagRecording['\"]"
          - "hj\\s*\\(\\s*['\"]stateChange['\"]"
          - "connect-src[^;]*hotjar\\.com"
          - "script-src[^;]*hotjar\\.com"
        condition: or
