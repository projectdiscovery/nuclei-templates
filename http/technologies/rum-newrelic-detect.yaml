id: rum-newrelic-detect

info:
  name: New Relic Browser Monitoring (RUM) - Tech Detect
  author: Shivam Kamboj
  severity: info
  description: Detects New Relic Browser Monitoring (RUM) agent artifacts
  reference:
    - https://docs.newrelic.com/docs/browser/
  metadata:
    shodan-query: 'http.html:"NREUM" OR http.html:"nr-data" OR http.html:"js-agent.newrelic.com" OR http.html:"newrelic-browser-agent"'
    fofa-query: 'body="NREUM" || body="nr-data" || body="js-agent.newrelic.com" || body="newrelic-browser-agent"'
  tags: tech,discovery,rum,newrelic

http:
  - method: GET
    path:
      - "{{BaseURL}}/"
    redirects: true
    max-redirects: 3

    matchers:
      - type: dsl
        dsl:
          - "status_code >= 200 && status_code < 400"
          - "contains(tolower(all_headers), 'text/html') || contains(tolower(all_headers), 'application/xhtml')"
          - "(contains(tolower(body), 'nreum') || contains(tolower(body), 'nr-data') || contains(tolower(body), 'nreum.loader_config')) && (contains(tolower(body), 'js-agent.newrelic.com') || contains(tolower(body), 'newrelic-browser-agent') || contains(tolower(body), 'newrelic.com/nr-'))"
