id: ambassador-api-diagnostics-exposure

info:
  name: Ambassador API Gateway Diagnostics - Exposure
  author: 0x_Akoko
  severity: medium
  description: |
    Detected Ambassador API Gateway diagnostics portal, revealing service mappings, API endpoints, routing configurations, and internal cluster information.
  reference:
    - https://www.getambassador.io/docs/edge-stack/latest/
    - https://www.getambassador.io/docs/edge-stack/latest/topics/running/diagnostics/
  metadata:
    verified: true
    max-request: 1
    shodan-query: http.title:"Ambassador Diagnostic Overview"
    fofa-query: title="Ambassador Diagnostic Overview"
  tags: exposure,ambassador,api,gateway,misconfig

http:
  - method: GET
    path:
      - "{{BaseURL}}/ambassador/v0/diag/"

    matchers:
      - type: dsl
        dsl:
          - status_code == 200
          - contains_all(body, "Ambassador Diagnostic Overview", "Ambassador version")
          - contains_any(body, "Cluster ID", "Ambassador Route Table", "Ambassador namespace")
        condition: and
