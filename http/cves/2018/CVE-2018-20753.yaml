id: CVE-2018-20753

info:
  name: Kaseya VSA - Remote Command Injection
  author: relentless-robotics
  severity: critical
  description: |
    Kaseya VSA RMM before R9.3 9.3.0.35, R9.4 before 9.4.0.36, and R9.5 before 9.5.0.5 allows unprivileged remote attackers to execute PowerShell payloads on all managed devices. This vulnerability was actively exploited in the wild in January 2018 and is listed in CISA's Known Exploited Vulnerabilities Catalog.
  impact: |
    Unauthenticated remote attackers can execute arbitrary PowerShell commands with full privileges on all devices managed by the vulnerable VSA instance, leading to complete system compromise.
  remediation: |
    Upgrade Kaseya VSA to version 9.3.0.35 or later (for R9.3 branch), 9.4.0.36 or later (for R9.4 branch), or 9.5.0.5 or later (for R9.5 branch).
  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2018-20753
    - https://www.cisa.gov/known-exploited-vulnerabilities-catalog
    - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-20753
    - https://www.huntress.com/blog/cybersecurity-awareness-month-day-11-1018-kaseya-vsa-cve-2018-20753
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2018-20753
    cwe-id: CWE-78
    epss-score: 0.00976
    epss-percentile: 0.82266
    cpe: cpe:2.3:a:kaseya:virtual_system_administrator:*:*:*:*:*:*:*:*
  metadata:
    verified: true
    max-request: 1
    vendor: kaseya
    product: virtual_system_administrator
    shodan-query: "title:\"Kaseya VSA\""
  tags: cve,cve2018,kaseya,rce,command-injection,kev

http:
  - method: GET
    path:
      - "{{BaseURL}}/inc/versioninfo.js"

    matchers-condition: and
    matchers:
      - type: word
        part: body
        words:
          - "kVersion"
          - "VSA"
        condition: and

      - type: status
        status:
          - 200

    extractors:
      - type: regex
        part: body
        group: 1
        regex:
          - 'kVersion\s*=\s*["\']([0-9.]+)["\']'

      - type: dsl
        dsl:
          - 'compare_versions(version, "< 9.3.0.35") || compare_versions(version, ">= 9.4.0.0", "< 9.4.0.36") || compare_versions(version, ">= 9.5.0.0", "< 9.5.0.5")'
# digest: 4a0a00473045022100d8e3c4b7f9a2e1c5d6b8a9f0e2d3c4b5a6978e9d0f1e2d3c4b5a602204f3e2d1c0b9a8f7e6d5c4b3a2918f0e9d8c7b6a5f4e3d2c1b0a9f8e7d6c5b4a3:a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s9t0u1v2w3x4y5z6
