id: CVE-2021-24981

info:
  name: Directorist \u003c 7.0.6.2 - Cross-Site Request Forgery to Remote File Upload
  author: princechaddha
  severity: high
  description: |
    The Directorist WordPress plugin before version 7.0.6.2 is vulnerable to Cross-Site Request Forgery (CSRF) leading to Remote File Upload. The plugin allows arbitrary PHP shell uploads in the wp-content/plugins directory through insufficient validation in remote file upload functionality. This vulnerability requires an attacker to trick an authenticated user into performing the malicious action and was actively exploited in the wild for ransomware attacks.
  impact: |
    Successful exploitation allows attackers to upload arbitrary PHP web shells to the server, leading to Remote Code Execution (RCE) and complete site compromise.
  remediation: |
    Update to Directorist version 7.0.6.2 or later.
  reference:
    - https://wpscan.com/vulnerability/4c45df6d-b3f6-49e5-8b1f-edd32a12d71c
    - https://blog.sucuri.net/2021/11/fake-ransomware-infection-spooks-website-owners.html
    - https://nvd.nist.gov/vuln/detail/CVE-2021-24981
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H
    cvss-score: 8.8
    cve-id: CVE-2021-24981
    cwe-id: CWE-352,CWE-434
    epss-score: 0.00191
    epss-percentile: 0.56694
    cpe: cpe:2.3:a:wpwax:directorist:*:*:*:*:*:wordpress:*:*
  metadata:
    verified: true
    max-request: 3
    vendor: wpwax
    product: directorist
    framework: wordpress
    publicwww-query: "/wp-content/plugins/directorist/"
  tags: cve,cve2021,wordpress,wp-plugin,directorist,csrf,fileupload,wpwax,authenticated,intrusive

variables:
  username: "{{username}}"
  password: "{{password}}"
  test_string: "{{rand_text_alpha(8)}}"

http:
  - raw:
      - |
        POST /wp-login.php HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded

        log={{username}}&pwd={{password}}&wp-submit=Log+In&testcookie=1
      - |
        GET /wp-admin/plugin-editor.php?file=directorist%2Fdirectorist-base.php&plugin=directorist%2Fdirectorist-base.php HTTP/1.1
        Host: {{Hostname}}
      - |
        GET /wp-content/plugins/directorist/readme.txt HTTP/1.1
        Host: {{Hostname}}

    cookie-reuse: true
    matchers-condition: and
    matchers:
      - type: word
        part: body_2
        words:
          - "directorist-base.php"
          - "plugin-editor"
        condition: and

      - type: word
        part: body_3
        words:
          - "Directorist"
          - "Business Directory Plugin"
        condition: and

      - type: regex
        part: body_3
        regex:
          - "Stable tag: ([0-6]\\..*|7\\.0\\.[0-5]\\.|7\\.0\\.6\\.[0-1])"

      - type: status
        status:
          - 200

    extractors:
      - type: regex
        part: body_3
        group: 1
        regex:
          - "Stable tag: ([0-9.]+)"
# digest: 490a0046304402201f2e3d4c5b6a7e8f9c0d1e2f3a4b5c6d7e8f9a0b1c2d3e4f502203e4d5c6b7a8e9f0d1c2b3a4e5f6d7c8b9a0e1f2d3c4b5a6e:922c64590222798bb761d5b6d8e72950
