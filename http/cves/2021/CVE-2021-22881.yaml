id: CVE-2021-22881

info:
  name: Ruby on Rails - Open Redirect via Host Header Injection
  author: theamanrawat
  severity: medium
  description: |
    Ruby on Rails action pack before 6.1.2.1, 6.0.3.5 contains an open redirect caused by special crafted Host headers in combination with allowed host formats, letting attackers redirect users to malicious websites, exploit requires attacker to control Host headers.
  impact: |
    Attackers can redirect users to malicious sites, potentially leading to phishing or malware distribution.
  remediation: |
    Update to version 6.1.2.1, 6.0.3.5 or later versions.
  reference:
    - https://hackerone.com/reports/1047447
    - https://nvd.nist.gov/vuln/detail/CVE-2021-22881
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N
    cvss-score: 6.1
    cve-id: CVE-2021-22881
    epss-score: 0.11507
    epss-percentile: 0.93422
    cwe-id: CWE-601
  metadata:
    verified: false
    max-request: 1
  tags: cve,cve2021,ruby,rails,host-header,redirect,vuln

http:
  - raw:
      - |
        GET / HTTP/1.1
        Host: interact.sh#{{randstr}}.{{Hostname}}

    matchers-condition: and
    matchers:
      - type: regex
        part: header
        regex:
          - '(?m)^(?:Location\s*?:\s*?)(?:https?://|//)?(?:[a-zA-Z0-9\-_\.@]*)interact\.sh.*$'

      - type: status
        condition: or
        status:
          - 302
          - 301
# digest: 4b0a00483046022100e69e3594929bc8034fc4197c761e18262f63503245d80ef7d357e62d24a2727102210092354c5907b7102fa52b9e0e8d36176f6560fc587badde2d0fd6b87eaf4ac982:922c64590222798bb761d5b6d8e72950