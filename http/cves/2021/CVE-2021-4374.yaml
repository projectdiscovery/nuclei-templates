id: CVE-2021-4374

info:
  name: WordPress Automatic Plugin <= 3.53.2 - Broken Access Control
  author: pranjal-negi
  severity: critical
  description: |
    WordPress Automatic Plugin for WordPress versions up to 3.53.2 contains a broken access control vulnerability caused by missing authorization and option validation in process_form.php. This allows unauthenticated attackers to arbitrarily update site settings and potentially compromise the entire site through unauthorized modification of WordPress options.
  impact: |
    Unauthenticated attackers can modify arbitrary WordPress options including site settings, which can lead to complete site takeover by enabling user registration and setting the default role to administrator. The vulnerability requires no authentication and can be exploited remotely.
  remediation: Update to version 3.53.3 or later which includes proper authorization checks.
  reference:
    - https://blog.nintechnet.com/critical-vulnerability-fixed-in-wordpress-automatic-plugin/
    - https://nvd.nist.gov/vuln/detail/CVE-2021-4374
    - https://wpscan.com/plugin/wp-automatic
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2021-4374
    cwe-id: CWE-862
    epss-score: 0.71252
    epss-percentile: 0.98239
    cpe: cpe:2.3:a:valvepress:wp_automatic:*:*:*:*:*:wordpress:*:*
  metadata:
    verified: false
    max-request: 1
    vendor: valvepress
    product: wp_automatic
    framework: wordpress
    publicwww-query: "/wp-content/plugins/wp-automatic"
    fofa-query: body="/wp-content/plugins/wp-automatic"
    shodan-query: http.html:"/wp-content/plugins/wp-automatic"
  tags: cve,cve2021,wordpress,wp-plugin,wp,wp-automatic,unauth,broken-access-control,vkev,vuln

http:
  - raw:
      - |
        POST /wp-content/plugins/wp-automatic/process_form.php HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded
        action=update_settings&wp_automatic_option=test
    matchers:
      - type: dsl
        dsl:
          - 'status_code == 200'
          - 'len(body) > 0'
          - '!contains(tolower(body), "not found")'
          - '!contains(tolower(body), "404")'
          - '!contains(tolower(body), "login")'
          - '!contains(tolower(body), "unauthorized")'
          - '!contains(tolower(body), "permission denied")'
          - '!contains(tolower(body), "access denied")'
          - '!contains(tolower(body), "403")'
        condition: and
# digest: 4a0a00473045022100b8c9d1e2f3a4b5c6d7e8f9a0b1c2d3e4f5a6b7c8d9e0f1a2b3c4d5e6f7a8b9c0022047f6e5d4c3b2a1f0e9d8c7b6a5f4e3d2c1b0a9f8e7d6c5b4a3f2e1d0c9b8a7f6:922c64590222798bb761d5b6d8e72950