id: CVE-2021-22941

info:
  name: Citrix ShareFile Storage Zones Controller - Path Traversal RCE
  author: hyaku0121
  severity: critical
  description: |
    Citrix ShareFile Storage Zones Controller before 5.11.20 contains a path traversal vulnerability in the NeatUpload library. An unauthenticated attacker can exploit this to write arbitrary files and achieve remote code execution.
  reference:
    - https://github.com/projectdiscovery/nuclei-templates/issues/14092
    - https://github.com/hoavt18/CVE-2021-22941
    - https://codewhitesec.blogspot.com/2021/09/citrix-sharefile-rce-cve-2021-22941.html
    - https://nvd.nist.gov/vuln/detail/CVE-2021-22941
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2021-22941
    cwe-id: CWE-22
  metadata:
    verified: true
    max-request: 2
    shodan-query: http.title:"ShareFile"
    fofa-query: title="ShareFile"
  tags: cve,cve2021,citrix,sharefile,rce,path-traversal,intrusive

http:
  - method: GET
    path:
      - "{{BaseURL}}/upload.aspx"
      - "{{BaseURL}}/configservice/"

    stop-at-first-match: true

    matchers-condition: and
    matchers:
      - type: word
        part: body
        words:
          - "ShareFile"
          - "NeatUpload"
          - "StorageCenter"
          - "Citrix"
        condition: or

      - type: word
        part: header
        words:
          - "ASP.NET"
          - "X-AspNet"
        condition: or

      - type: status
        status:
          - 200
          - 302
          - 403
        condition: or
