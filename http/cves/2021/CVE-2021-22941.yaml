id: CVE-2021-22941

info:
  name: Citrix ShareFile Storage Zones Controller - Broken Access Control
  author: pratikjojode
  severity: critical
  description: |
    Citrix ShareFile Storage Zones Controller before 5.11.20 contains a broken access control vulnerability 
    that allows unauthenticated attackers to access the Upload.aspx endpoint. This can be exploited to perform 
    path traversal attacks and write arbitrary files, leading to remote code execution.
  reference:
    - https://support.citrix.com/article/CTX328123
    - https://nvd.nist.gov/vuln/detail/CVE-2021-22941
    - https://github.com/hoavt18/CVE-2021-22941
    - https://codewhitesec.blogspot.com/2021/09/citrix-sharefile-rce-cve-2021-22941.html
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2021-22941
    cwe-id: CWE-306
    epss-score: 0.97565
    epss-percentile: 0.99951
    cpe: cpe:2.3:a:citrix:sharefile_storage_zones_controller:*:*:*:*:*:*:*:*
  metadata:
    verified: true
    max-request: 1
    vendor: citrix
    product: sharefile_storage_zones_controller
    shodan-query: http.title:"ShareFile"
    fofa-query: title="ShareFile"
  tags: cve,cve2021,citrix,sharefile,auth-bypass,broken-access-control,kev

http:
  - raw:
      - |
        GET /ShareFile/StorageCenter/Upload.aspx?uploadid={{randstr}}&bp=123&multipart=false HTTP/1.1
        Host: {{Hostname}}

    matchers-condition: and
    matchers:
      - type: word
        words:
          - "LocalFile:"
        part: body

      - type: status
        status:
          - 200

      - type: word
        words:
          - "text/plain"
          - "text/html"
        part: header
        condition: or

    extractors:
      - type: regex
        name: localfile-guid
        group: 1
        regex:
          - 'LocalFile:\s*([A-Fa-f0-9-]{36})'
        part: body
