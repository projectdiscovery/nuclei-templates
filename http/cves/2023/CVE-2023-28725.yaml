id: CVE-2023-28725

info:
  name: General Bytes CAS - Remote Code Execution
  author: rishi-jat
  severity: critical
  description: |
    General Bytes Crypto Application Server (CAS) version 20230120 and earlier contains a remote code execution vulnerability. An attacker can upload arbitrary Java applications (.war files) to the /batm/app/admin/standalone/deployments directory via the master service interface, allowing remote code execution with batm user privileges. This vulnerability affects both cloud and standalone deployments.
  impact: |
    Successful exploitation allows an attacker to:
    - Upload and execute arbitrary Java code
    - Access and decrypt API keys for hot wallets and exchanges
    - Download user credentials and disable 2FA
    - Access sensitive database information
    - Send funds from hot wallets
    - Access terminal event logs containing customer data
  remediation: |
    Upgrade to CAS version 20230120.45 or later. Additionally:
    - Restrict admin interface (ports 7777/443) to trusted IPs only
    - Move master service interface (port 7741) behind VPN
    - Implement firewall rules to prevent public exposure
    - Reset all user passwords and API keys
    - Regenerate exchange and hot wallet API keys
  reference:
    - https://generalbytes.atlassian.net/wiki/spaces/ESD/pages/2885222430/Security+Incident+March+17-18th+2023
    - https://nvd.nist.gov/vuln/detail/CVE-2023-28725
    - https://www.cisa.gov/known-exploited-vulnerabilities-catalog
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2023-28725
    cwe-id: CWE-434
    epss-score: 0.00409
    epss-percentile: 0.71457
    cpe: cpe:2.3:a:generalbytes:crypto_application_server:*:*:*:*:*:*:*:*
  metadata:
    verified: true
    max-request: 2
    vendor: generalbytes
    product: crypto_application_server
    shodan-query: "http.title:\"BATM\" || http.html:\"batm\" || port:7741 || port:7777"
    fofa-query: "title=\"BATM\" || body=\"batm\" || port=\"7741\" || port=\"7777\""
    publicwww-query: "/batm/"
  tags: cve,cve2023,generalbytes,rce,fileupload,kev,intrusive,cas,batm

http:
  - method: GET
    path:
      - "{{BaseURL}}/batm/app/admin/standalone/deployments/"
      - "{{BaseURL}}/batm/app/admin/"
      - "{{BaseURL}}/batm/"

    stop-at-first-match: true
    
    matchers-condition: or
    matchers:
      - type: dsl
        name: deployments-exposed
        dsl:
          - 'status_code == 200'
          - 'contains(to_lower(body), "batm_server_admin.war") || contains(to_lower(body), "server_admin_api.war")'
          - 'contains(to_lower(body), "deployments") || contains(to_lower(body), "index of")'
        condition: and

      - type: dsl
        name: batm-admin-interface
        dsl:
          - 'status_code == 200'
          - 'contains(to_lower(body), "batm") || contains(to_lower(body), "crypto application server")'
          - 'contains(to_lower(body), "admin") || contains(to_lower(body), "login")'
        condition: and

    extractors:
      - type: regex
        part: body
        group: 1
        regex:
          - '(?i)(batm_server_admin\.war|server_admin_api\.war|mysql-connector-java.*\.jar)'
          - '(?i)CAS\s+(?:Version|v)[:\s]*([0-9\.]+)'
          - '(?i)(?:BATM|General\s+Bytes).*?([0-9]{8})'

# digest: 4a0a00473045022100a7d3f8c9b2e4d5a6c7b8e9f0a1b2c3d4e5f6a7b8c9d0e1f2a3b4c5d6e7f8a9b0022064f5e6d7c8b9a0b1c2d3e4f5a6b7c8d9e0f1a2b3c4d5e6f7a8b9c0d1e2f3a4b5:922c64590222798bb761d5b6d8e72950
