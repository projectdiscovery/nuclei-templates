id: CVE-2023-28725

info:
  name: General Bytes CAS - Remote Code Execution
  author: solari
  severity: critical
  description: |
    General Bytes Crypto Application Server (CAS) 20230120 and earlier contains a remote
    code execution vulnerability caused by unauthorized file upload to the deployment directory.
    Attackers can upload malicious Java applications to /batm/app/admin/standalone/deployments
    which are automatically executed by the server.
  impact: |
    Unauthenticated remote attackers can execute arbitrary Java code, access database credentials,
    decrypt API keys for hot wallets and exchanges, and steal cryptocurrency funds.
  remediation: |
    Update to General Bytes CAS version 20221118.48, 20230120.44 or later. Configure CAS
    servers behind firewall and VPN. Rotate all passwords and API keys.
  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2023-28725
    - https://generalbytes.atlassian.net/wiki/spaces/ESD/pages/2885222430
    - https://www.bleepingcomputer.com/news/security/general-bytes-bitcoin-atms-hacked-using-zero-day-15m-stolen/
    - https://www.generalbytes.com/en/news/general-bytes-statement-on-the-security-incident-that-occurred-on-march-18-2023
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2023-28725
    cwe-id: CWE-434
  metadata:
    max-request: 2
    vendor: generalbytes
    product: crypto-application-server
    shodan-query: 'port:7741 "General Bytes"'
  tags: cve,cve2023,generalbytes,cas,rce,kev

http:
  - method: GET
    path:
      - "{{BaseURL}}/batm/app/admin/standalone/deployments/"
      - "{{BaseURL}}/batm/app/admin/"

    host-redirects: true
    max-redirects: 2

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200
          - 403

      - type: word
        part: body
        words:
          - "deployments"
          - "batm"
        condition: or

      - type: word
        part: header
        words:
          - "general bytes"
          - "cas"
        condition: or
        case-insensitive: true

    extractors:
      - type: regex
        part: body
        group: 1
        regex:
          - 'version["\s:]+([0-9.]+)'
          - 'CAS["\s:]+([0-9.]+)'

# Additional Notes:
# - This template detects exposure of the vulnerable deployment directory
# - Service typically runs on port 7741
# - Vulnerable versions: < 20221118.48 and < 20230120.44
# - Known exploited in March 2023, approximately $1.5M stolen
# - Detection without exploitation - does not upload files
