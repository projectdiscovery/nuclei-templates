id: CVE-2019-18935

info:
  name: Telerik UI for ASP.NET AJAX - RadAsyncUpload Deserialization RCE
  author: alanbarret
  severity: critical
  description: |
    Progress Telerik UI for ASP.NET AJAX through 2019.3.1023 contains a .NET deserialization 
    vulnerability in the RadAsyncUpload function. When combined with known or hardcoded encryption 
    keys (CVE-2017-11317), this allows unauthenticated remote code execution via malicious DLL 
    upload and subsequent deserialization. This vulnerability has been actively exploited by APT 
    groups targeting US government agencies and is listed in CISA's Known Exploited Vulnerabilities catalog.
  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2019-18935
    - https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-074a
    - https://bishopfox.com/blog/cve-2019-18935-remote-code-execution-in-telerik-ui
    - https://github.com/noperator/CVE-2019-18935
    - https://www.bleepingcomputer.com/news/security/cisa-telerik-bug-exploited-to-breach-us-federal-agency/
  metadata:
    verified: true
    max-request: 3
    shodan-query: 'http.title:"Telerik" OR http.component:"Telerik UI"'
    fofa-query: 'app="Progress-Telerik-UI"'
    product: ui_for_asp.net_ajax
    vendor: telerik
  classification:
    cve-id: CVE-2019-18935
    cwe-id: CWE-502
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    epss-score: 0.97556
    epss-percentile: 0.99965
    cpe: cpe:2.3:a:telerik:ui_for_asp.net_ajax:*:*:*:*:*:*:*:*
  tags: cve,cve2019,telerik,rce,deserialization,kev,intrusive

variables:
  # Test payload - base64 encoded minimal test data
  test_payload: "{{base64('test_deserialization')}}"

http:
  - raw:
      # Request 1: Detect RadAsyncUpload handler
      - |
        GET /Telerik.Web.UI.WebResource.axd?type=rau HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36
        Accept: */*
        
      # Request 2: Trigger version disclosure via invalid input
      - |
        POST /Telerik.Web.UI.WebResource.axd?type=rau HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36
        Content-Type: application/x-www-form-urlencoded
        
        rauPostData=InvalidDataToTriggerError!!!
        
      # Request 3: Test deserialization with malformed payload
      # This attempts to trigger deserialization processing
      - |
        POST /Telerik.Web.UI.WebResource.axd?type=rau HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36
        Content-Type: application/x-www-form-urlencoded
        
        rauPostData={{base64('{"__type":"System.Configuration.Install.AssemblyInstaller, System.Configuration.Install"}')}}

    cookie-reuse: true
    matchers-condition: and
    matchers:
      # Matcher 1: Confirm handler exists
      - type: word
        part: body
        words:
          - "RadAsyncUpload"
          - "Telerik.Web.UI"
        condition: or
        
      # Matcher 2: Identify vulnerable version in error response
      - type: regex
        part: body
        regex:
          # Matches versions from 2011.1 through 2019.3
          - 'Telerik\.Web\.UI.*?Version=(201[1-9]\.[0-3]\.\d+)'
          - 'Telerik\.Web\.UI.*?Version=(2020\.1\.(0|1)[0-9]{1,2})'
        condition: or
        
      # Matcher 3: Confirm handler processes deserialization attempts
      # Look for error messages indicating deserialization was attempted
      - type: word
        part: body_3
        words:
          - "System.Configuration.Install"
          - "AssemblyInstaller"
          - "could not load"
          - "deserialization"
          - "Type is not resolved"
        condition: or
        
      # Matcher 4: Verify response indicates vulnerability
      - type: status
        status:
          - 200
          - 500
        condition: or

    extractors:
      # Extract exact Telerik version
      - type: regex
        name: telerik_version
        part: body
        group: 1
        regex:
          - 'Telerik\.Web\.UI.*?Version=([0-9\.]+)'
          
      # Extract any error messages
      - type: regex
        name: error_details
        part: body
        group: 1
        regex:
          - '(Exception.*?at Telerik\.Web\.UI)'
          - '(could not load.*?System\.Configuration)'
        
      # Track which request triggered the detection
      - type: dsl
        name: detection_stage
        dsl:
          - '"Handler detected in request 1, Version in request 2, Deserialization in request 3"'

# digest: 4a0a00473045022100af8c9c729b8d35f0e4e1e2d7c6b5a4938271605e4d3c2b1a09887766554433210220567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef1234