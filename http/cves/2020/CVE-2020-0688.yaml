id: CVE-2020-0688

info:
  name: Microsoft Exchange Server - Remote Code Execution
  author: buildingvibes
  severity: critical
  description: |
    Microsoft Exchange Server contains a remote code execution vulnerability due to improper validation of cmdlet arguments. An authenticated user can exploit this vulnerability by sending a specially crafted email to a vulnerable Exchange server. The vulnerability stems from the use of static machine keys in Exchange Control Panel (ECP), allowing attackers to perform .NET deserialization attacks. This affects Microsoft Exchange Server 2010, 2013, 2016, and 2019.
  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2020-0688
    - https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2020-0688
    - https://www.zerodayinitiative.com/blog/2020/2/24/cve-2020-0688-remote-code-execution-on-microsoft-exchange-server-through-fixed-cryptographic-keys
    - https://www.thezdi.com/blog/2020/2/24/cve-2020-0688-remote-code-execution-on-microsoft-exchange-server-through-fixed-cryptographic-keys
    - https://blog.orange.tw/2021/08/proxylogon-a-new-attack-surface-on-ms-exchange-part-1.html
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 8.8
    cve-id: CVE-2020-0688
    cwe-id: CWE-502
    epss-score: 0.97544
    epss-percentile: 0.99998
  metadata:
    verified: true
    max-request: 1
    vendor: microsoft
    product: exchange_server
    shodan-query: http.title:"Outlook Web App"
  tags: cve,cve2020,exchange,microsoft,rce,deserialization,kev

http:
  - method: GET
    path:
      - "{{BaseURL}}/ecp/default.aspx"

    matchers-condition: and
    matchers:
      - type: word
        part: body
        words:
          - "__VIEWSTATEGENERATOR"
          - "Exchange Control Panel"
        condition: and

      - type: word
        part: header
        words:
          - "ASP.NET_SessionId"

      - type: status
        status:
          - 200
          - 302
