id: CVE-2020-5722

info:
  name: Grandstream Networks UCM6200 Series SQL Injection Vulnerability
  author: n3integration
  tags: cve,cve2020,kev,vuln,sqli,passive
  description: |
    The HTTP interface of the Grandstream UCM6200 series is vulnerable to an unauthenticated
    remote SQL injection via crafted HTTP request. An attacker can use this vulnerability to
    execute shell commands as root on versions before 1.0.19.20 or inject HTML in password
    recovery emails in versions before 1.0.20.17.
  reference:
    - https://www.cisa.gov/known-exploited-vulnerabilities-catalog?field_cve=CVE-2020-5722
    - https://www.tenable.com/security/research/tra-2020-15
  severity: critical
  metadata:
    max-request: "1"
    runzero-match: asset["hw_vendor"] == "Grandstream" && asset["hw_product"] matches "(?i)UCM62\\d{2}"
  classification:
    cve-id: CVE-2020-5722
    cwe-id: CWE-89
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    epss-score: 0.90907
    epss-percentile: 0.99603
    cpe: cpe:2.3:o:grandstream:ucm6200_firmware:*:*:*:*:*:*:*:*
  remediation: Apply updates per vendor instructions.

http:
  - method: POST
    path:
      - "{{BaseURL}}/cgi"
    headers:
      ContentType: 'application/x-www-form-urlencoded'
    body: action=getInfo
    stop-at-first-match: true

    matchers:
      - type: dsl
        dsl:
          - 'contains_all(body, "response", "prog_version", "model_name")'
          - 'status_code == 200'
          - 'compare_versions(fwversion, "< 1.0.19.20")'
          - 'regex("UCM62\\d{2}", model)'
        condition: and

    extractors:
      - type: json
        name: fwversion
        part: body
        json:
          - '.response.prog_version'
      - type: json
        name: model
        part: body
        json:
          - '.response.model_name'

