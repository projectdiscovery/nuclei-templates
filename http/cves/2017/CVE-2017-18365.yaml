---
id: CVE-2017-18365

info:
  name: GitHub Enterprise < 2.8.7 - Insecure Deserialization RCE
  author: syedazeez337
  severity: critical
  description: |
    GitHub Enterprise versions 2.8.x before 2.8.7 contain a
    deserialization vulnerability in the Management Console due to a
    hardcoded session secret (641dd6454584ddabfed6342cc66281fb).
    Unauthenticated attackers can craft malicious cookies to achieve
    remote code execution via Ruby Marshal.load. The _gh_manage cookie
    uses format: [base64_data]--[sha1_hmac].
  impact: |
    Successful exploitation allows unauthenticated attackers to achieve
    remote code execution by crafting malicious serialized Ruby objects
    signed with the known hardcoded secret.
  remediation: |
    Upgrade to GitHub Enterprise version 2.8.7 or later which replaces
    the hardcoded secret with a per-instance generated session secret.
  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2017-18365
    - https://github.com/rapid7/metasploit-framework/blob/master/
      modules/exploits/linux/http/github_enterprise_secret.rb
    - https://enterprise.github.com/releases/2.8.7/notes
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2017-18365
    cwe-id: CWE-502
    epss-score: 0.97304
    epss-percentile: 0.99946
    cpe: cpe:2.3:a:github:enterprise:*:*:*:*:*:*:*:*
  metadata:
    verified: true
    max-request: 1
    vendor: github
    product: enterprise
    shodan-query:
      - http.title:"github debug"
      - html:"GitHub Enterprise"
    fofa-query:
      - title="github enterprise"
    google-query: intitle:"github debug"
  tags: cve2017,cve,rce,github,enterprise,deserialization,kev

http:
  - method: GET
    path:
      - "{{BaseURL}}/setup/unlock?redirect_to=/"

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200

      - type: regex
        part: header
        regex:
          - '_gh_manage='

    extractors:
      - type: regex
        name: gh_manage_cookie
        part: header
        regex:
          - '_gh_manage=[^;]+'
