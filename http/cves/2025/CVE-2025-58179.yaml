id: CVE-2025-58179

info:
  name: Astro Cloudflare Adapter SSRF Vulnerability
  author: HoangAnhThai
  severity: high
  description: |
    Detects SSRF vulnerability in Astro's Cloudflare adapter configured with `output: 'server'`
    and the default `imageService: 'compile'`. The flaw allows bypassing domain restrictions on the /_image
    endpoint, enabling unauthorized content delivery and potential SSRF/XSS attacks.
  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2025-58179
    - https://github.com/withastro/astro/commit/9ecf359
    - https://github.com/advisories/GHSA-qpr4-c339-7vq8
  tags: ssrf,xss,astro,cloudflare

http:
  - raw:
      - |
        GET /_image?href=\\placehold.co/600x400&f=svg HTTP/1.1
        Host: {{Hostname}}

    matchers-condition: and
    matchers:
      - name: status
        type: status
        status:
          - 200

      - name: content-type
        type: word
        part: header
        words:
          - "Content-Type: image/svg+xml"

      - name: svg-body
        type: word
        part: body
        words:
          - "<svg"
