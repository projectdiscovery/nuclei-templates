id: CVE-2025-34299

info:
  name: Monsta FTP <= 2.11 - Unauthenticated Arbitrary File Upload RCE
  author: solari
  severity: critical
  description: |
    Monsta FTP version 2.11 and earlier contains an unauthenticated arbitrary file upload
    vulnerability in the API endpoint /mftp/application/api/api.php. The vulnerability allows
    attackers to download files from malicious SFTP servers and write them to arbitrary
    locations on the web server, leading to remote code execution.
  impact: |
    Unauthenticated remote attackers can execute arbitrary code by uploading malicious PHP
    files to the web root through the downloadFile API action with crafted localPath parameters.
  remediation: |
    Update to Monsta FTP version 2.11.3 or later which addresses the file path validation issues.
  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2025-34299
    - https://labs.watchtowr.com/whats-that-coming-over-the-hill-monsta-ftp-remote-code-execution-cve-2025-34299/
    - https://www.vulncheck.com/advisories/monsta-ftp-unauthenticated-arbitrary-file-upload
    - https://github.com/rapid7/metasploit-framework/blob/master/modules/exploits/linux/http/monsta_ftp_rce.rb
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.3
    cve-id: CVE-2025-34299
    cwe-id: CWE-434
  metadata:
    max-request: 3
    vendor: monsta
    product: monsta-ftp
    shodan-query: 'title:"Monsta FTP"'
    verified: true
  tags: cve,cve2025,monsta,ftp,rce,fileupload,kev

http:
  - method: GET
    path:
      - "{{BaseURL}}/mftp/"
      - "{{BaseURL}}/mftp/application/api/api.php"
      - "{{BaseURL}}/settings/constants.php"

    host-redirects: true
    max-redirects: 2

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200
          - 403
          - 500

      - type: word
        part: body
        words:
          - "Monsta FTP"
          - "mftp"
          - "application/api"
        condition: or

      - type: word
        part: header
        words:
          - "monsta"
        condition: or
        case-insensitive: true

    extractors:
      - type: regex
        part: body
        group: 1
        regex:
          - 'APPLICATION_VERSION["\s:]+["\']([0-9.]+)'
          - 'version["\s:]+["\']([0-9.]+)'
          - 'Monsta FTP v([0-9.]+)'

# Additional Notes:
# - This template detects Monsta FTP presence and vulnerable API endpoint
# - Non-exploitative detection only - does not perform actual file upload
# - Vulnerable versions: <= 2.11 (2.10.3, 2.10.4, 2.11)
# - Patched in version 2.11.3 (August 26, 2025)
# - Known Exploited Vulnerability (KEV)
# - Attack uses POST to /mftp/application/api/api.php with downloadFile actionName
# - Discovered by watchTowr Labs (Sonny)
