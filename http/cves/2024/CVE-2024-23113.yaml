id: CVE-2024-23113

info:
  name: Fortinet FortiOS/FortiProxy/FortiPAM/FortiSwitchManager - Format String Vulnerability
  author: security-researcher
  severity: critical
  description: |
    A format string vulnerability exists in the FortiOS fgfmd daemon and related Fortinet products.
    This vulnerability allows a remote unauthenticated attacker to execute arbitrary code or commands
    via specially crafted requests. Detection combines product fingerprinting with version validation
    and service enumeration to identify vulnerable instances.
  impact: |
    Successful exploitation can lead to complete system compromise, data breach,
    lateral movement, and persistent access to the network infrastructure.
  remediation: |
    Update to the latest patched versions immediately. As a temporary workaround,
    remove FGFM access from interfaces if not required.
  reference:
    - https://www.fortiguard.com/psirt/FG-IR-24-029
    - https://nvd.nist.gov/vuln/detail/CVE-2024-23113
    - https://www.cisa.gov/news-events/alerts/2024/10/09/cisa-adds-three-known-exploited-vulnerabilities-catalog
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2024-23113
    cwe-id: CWE-134
    epss-score: 0.97
    epss-percentile: 99.8
    cpe: cpe:2.3:o:fortinet:fortios:*:*:*:*:*:*:*:*
  metadata:
    verified: true
    max-request: 3
    vendor: fortinet
    product: fortios,fortiproxy,fortipam,fortiswitchmanager
    shodan-query: cpe:"cpe:2.3:o:fortinet:fortios"
    fofa-query: title="FortiGate" || title="FortiProxy" || title="FortiPAM"
    zoomeye-query: title:"FortiGate" || title:"FortiProxy"
  tags: cve,cve2024,fortinet,format-string,rce,critical,kev

http:
  - method: GET
    path:
      - "{{BaseURL}}"
      - "{{BaseURL}}/login"

    matchers-condition: and
    matchers:
      - type: word
        part: body
        words:
          - "FortiGate"
          - "FortiOS"
          - "FortiProxy"
          - "FortiPAM"
          - "FortiSwitchManager"
          - "Fortinet"
        condition: or

      - type: word
        part: body
        words:
          # FortiOS vulnerable versions
          - "FortiOS v7.4.0"
          - "FortiOS v7.4.1"
          - "FortiOS v7.4.2"
          - "FortiOS v7.2.0"
          - "FortiOS v7.2.1"
          - "FortiOS v7.2.2"
          - "FortiOS v7.2.3"
          - "FortiOS v7.2.4"
          - "FortiOS v7.2.5"
          - "FortiOS v7.2.6"
          - "FortiOS v7.0.0"
          - "FortiOS v7.0.1"
          - "FortiOS v7.0.2"
          - "FortiOS v7.0.3"
          - "FortiOS v7.0.4"
          - "FortiOS v7.0.5"
          - "FortiOS v7.0.6"
          - "FortiOS v7.0.7"
          - "FortiOS v7.0.8"
          - "FortiOS v7.0.9"
          - "FortiOS v7.0.10"
          - "FortiOS v7.0.11"
          - "FortiOS v7.0.12"
          - "FortiOS v7.0.13"
          # FortiProxy vulnerable versions (extended range)
          - "FortiProxy v7.4.0"
          - "FortiProxy v7.4.1"
          - "FortiProxy v7.4.2"
          - "FortiProxy v7.2.0"
          - "FortiProxy v7.2.1"
          - "FortiProxy v7.2.2"
          - "FortiProxy v7.2.3"
          - "FortiProxy v7.2.4"
          - "FortiProxy v7.2.5"
          - "FortiProxy v7.2.6"
          - "FortiProxy v7.2.7"
          - "FortiProxy v7.2.8"
          - "FortiProxy v7.0.0"
          - "FortiProxy v7.0.1"
          - "FortiProxy v7.0.2"
          - "FortiProxy v7.0.3"
          - "FortiProxy v7.0.4"
          - "FortiProxy v7.0.5"
          - "FortiProxy v7.0.6"
          - "FortiProxy v7.0.7"
          - "FortiProxy v7.0.8"
          - "FortiProxy v7.0.9"
          - "FortiProxy v7.0.10"
          - "FortiProxy v7.0.11"
          - "FortiProxy v7.0.12"
          - "FortiProxy v7.0.13"
          - "FortiProxy v7.0.14"
          # FortiPAM vulnerable versions
          - "FortiPAM v1.2.0"
          - "FortiPAM v1.1.0"
          - "FortiPAM v1.1.1"
          - "FortiPAM v1.1.2"
          - "FortiPAM v1.0.0"
          - "FortiPAM v1.0.1"
          - "FortiPAM v1.0.2"
          - "FortiPAM v1.0.3"
          # FortiSwitchManager vulnerable versions
          - "FortiSwitchManager v7.2.0"
          - "FortiSwitchManager v7.2.1"
          - "FortiSwitchManager v7.2.2"
          - "FortiSwitchManager v7.2.3"
          - "FortiSwitchManager v7.0.0"
          - "FortiSwitchManager v7.0.1"
          - "FortiSwitchManager v7.0.2"
          - "FortiSwitchManager v7.0.3"
        condition: or

    extractors:
      - type: regex
        part: body
        group: 1
        regex:
          - 'Forti(?:OS|Proxy|PAM|SwitchManager) v([0-9]+\.[0-9]+\.[0-9]+)'
          - 'Version: v([0-9]+\.[0-9]+\.[0-9]+)'
        name: version

      - type: regex
        part: body
        group: 1
        regex:
          - "(Forti(?:OS|Proxy|PAM|SwitchManager))"
        name: product

  - method: GET
    path:
      - "{{BaseURL}}/api/v2/monitor/system/status"

    matchers-condition: and
    matchers:
      - type: word
        part: body
        words:
          - '"version"'

      - type: word
        part: body
        words:
          # JSON API version detection for all products
          - '"v7.4.0"'
          - '"v7.4.1"'
          - '"v7.4.2"'
          - '"v7.2.0"'
          - '"v7.2.1"'
          - '"v7.2.2"'
          - '"v7.2.3"'
          - '"v7.2.4"'
          - '"v7.2.5"'
          - '"v7.2.6"'
          - '"v7.2.7"'
          - '"v7.2.8"'
          - '"v7.0.0"'
          - '"v7.0.1"'
          - '"v7.0.2"'
          - '"v7.0.3"'
          - '"v7.0.4"'
          - '"v7.0.5"'
          - '"v7.0.6"'
          - '"v7.0.7"'
          - '"v7.0.8"'
          - '"v7.0.9"'
          - '"v7.0.10"'
          - '"v7.0.11"'
          - '"v7.0.12"'
          - '"v7.0.13"'
          - '"v7.0.14"'
          - '"v1.2.0"'
          - '"v1.1.0"'
          - '"v1.1.1"'
          - '"v1.1.2"'
          - '"v1.0.0"'
          - '"v1.0.1"'
          - '"v1.0.2"'
          - '"v1.0.3"'
        condition: or

    extractors:
      - type: regex
        part: body
        group: 1
        regex:
          - '"version":"v?([0-9]+\.[0-9]+\.[0-9]+)"'
        name: api_version

  - method: GET
    path:
      - "{{BaseURL}}/remote/login"

    matchers:
      - type: word
        part: body
        words:
          - "FortiGate"
          - "FortiProxy"
          - "SSL VPN"
        condition: or

    extractors:
      - type: regex
        part: body
        group: 1
        regex:
          - "Server.*?(Forti[A-Za-z]+)"
        name: server_product
