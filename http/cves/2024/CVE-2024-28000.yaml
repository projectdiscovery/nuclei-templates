id: CVE-2024-28000

info:
  name: WordPress LiteSpeed Cache - Privilege Escalation (Detection)
  author: overflow-sec,ai-assistant
  severity: critical
  description: |
    LiteSpeed Cache for WordPress prior to the patched versions is vulnerable to a
    privilege escalation via the unauthenticated `admin-ajax.php` action `litespeed_crawler`,
    where an attacker may set an arbitrary role via the `litespeed_role` parameter when a
    weak/known `litespeed_hash` is accepted. This template performs a non-invasive check by
    verifying an installed vulnerable plugin version and probing the crawler endpoint without
    changing any server state.
  reference:
    - https://www.cve.org/CVERecord?id=CVE-2024-28000
    - https://patchstack.com/articles/critical-privilege-escalation-in-litespeed-cache-plugin-affecting-5-million-sites?_s_id=cve
    - https://github.com/projectdiscovery/nuclei-templates/issues/13222
    - https://github.com/JohnDoeAnonITA/CVE-2024-28000/blob/main/exp.go
    - https://github.com/SSSSuperX/CVE-2024-28000/blob/main/CVE-2024-28000_Scan.py
    - https://github.com/arch1m3d/CVE-2024-28000/blob/main/exploit.py
    - https://github.com/ebrasha/CVE-2024-28000
    - https://github.com/Alucard0x1/CVE-2024-28000/blob/main/litespeed_cache_poc.py
    - https://www.exploit-db.com/exploits/52328
    - https://blog.securelayer7.net/cve-2024-28000-litespeed-cache-plugin/
  metadata:
    cve: CVE-2024-28000
    vendor: litespeed
    product: litespeed-cache
    framework: wordpress
  tags: cve,cve2024,wordpress,litespeed,plugin,privilege-escalation

flow: http(1) && http(2)

requests:
  - method: GET
    path:
      - "{{BaseURL}}/wp-content/plugins/litespeed-cache/readme.txt"
    headers:
      Accept: "text/plain, */*"
      User-Agent: "Nuclei"
    matchers-condition: and
    matchers:
      - type: word
        part: body
        words:
          - "LiteSpeed Cache"
          - "Stable tag:"
        condition: and
      - type: regex
        part: body
        regex:
          - "Stable tag:\\s*([0-9.]+)"
      - type: dsl
        dsl:
          - compare_versions(version, "< 6.4.1")
    extractors:
      - type: regex
        name: version
        part: body
        group: 1
        internal: true
        regex:
          - "Stable tag:\\s*([0-9.]+)"

  - method: GET
    path:
      - "{{BaseURL}}/wp-admin/admin-ajax.php?action=litespeed_crawler&litespeed_role=administrator&litespeed_hash=000000"
    headers:
      Accept: "*/*"
      User-Agent: "Nuclei"
    # Non-invasive probe: does not attempt to modify any settings; relies on response characteristics
    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200
      - type: word
        part: header
        words:
          - "x-litespeed-cache"
        condition: or
        case-insensitive: true
      - type: word
        part: body
        words:
          - "litespeed"
          - "crawler"
        condition: or
        case-insensitive: true


