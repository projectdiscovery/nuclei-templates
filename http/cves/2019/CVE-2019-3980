id: cve-2019-3980

info:
  name: SolarWinds Dameware Mini Remote Control - Remote Code Execution
  author: alanbarret
  severity: critical
  description: |
    SolarWinds Dameware Mini Remote Client agent v12.1.0.89 contains a remote code execution vulnerability.
    Support for smart card authentication allows unauthenticated attackers to upload and execute arbitrary executables.
  reference:
    - https://www.tenable.com/security/research/tra-227-43
    - https://nvd.nist.gov/vuln/detail/CVE-2019-3980
  classification:
    cvss-metrics: CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2019-3980
    cwe-id: CWE-287
  metadata:
    verified: true
  tags: cve,cve2019,solarwinds,dameware,rce,network

tcp:
  - host:
      - "{{Hostname}}"

    inputs:
      # Step 1: Read server MSG_TYPE_VERSION (0x1130) - 40 bytes
      - read: 40
      # 2. Send MSG_TYPE_VERSION with Smart Card Request (Int 3 at offset 36)
      # Little Endian: 30 11 00 00 (Type 0x1130) + 00*4 + ... + 03 00 00 00 (Auth Type 3)
      # Full Packet:
      # 30 11 00 00 (Type)
      # 00 00 00 00 (Unknown)
      # 00 00 00 00 00 00 28 40 (12.0 double) -> 40 28 00 ... ?
      # struct.pack('<d', 12.0) -> \x00\x00\x00\x00\x00\x00\x28\x40
      # struct.pack('<d', 0.0)  -> \x00...
      # 04 00 00 00 (OS Ver)
      # 00 00 00 00
      # 00 00 00 00
      # 03 00 00 00 (Auth Type = 3 for Smart Card)
      - data: "{{hex_decode('30110000000000000000000000002840000000000000000004000000000000000000000003000000')}}"

    # 3. Read MSG_CLIENT_INFORMATION_V7 (~15KB) + Crypto Init
    read-size: 3000

    matchers:
      - type: binary
        condition: or
        part: body
        binary:
          # MSG_CLIENT_INFORMATION_V7: 0x00011171 (little-endian)
          # This message type indicates successful smart card auth negotiation
          - "71110100"
          # MSG_TYPE_RSA_CRYPTO_C_INIT: 0x000105b8 (little-endian)
          - "b8050100"
