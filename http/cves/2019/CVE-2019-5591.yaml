id: cve-2019-5591
info:
  name: FortiOS - LDAP Server Impersonation
  author: rahul
  severity: medium
  description: |
    FortiOS is potentially vulnerable to an LDAP server impersonation (Man-in-the-Middle) attack.
    The device does not properly validate the certificate of the LDAP server, allowing an
    unauthenticated attacker on the same subnet to intercept sensitive information like login credentials.
    This template detects FortiOS devices with a login page that suggests LDAP authentication is in use.
  impact: |
    Successful exploitation allows an adjacent network attacker to intercept authentication credentials,
    leading to unauthorized access.
  reference:
    - https://www.fortiguard.com/psirt/FG-IR-19-037
    - https://nvd.nist.gov/vuln/detail/CVE-2019-5591
  classification:
    cvss-metrics: CVSS:3.1/AV:A/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N
    cvss-score: 6.5
    cve-id: CVE-2019-5591
    cwe-id: CWE-306
  metadata:
    verified: true
    max-requests: 2
    vendor: fortinet
    product: fortios
    shodan-query: http.title:"FortiGate"
  tags: cve,cve2019,fortios,fortigate,ldap,mitm,kev

http:
  - method: GET
    path:
      - "{{BaseURL}}/login"
      - "{{BaseURL}}/remote/login"

    stop-at-first-match: true
    matchers-condition: and
    matchers:
      - type: regex
        part: body
        regex:
          - '(?i)<title>\s*FortiGate'

      - type: word
        part: body
        words:
          - "ldap"
        case-insensitive: true

    extractors:
      - type: regex
        part: body
        group: 1
        regex:
          - 'FortiOS v([0-9]+\.[0-9]+\.[0-9]+)'