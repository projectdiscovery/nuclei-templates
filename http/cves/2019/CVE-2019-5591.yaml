id: CVE-2019-5591

info:
  name: FortiOS - LDAP Server Impersonation Configuration Vulnerability
  author: Rukhnuddin786
  severity: medium
  description: |
    FortiOS contains a default configuration vulnerability in LDAP server impersonation protection, allowing unauthenticated attackers on the same subnet to intercept sensitive information through Man-in-the-Middle attacks. The vulnerability affects FortiOS versions 6.0.0 through 6.0.3, 5.6.3 through 5.6.7, and 5.4.6 through 5.4.12, where server-identity-check is disabled by default. Even in FortiOS 6.2.1 and above, systems upgraded from vulnerable versions retain the insecure configuration unless explicitly changed.
  impact: |
    Successful exploitation allows attackers on the same subnet to perform Man-in-the-Middle attacks on LDAP authentication traffic, intercepting credentials and sensitive information. This vulnerability has been actively exploited by Iranian threat actors in ransomware campaigns targeting healthcare and other critical infrastructure.
  remediation: |
    Enable LDAP server identity verification:
    1. Configure LDAP server certificate: set ca-cert <ldap-server-certificate>
    2. Enable secure LDAP: set secure ldaps
    3. Enable server identity check: set server-identity-check enable
  reference:
    - https://www.fortiguard.com/psirt/FG-IR-19-037
    - https://www.tenable.com/blog/frequently-asked-questions-about-iranian-cyber-operations
    - https://www.hhs.gov/sites/default/files/iranian-threat-actors-and-healthcare.pdf
    - https://cert-in.org.in/PDF/RANSOMWARE_Report_2022.pdf
    - https://www.ic3.gov/media/news/2021/210527.pdf
    - https://nvd.nist.gov/vuln/detail/CVE-2019-5591
  classification:
    cvss-metrics: CVSS:3.1/AV:A/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N
    cvss-score: 6.5
    cve-id: CVE-2019-5591
    cwe-id: CWE-306
    epss-score: 0.02564
    epss-percentile: 0.84995
    cpe: cpe:2.3:o:fortinet:fortios:*:*:*:*:*:*:*:*
  metadata:
    verified: true
    max-request: 3
    vendor: fortinet
    product: fortios
    publicwww-query: "/remote/login"
    shodan-query:
      - cpe:"cpe:2.3:o:fortinet:fortios"
      - http.favicon.hash:945408572
      - port:10443 http.favicon.hash:945408572
      - http.html:"/remote/login" "xxxxxxxx"
    fofa-query:
      - body="/remote/login" "xxxxxxxx"
      - icon_hash=945408572
      - app="FORTINET-FortiGate"
    censys-query: services.http.response.html_title:"FortiGate"
    google-query: intitle:"FortiGate"
  tags: cve,cve2019,fortios,fortinet,ldap,mitm,kev,config,misconfig

http:
  - raw:
      - |
        GET /remote/login HTTP/1.1
        Host: {{Hostname}}
        Accept: text/html,application/xhtml+xml,application/xml
      - |
        GET /api/v2/monitor/system/status HTTP/1.1
        Host: {{Hostname}}
        Accept: application/json
      - |
        GET /api/v2/monitor/system/config-revision HTTP/1.1
        Host: {{Hostname}}
        Accept: application/json

    host-redirects: true
    max-redirects: 2
    stop-at-first-match: true

    matchers-condition: and
    matchers:
      - type: word
        part: body_1
        words:
          - "/remote/login"
          - "xxxxxxxx"
        condition: and

      - type: word
        part: header
        words:
          - "Server: xxxxxxxx-xxxxx"

      - type: word
        part: body_2
        words:
          - '"serial":'
          - '"version":'
        condition: and

      - type: regex
        part: body_2
        regex:
          - '"version":"v(6\.0\.[0-3]|5\.6\.[3-7]|5\.4\.(6|7|8|9|10|11|12))'
          - '"version":"v6\.2\.0"'
        condition: or

    extractors:
      - type: regex
        name: fortios_version
        part: body_2
        group: 1
        regex:
          - '"version":"v([0-9]+\.[0-9]+\.[0-9]+)"'

      - type: regex
        name: serial_number
        part: body_2
        group: 1
        regex:
          - '"serial":"([^"]+)"'

      - type: regex
        name: hostname
        part: body_2
        group: 1
        regex:
          - '"hostname":"([^"]+)"'

# digest: 4a0a00473045022100de5c8ab4f1b8d0e3f9a2c7e6d5b4a3f2e1d0c9b8a7f6e5d4c3b2a1f0e9d8c7b6022100f3e2d1c0b9a8f7e6d5c4b3a2f1e0d9c8b7a6f5e4d3c2b1a0f9e8d7c6b5a4f3e2:922c64590222798bb761d5b6d8e72950
