id: CVE-2019-0604

info:
  name: Microsoft SharePoint Remote Code Execution - CVE-2019-0604
  author: kali_optimization
  severity: critical
  description: Microsoft SharePoint contains a remote code execution vulnerability due to how the software handles objects in memory
  reference:
    - https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2019-0604
    - https://www.exploit-db.com/exploits/46718
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 8.8
    cve-id: CVE-2019-0604
    cwe-id: CWE-502
  tags: cve,cve2019,sharepoint,rce,microsoft,aspnet

http:
  - method: GET
    path:
      - "{{BaseURL}}/_layouts/15/viewlsts.aspx"
      - "{{BaseURL}}/_layouts/viewlsts.aspx"
      - "{{BaseURL}}/_vti_bin/Lists.asmx"
      - "{{BaseURL}}/_vti_bin/UserProfileService.asmx"

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200

      - type: word
        part: body
        words:
          - "SharePoint"
          - "Microsoft Corporation"
        condition: and

      - type: word
        part: body
        words:
          - "_layouts"
          - "viewlsts.aspx"
          - "Lists.asmx"
          - "UserProfileService"
        condition: or

  - method: POST
    path:
      - "{{BaseURL}}/_vti_bin/Lists.asmx"

    headers:
      Content-Type: "text/xml; charset=utf-8"
      SOAPAction: "http://schemas.microsoft.com/sharepoint/soap/GetListCollection"

    body: |
      <?xml version="1.0" encoding="utf-8"?>
      <soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">
        <soap:Body>
          <GetListCollection xmlns="http://schemas.microsoft.com/sharepoint/soap/" />
        </soap:Body>
      </soap:Envelope>

    matchers:
      - type: word
        part: body
        words:
          - "GetListCollectionResponse"
          - "soap:Envelope"
          - "microsoft.com/sharepoint"
        condition: and

    extractors:
      - type: regex
        part: body
        group: 1
        regex:
          - 'Version="([^"]+)"'
          - 'Title="([^"]+)"'