id: apache-syncope-default-login

info:
  name: Apache Syncope - Default Login
  author: icarot
  severity: high
  description: |
    The Apache Syncope server is configured with default administrative credentials, allowing an attacker to perform unauthorized operations. This template verifies the use of the default username admin and password password.
  reference:
    - https://github.com/apache/syncope
  metadata:
    verified: true
    vendor: apache
    product: syncope
  tags: apache,syncope,default-login

flow: http(1) && http(2)

http:
  - raw:
      - |
        GET /syncope-console/login HTTP/1.1
        Host: {{Hostname}}
        Cookie: {{jsessionid}}

      - |
        GET /syncope-console{{location}} HTTP/1.1
        Host: {{Hostname}}

    extractors:
      - type: regex
        name: jsessionid
        group: 1
        part: header_1
        regex:
          - 'Set-Cookie: (?<jsessionid>JSESSIONID=\w+);'
        internal: true

      - type: regex
        name: location
        group: 1
        part: header_1
        regex:
          - 'Location: .(?<location>\/login\?\d+)'
        internal: true

      - type: regex
        name: loginsubmit
        group: 1
        part: body_2
        regex:
          - '.(?<loginsubmit>\/login\?[0-9]-[0-9].[0-9]-login-submit)'
        internal: true

  - raw:
      - |
        POST /syncope-console{{loginsubmit}} HTTP/1.1
        Host: {{Hostname}}
        Wicket-Ajax: true
        Wicket-Ajax-BaseURL: {{location}}
        X-Requested-With: XMLHttpRequest
        Content-Type: application/x-www-form-urlencoded; charset=UTF-8
        Origin: {{BaseURL}}

        username={{username}}&password={{password}}&language=0&domain=0&p%3A%3Asubmit=1

    attack: pitchfork
    payloads:
      username:
        - admin
      password:
        - password

    matchers-condition: and
    matchers:
      - type: word
        part: body
        words:
          - '<ajax-response><redirect><![CDATA[.]]></redirect></ajax-response>'
          - '<ajax-response><redirect><![CDATA[../]]></redirect></ajax-response>'
        condition: or

      - type: status
        status:
          - 200