id: cve-2023-27532-veeam-credential-disclosure

info:
  name: CVE-2023-27532 - Veeam Backup & Replication - Credential Disclosure (response-based)
  author: nikhilpatidar01
  severity: high
  description: |
    Detection template for CVE-2023-27532 (credential disclosure) - response-based
    This template makes a non-destructive request to the Veeam Enterprise Manager endpoint and
    looks for response artifacts indicating exposed credential fields (encrypted/plain).
  reference:
    - https://github.com/horizon3ai/CVE-2023-27532
    - https://github.com/sfewer-r7/CVE-2023-27532
    - https://github.com/puckiestyle/CVE-2023-27532-RCE-Only
  tags: cve, veeam, credentials, veeam-enterprise-manager

requests:
  # Simple GET check (non-destructive). Replace the path if your POC requires a different endpoint.
  - method: GET
    path:
      - "{{BaseURL}}/api/Config"            # <-- If POC uses another path, replace with that path.
      - "{{BaseURL}}/EnterpriseManager/api/config"
    headers:
      User-Agent: nuclei-scanner
      Accept: "*/*"
    matchers-condition: and
    matchers:
      # Status code check to reduce false positives
      - type: status
        status:
          - 200
      # Look for multiple stable keywords seen in POC responses that indicate credential disclosure
      - type: word
        words:
          - "EncryptedPassword"
          - "Password"
          - "Credentials"
          - "Domain\\Username"
        part: body
      # Regex to capture username/password-like lines â€” tune if needed
      - type: regex
        regex:
          - "(?i)(?:username|user|login|account)[\\s\"'=:]{0,6}[A-Za-z0-9_.@-]{3,64}"
          - "(?i)(?:password|pwd|encryptedpassword)[\\s\"'=:]{0,6}[A-Za-z0-9\\+\\/=\\-]{6,200}"
        part: body
    extractors:
      - type: regex
        regex:
          - "(?i)EncryptedPassword[:=\\s\"']*([A-Za-z0-9\\+\\/=\\-]{8,})"
        part: body
      - type: regex
        regex:
          - "(?i)(?:Username|User|Login)[:=\\s\"']*([A-Za-z0-9_.@-]{3,64})"
        part: body

  # Fallback: POST/soap-style call if the POC demonstrates SOAP/WCF endpoints.
  - method: POST
    path:
      - "{{BaseURL}}/EnterpriseManager/ConfigService.svc"   # replace if POC shows different WCF endpoint
    headers:
      Content-Type: text/xml; charset=utf-8
      User-Agent: nuclei-scanner
    body: |
      <?xml version="1.0" encoding="utf-8"?>
      <s:Envelope xmlns:s="http://schemas.xmlsoap.org/soap/envelope/">
        <s:Body>
          <GetConfig xmlns="http://tempuri.org/"/>
        </s:Body>
      </s:Envelope>
    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200
      - type: word
        words:
          - "EncryptedPassword"
          - "PasswordHash"
        part: body
    extractors:
      - type: regex
        regex:
          - "(?i)EncryptedPassword[:=\\s\"']*([A-Za-z0-9\\+\\/=\\-]{8,})"
        part: body
