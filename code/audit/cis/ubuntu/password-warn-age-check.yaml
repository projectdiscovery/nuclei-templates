id: password-warn-age-check

info:
  name: Ensure Password Expiration Warning Days is Configured
  author: Th3l0newolf
  severity: medium
  description: |
    The PASS_WARN_AGE setting in /etc/login.defs specifies the number of days before password expiration that users are warned. According to CIS Ubuntu Linux Benchmark, this should be set to 7 to provide sufficient notice for users to change their passwords.
  remediation: |
    Edit /etc/login.defs and ensure the line reads: PASS_WARN_AGE 7
    Then verify the change using:
      grep -Pi -- '^\h*PASS_WARN_AGE\h+\d+\b' /etc/login.defs
  reference:
    - https://www.cisecurity.org/benchmark/ubuntu_linux
  metadata:
    verified: true
  tags: cis,linux,password,security,audit,ubuntu,login.defs

self-contained: true

code:
  - engine:
      - bash

    args:
      - "-c"
      - |
        WARN_AGE_LINE=$(grep -Pi -- '^\h*PASS_WARN_AGE\h+\d+\b' /etc/login.defs | head -n1)
        if [ -n "$WARN_AGE_LINE" ]; then
          VALUE=$(echo "$WARN_AGE_LINE" | awk '{print $2}')
          if [ "$VALUE" -eq 7 ]; then
            echo "[password-warn-age-check:Policy-Pass] [PASS_WARN_AGE is $VALUE (valid)] [CIS_PASS] [medium]"
          else
            echo "[password-warn-age-check:Policy-Fail] [PASS_WARN_AGE is $VALUE (invalid)] [CIS_FAIL] [medium]"
          fi
        else
          echo "[password-warn-age-check:Policy-Fail] [PASS_WARN_AGE not set or malformed] [CIS_FAIL] [medium]"
        fi

    matchers:
      - type: word
        name: policy-pass
        words:
          - "Policy-Pass"

      - type: word
        name: policy-fail
        words:
          - "Policy-Fail"
# digest: 490a00463044022068d8de70afa82a2de9731c1c1ffb0190454d71c7bc7156d52c9408bd5bd253c8022063eba42d3063bea484b7bf05f384098f42b65242546a06b8a64f137b34991d88:a335a84a8b55aca14338a3237976ce9a