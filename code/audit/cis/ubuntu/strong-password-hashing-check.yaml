id: strong-password-hashing-check

info:
  name: Ensure Strong Password Hashing Algorithm is Configured
  author: Th3l0newolf
  severity: high
  description: |
    The ENCRYPT_METHOD setting in /etc/login.defs specifies the algorithm used to hash passwords.
    Acceptable values are 'SHA512' or 'yescrypt', which are considered strong hashing methods. Weaker algorithms may expose passwords to brute-force attacks.
  remediation: |
    Edit /etc/login.defs and set ENCRYPT_METHOD to either SHA512 or yescrypt:
      ENCRYPT_METHOD SHA512
      - or -
      ENCRYPT_METHOD yescrypt
    Then verify using:
      grep -Pi -- '^\h*ENCRYPT_METHOD\h+(SHA512|yescrypt)\b' /etc/login.defs
  reference:
    - https://www.cisecurity.org/benchmark/ubuntu_linux
  metadata:
    verified: true
  tags: cis,linux,password,security,audit,ubuntu,login.defs

self-contained: true

code:
  - engine:
      - bash

    args:
      - "-c"
      - |
        HASH_METHOD_LINE=$(grep -Pi -- '^\h*ENCRYPT_METHOD\h+(SHA512|yescrypt)\b' /etc/login.defs | head -n1)
        if [ -n "$HASH_METHOD_LINE" ]; then
          VALUE=$(echo "$HASH_METHOD_LINE" | awk '{print $2}' | tr '[:upper:]' '[:lower:]')
          if [ "$VALUE" = "sha512" ] || [ "$VALUE" = "yescrypt" ]; then
            echo "[strong-password-hashing-check:Policy-Pass] [ENCRYPT_METHOD is $VALUE (valid)] [CIS_PASS] [high]"
          else
            echo "[strong-password-hashing-check:Policy-Fail] [ENCRYPT_METHOD is $VALUE (invalid)] [CIS_FAIL] [high]"
          fi
        else
          echo "[strong-password-hashing-check:Policy-Fail] [ENCRYPT_METHOD not set or malformed] [CIS_FAIL] [high]"
        fi

    matchers:
      - type: word
        name: policy-pass
        words:
          - "Policy-Pass"

      - type: word
        name: policy-fail
        words:
          - "Policy-Fail"
# digest: 490a0046304402207663c30e5de97ee14d783a782f00cf23009d081dcd2d54e66a1bbedb4c91ac3a022058a770940585ff7320f02dd36d8bc3e0f9615e1d3cd0b7fa92e4341336060de1:a335a84a8b55aca14338a3237976ce9a