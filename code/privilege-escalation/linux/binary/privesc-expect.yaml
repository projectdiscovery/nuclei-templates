id: privesc-expect

info:
  name: expect - Privilege Escalation
  author: daffainfo
  severity: high
  description: |
    expect is a Unix scripting and testing utility that automates interactive applications such as telnet, ftp, passwd, fsck, rlogin, tip, and more. It uses scripts to control interactive applications, making it useful for automating tasks that involve user input.
  reference:
    - https://gtfobins.github.io/gtfobins/expect/
  metadata:
    verified: true
  tags: code,linux,expect,privesc

self-contained: true
code:
  - engine:
      - sh
      - bash
    source: |
      whoami

  - engine:
      - sh
      - bash
    source: |
      expect -c 'spawn whoami;interact'

  - engine:
      - sh
      - bash
    source: |
      sudo expect -c 'spawn whoami;interact'

    matchers-condition: and
    matchers:
      - type: word
        part: code_1_response
        words:
          - "root"
        negative: true

      - type: dsl
        dsl:
          - 'contains(code_2_response, "root")'
          - 'contains(code_3_response, "root")'
        condition: or