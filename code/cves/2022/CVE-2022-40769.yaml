id: CVE-2022-40769

info:
  name: Profanity - Weak Cryptography RNG Initialization
  author: pranjal-negi
  severity: high
  description: |
    Profanity version 1.60 and earlier contains a weakness with only four billion possible RNG initializations.
    The tool uses a 32-bit seed to initialize the random number generator for generating 256-bit Ethereum private keys,
    limiting the seed space to approximately 4.3 billion possibilities. This allows attackers to recover private keys
    from Ethereum vanity addresses and steal cryptocurrency, as exploited in the wild in June 2022.
  impact: |
    Successful exploitation allows attackers to recover private keys from Ethereum vanity addresses generated using
    vulnerable versions of Profanity, leading to potential cryptocurrency theft.
  remediation: |
    Upgrade to Profanity version 1.61 or later. If you have generated Ethereum addresses using Profanity 1.60 or earlier,
    immediately transfer all assets to new addresses generated using a secure method. Discontinue use of vulnerable versions.
  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2022-40769
    - https://github.com/PLSRcoin/CVE-2022-40769
    - https://github.com/johguse/profanity/issues/61
    - https://blog.1inch.io/a-vulnerability-disclosed-in-profanity-an-ethereum-vanity-address-tool-68ed7455fc8c
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:N
    cvss-score: 8.1
    cve-id: CVE-2022-40769
    cwe-id: CWE-330
    epss-score: 0.00001
    epss-percentile: 0.00001
    cpe: cpe:2.3:a:profanity:profanity:*:*:*:*:*:*:*:*
  metadata:
    verified: true
    vendor: profanity
    product: profanity
  tags: cve,cve2022,profanity,ethereum,crypto,weak-crypto,rng,kev,vkev,vuln

self-contained: true
code:
  - engine:
      - sh
      - bash
    source: |
      # find profanity binary
      path=$(which profanity 2>/dev/null)
      if [ -z "$path" ]; then
        for p in /usr/local/bin/profanity /usr/bin/profanity ~/.local/bin/profanity; do
          [ -f "$p" ] && path="$p" && break
        done
      fi

      if [ -z "$path" ]; then
        echo probably not vulnerable
        exit 1
      fi

      # primary detection: check binary for vulnerable RNG patterns (not version-based)
      if strings "$path" 2>/dev/null | grep -qiE "(seed.*32|rng.*init|random.*seed|4294967295|0xffffffff)" > /dev/null 2>&1; then
        echo probably vulnerable
        exit 0
      fi

      # primary detection: check source code for vulnerable implementation patterns
      for src in ~/profanity ~/go/src/github.com/johguse/profanity /usr/local/src/profanity; do
        if [ -d "$src" ] && ([ -f "$src/profanity.cpp" ] || [ -f "$src/main.cpp" ] || [ -f "$src/main.c" ]); then
          if grep -r "random_device\|std::mt19937" "$src" 2>/dev/null | grep -v ".git" > /dev/null 2>&1; then
            echo probably vulnerable
            exit 0
          fi
          break
        fi
      done

      # secondary indicator: version check (used only if primary methods don't detect)
      version=$($path --version 2>&1 | grep -oE '[0-9]+\.[0-9]+' | head -1)
      if [ -n "$version" ]; then
        major=$(echo "$version" | cut -d. -f1)
        minor=$(echo "$version" | cut -d. -f2)
        if [ "$major" -lt 1 ] || ([ "$major" -eq 1 ] && [ "$minor" -le 60 ]); then
          echo probably vulnerable
          exit 0
        fi
      fi

      echo probably not vulnerable

    matchers:
      - type: word
        words:
          - "probably vulnerable"

    extractors:
      - type: dsl
        dsl:
          - response
# digest: 4a0a00473045022100a0d073e749ca6ad75d73fdd7acdba35bdafbe683161d1048fab8a5c500151d4302201ce17d0b3b3dcc7eec199a9afb9ada9aae868b3b76decbd3e4a9f65e4003d827:922c64590222798bb761d5b6d8e72950

