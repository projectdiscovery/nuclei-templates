id: sendmail-user-execution-prevention

info:
  name: Sendmail Execution Restriction for General Users
  author: songyaeji
  severity: medium
  description: >
    This template checks whether general users are restricted from executing Sendmail using the 'q' option,
    and whether the Postfix binary is restricted to root or appropriate group members.
    Lack of restriction could allow unauthorized users to manipulate the mail queue or disrupt mail delivery.
  reference:
    - https://isms.kisa.or.kr
    - Cloud Vulnerability Assessment Guide(2024) by KISA
  tags: linux,sendmail,postfix,misconfiguration,local
  metadata:
    verified: true
    os: linux
    max-request: 3
  classification:
    cvss-metrics: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:N
    cvss-score: 5.5
    cwe-id: CWE-732

self-contained: true

code:
  - engine:
      - bash
    source: |
      grep -i restrictqrun /etc/mail/sendmail.cf 2>/dev/null || echo "[MISSING] restrictqrun not found in sendmail.cf"
    matchers:
      - type: word
        part: code_1_response
        words:
          - "restrictqrun"
        condition: contains

  - engine:
      - bash
    source: |
      stat -c "%A" /usr/sbin/postfix 2>/dev/null
    matchers:
      - type: regex
        part: code_2_response
        regex:
          - "^-rwxr-x---"

  - engine:
      - bash
    source: |
      getent group postfix | awk -F ':' '{print $4}' | grep -qw root || echo "[MISSING] root not in postfix group"
    matchers:
      - type: word
        part: code_3_response
        words:
          - "root"