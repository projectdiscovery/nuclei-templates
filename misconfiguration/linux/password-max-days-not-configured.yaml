id: password-max-days-not-configured

info:
  name: Linux Password Maximum Usage Period Not Configured
  author: songyaeji
  severity: medium
  description: >
    If password expiration is not enforced, compromised passwords may remain valid indefinitely,
    posing a security risk. This template checks whether PASS_MAX_DAYS is configured properly (â‰¤ 90)
    and whether individual user shadow entries exceed acceptable limits.
  reference:
    - https://isms.kisa.or.kr/main/csap/notice/
    - Cloud Vulnerability Assessment Guide(2024) by KISA
  tags: linux,local,misconfiguration,password,compliance
  metadata:
    verified: true
    os: linux
    max-request: 2
  classification:
    cwe-id: CWE-284
    cvss-metrics: CVSS:3.0/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:L/A:L
    cvss-score: 4.6

self-contained: true

code:
  - engine:
      - bash
    source: |
      grep "^PASS_MAX_DAYS" /etc/login.defs 2>/dev/null || echo "no-passmaxdays"
    matchers:
      - type: regex
        part: code_1_response
        regex:
          - 'PASS_MAX_DAYS\s*([9][1-9]|[1-9][0-9]{2,})'
          - 'PASS_MAX_DAYS\s*0'
          - 'no-passmaxdays'

  - engine:
      - bash
    source: |
      awk -F: '$5 >= 91 { print $1 ":" $5 }' /etc/shadow 2>/dev/null || echo "no-shadow-entry"
    matchers:
      - type: regex
        part: code_2_response
        regex:
          - '.*:[9][1-9]|[1-9][0-9]{2,}'