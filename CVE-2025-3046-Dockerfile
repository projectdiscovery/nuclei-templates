# Dockerfile for CVE-2025-3046 vulnerable environment
# LlamaIndex ObsidianReader Path Traversal Vulnerability
# Affected versions: 0.12.23 to 0.12.28

FROM python:3.11-slim

# Install system dependencies
RUN apt-get update && apt-get install -y \
    build-essential \
    && rm -rf /var/lib/apt/lists/*

# Create a non-root user
RUN useradd --create-home --shell /bin/bash vulnuser

# Set working directory
WORKDIR /home/vulnuser

# Install vulnerable version of llama_index
RUN pip install --no-cache-dir llama-index==0.12.25

# Create test directory structure
RUN mkdir -p /home/vulnuser/test_vault

# Create a test markdown file in the vault
RUN echo "# Test Obsidian Note\n\nThis is a test file in the obsidian vault." > /home/vulnuser/test_vault/test.md

# Create a sensitive file that should not be accessible
RUN echo "root:x:0:0:root:/root:/bin/bash\nuser:x:1000:1000::/home/user:/bin/bash" > /home/vulnuser/sensitive.txt
RUN chmod 644 /home/vulnuser/sensitive.txt

# Create a symlink that demonstrates the vulnerability (this would be created by attacker)
RUN ln -s /home/vulnuser/sensitive.txt /home/vulnuser/test_vault/evil_link.md

# Switch to non-root user
USER vulnuser

# Default command
CMD ["python3", "-c", "import llama_index; print(f'llama_index version: {llama_index.__version__}'); print('Environment ready for CVE-2025-3046 testing')"]

# Build instructions:
# docker build -f CVE-2025-3046-Dockerfile -t cve-2025-3046-vulnerable .
#
# Run instructions:
# docker run --rm cve-2025-3046-vulnerable
#
# The container includes:
# - llama_index 0.12.25 (vulnerable version)
# - Test obsidian vault with symlink to sensitive file
# - Ready for nuclei template testing

